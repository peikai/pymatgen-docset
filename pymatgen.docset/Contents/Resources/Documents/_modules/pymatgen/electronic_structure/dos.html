<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymatgen.electronic_structure.dos &#8212; pymatgen 2025.1.24 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=5c69cfe2" />
    <script src="../../../_static/documentation_options.js?v=d2bc030c"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.electronic_structure.dos</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.electronic_structure.dos</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module defines classes to represent the density of states (DOS), etc.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.json</span><span class="w"> </span><span class="kn">import</span> <span class="n">MSONable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">value</span> <span class="k">as</span> <span class="n">_constant</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">gaussian_filter1d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">hilbert</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">expit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">wasserstein_distance</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">get_el_sp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.spectrum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Spectrum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.electronic_structure.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">Orbital</span><span class="p">,</span> <span class="n">OrbitalType</span><span class="p">,</span> <span class="n">Spin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.coord</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_linear_interpolated_value</span>

<span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;2.0.0&quot;</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span>  <span class="c1"># noqa: NPY201</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Literal</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NDArray</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Self</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.sites</span><span class="w"> </span><span class="kn">import</span> <span class="n">PeriodicSite</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpeciesLike</span><span class="p">,</span> <span class="n">Tuple3Floats</span>


<div class="viewcode-block" id="DOS">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.DOS">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DOS</span><span class="p">(</span><span class="n">Spectrum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;(Work in progress) Replacement of basic DOS object.</span>
<span class="sd">        All other DOS objects are extended versions of this.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        energies (Sequence[float]): Energies.</span>
<span class="sd">        densities (dict[Spin, NDArray]): Spin densities,</span>
<span class="sd">            e.g. {Spin.up: DOS_up, Spin.down: DOS_down}.</span>
<span class="sd">        efermi (float): The Fermi level.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">XLABEL</span> <span class="o">=</span> <span class="s2">&quot;Energy&quot;</span>
    <span class="n">YLABEL</span> <span class="o">=</span> <span class="s2">&quot;Density&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energies</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">densities</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">efermi</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            energies (Sequence[float]): The Energies.</span>
<span class="sd">            densities (NDArray): A Nx1 or Nx2 array. If former, it is</span>
<span class="sd">                interpreted as a Spin.up only density. Otherwise, the first column</span>
<span class="sd">                is interpreted as Spin.up and the other Spin.down.</span>
<span class="sd">            efermi (float): The Fermi level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">,</span> <span class="n">efermi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="n">efermi</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A string which can be easily plotted.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">:</span>
            <span class="n">str_arr</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="s1">&#39;Energy&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;DensityUp&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;DensityDown&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">energy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">):</span>
                <span class="n">str_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">energy</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">str_arr</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="s1">&#39;Energy&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;DensityUp&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">energy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">):</span>
                <span class="n">str_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">energy</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_arr</span><span class="p">)</span>

<div class="viewcode-block" id="DOS.get_interpolated_gap">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.DOS.get_interpolated_gap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_interpolated_gap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span>
        <span class="n">abs_tol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the interpolated band gap.</span>

<span class="sd">        Args:</span>
<span class="sd">            tol (float): Tolerance in occupations for determining the gap.</span>
<span class="sd">            abs_tol (bool): Use absolute (True) or relative (False) tolerance.</span>
<span class="sd">            spin (Spin | None): Find the gap:</span>
<span class="sd">                - None: In the summed DOS.</span>
<span class="sd">                - Up: In the spin up channel.</span>
<span class="sd">                - Down: In the spin down channel.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[float, float, float]: Energies in eV corresponding to the</span>
<span class="sd">                band gap, CBM and VBM.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tdos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ydim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">spin</span> <span class="o">==</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span>
            <span class="n">tdos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tdos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">abs_tol</span><span class="p">:</span>
            <span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span> <span class="o">*</span> <span class="n">tdos</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">tdos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">below_fermi</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span> <span class="k">if</span> <span class="n">energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="ow">and</span> <span class="n">tdos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]</span>
        <span class="n">above_fermi</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span> <span class="k">if</span> <span class="n">energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="ow">and</span> <span class="n">tdos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]</span>
        <span class="n">vbm_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">below_fermi</span><span class="p">)</span>
        <span class="n">cbm_start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">above_fermi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vbm_start</span> <span class="o">==</span> <span class="n">cbm_start</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span>

        <span class="c1"># Interpolate between adjacent values</span>
        <span class="n">terminal_dens</span> <span class="o">=</span> <span class="n">tdos</span><span class="p">[</span><span class="n">vbm_start</span> <span class="p">:</span> <span class="n">vbm_start</span> <span class="o">+</span> <span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">terminal_energies</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="n">vbm_start</span> <span class="p">:</span> <span class="n">vbm_start</span> <span class="o">+</span> <span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">get_linear_interpolated_value</span><span class="p">(</span><span class="n">terminal_dens</span><span class="p">,</span> <span class="n">terminal_energies</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
        <span class="n">terminal_dens</span> <span class="o">=</span> <span class="n">tdos</span><span class="p">[</span><span class="n">cbm_start</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">cbm_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">terminal_energies</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="n">cbm_start</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">cbm_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">get_linear_interpolated_value</span><span class="p">(</span><span class="n">terminal_dens</span><span class="p">,</span> <span class="n">terminal_energies</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">start</span></div>


<div class="viewcode-block" id="DOS.get_cbm_vbm">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.DOS.get_cbm_vbm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cbm_vbm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">abs_tol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expects a DOS object and finds the CBM and VBM eigenvalues.</span>

<span class="sd">        `tol` may need to be increased for systems with noise/disorder.</span>

<span class="sd">        Args:</span>
<span class="sd">            tol (float): Tolerance in occupations for determining the gap.</span>
<span class="sd">            abs_tol (bool): Use absolute (True) or relative (False) tolerance.</span>
<span class="sd">            spin (Spin | None): Find the gap:</span>
<span class="sd">                - None: In the summed DOS.</span>
<span class="sd">                - Up: In the spin up channel.</span>
<span class="sd">                - Down: In the spin down channel.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[float, float]: Energies in eV corresponding to the CBM and VBM.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine tolerance</span>
        <span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tdos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ydim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">spin</span> <span class="o">==</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span>
            <span class="n">tdos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tdos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">abs_tol</span><span class="p">:</span>
            <span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span> <span class="o">*</span> <span class="n">tdos</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">tdos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Find index of Fermi level</span>
        <span class="n">i_fermi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i_fermi</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">:</span>
            <span class="n">i_fermi</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Work backwards until tolerance is reached</span>
        <span class="n">i_gap_start</span> <span class="o">=</span> <span class="n">i_fermi</span>
        <span class="k">while</span> <span class="n">i_gap_start</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">tdos</span><span class="p">[</span><span class="n">i_gap_start</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">i_gap_start</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="c1"># Work forwards until tolerance is reached</span>
        <span class="n">i_gap_end</span> <span class="o">=</span> <span class="n">i_gap_start</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">i_gap_end</span> <span class="o">&lt;</span> <span class="n">tdos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">tdos</span><span class="p">[</span><span class="n">i_gap_end</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">i_gap_end</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i_gap_end</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i_gap_start</span><span class="p">]</span></div>


<div class="viewcode-block" id="DOS.get_gap">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.DOS.get_gap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_gap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">abs_tol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expects a DOS object and finds the band gap, using the determined</span>
<span class="sd">        VBM and CBM eigenvalues.</span>

<span class="sd">        `tol` may need to be increased for systems with noise/disorder.</span>

<span class="sd">        Args:</span>
<span class="sd">            tol (float): Tolerance in occupations for determining the gap.</span>
<span class="sd">            abs_tol (bool): Use absolute (True) or relative (False) tolerance.</span>
<span class="sd">            spin (Spin | None): Find the gap:</span>
<span class="sd">                - None: In the summed DOS.</span>
<span class="sd">                - Up: In the spin up channel.</span>
<span class="sd">                - Down: In the spin down channel.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Gap in eV.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cbm</span><span class="p">,</span> <span class="n">vbm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cbm_vbm</span><span class="p">(</span><span class="n">tol</span><span class="p">,</span> <span class="n">abs_tol</span><span class="p">,</span> <span class="n">spin</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">cbm</span> <span class="o">-</span> <span class="n">vbm</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.Dos">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Dos</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic DOS object. All other DOS objects are extended versions of this.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        energies (Sequence[float]): Energies.</span>
<span class="sd">        densities (dict[Spin, NDArray): Spin densities,</span>
<span class="sd">            e.g. {Spin.up: DOS_up, Spin.down: DOS_down}.</span>
<span class="sd">        efermi (float): The Fermi level.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">efermi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">energies</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">densities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">],</span>
        <span class="n">norm_vol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            efermi (float): The Fermi level.</span>
<span class="sd">            energies (Sequence[float]): Energies.</span>
<span class="sd">            densities (dict[Spin, NDArray]): The density of states for each Spin.</span>
<span class="sd">            norm_vol (float | None): The volume used to normalize the DOS.</span>
<span class="sd">                Defaults to 1 if None which will not perform any normalization.</span>
<span class="sd">                If None, the result will be in unit of states/eV,</span>
<span class="sd">                otherwise will be in states/eV/Angstrom^3.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="n">efermi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_vol</span> <span class="o">=</span> <span class="n">norm_vol</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">norm_vol</span> <span class="ow">or</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">vol</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">densities</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add two Dos.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (Dos): Another Dos object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If energy scales are different.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sum of the two Dos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">energies</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Energies of both DOS are not compatible!&quot;</span><span class="p">)</span>

        <span class="n">densities</span> <span class="o">=</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">}</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A string which can be easily plotted.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">:</span>
            <span class="n">str_arr</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="s1">&#39;Energy&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;DensityUp&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;DensityDown&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">energy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">):</span>
                <span class="n">str_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">energy</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">str_arr</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="s1">&#39;Energy&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;DensityUp&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">energy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">):</span>
                <span class="n">str_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">energy</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_arr</span><span class="p">)</span>

<div class="viewcode-block" id="Dos.get_densities">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.Dos.get_densities">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_densities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the DOS for a particular spin.</span>

<span class="sd">        Args:</span>
<span class="sd">            spin (Spin): Spin.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NDArray: The DOS for the particular spin. Or the sum of both spins</span>
<span class="sd">                if Spin is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span></div>


<div class="viewcode-block" id="Dos.get_smeared_densities">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.Dos.get_smeared_densities">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_smeared_densities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the the DOS with a Gaussian smearing.</span>

<span class="sd">        Args:</span>
<span class="sd">            sigma (float): Standard deviation of Gaussian smearing.</span>

<span class="sd">        Returns:</span>
<span class="sd">            {Spin: NDArray}: Gaussian-smeared DOS by spin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">avg_diff</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">dens</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">avg_diff</span><span class="p">)</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">dens</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>


<div class="viewcode-block" id="Dos.get_interpolated_value">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.Dos.get_interpolated_value">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_interpolated_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get interpolated density for a particular energy.</span>

<span class="sd">        Args:</span>
<span class="sd">            energy (float): Energy to return the density for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[Spin, float]: Density for energy for each spin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">:</span>
            <span class="n">energies</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_linear_interpolated_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">spin</span><span class="p">],</span> <span class="n">energy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">energies</span></div>


<div class="viewcode-block" id="Dos.get_interpolated_gap">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.Dos.get_interpolated_gap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_interpolated_gap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span>
        <span class="n">abs_tol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple3Floats</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the interpolated band gap.</span>

<span class="sd">        Args:</span>
<span class="sd">            tol (float): Tolerance in occupations for determining the band gap.</span>
<span class="sd">            abs_tol (bool): Use absolute (True) or relative (False) tolerance.</span>
<span class="sd">            spin (Spin | None): Find the gap:</span>
<span class="sd">                None - In the summed DOS.</span>
<span class="sd">                Up - In the spin up channel.</span>
<span class="sd">                Down - In the spin down channel.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[float, float, float]: Energies in eV corresponding to the</span>
<span class="sd">                band gap, CBM and VBM.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tdos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_densities</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tdos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tdos is None&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">abs_tol</span><span class="p">:</span>
            <span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span> <span class="o">*</span> <span class="n">tdos</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">tdos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span>
        <span class="n">below_fermi</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span> <span class="k">if</span> <span class="n">energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="ow">and</span> <span class="n">tdos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]</span>
        <span class="n">above_fermi</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span> <span class="k">if</span> <span class="n">energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="ow">and</span> <span class="n">tdos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]</span>
        <span class="n">vbm_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">below_fermi</span><span class="p">)</span>
        <span class="n">cbm_start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">above_fermi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vbm_start</span> <span class="o">==</span> <span class="n">cbm_start</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span>

        <span class="c1"># Interpolate between adjacent values</span>
        <span class="n">terminal_dens</span> <span class="o">=</span> <span class="n">tdos</span><span class="p">[</span><span class="n">vbm_start</span> <span class="p">:</span> <span class="n">vbm_start</span> <span class="o">+</span> <span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">terminal_energies</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="n">vbm_start</span> <span class="p">:</span> <span class="n">vbm_start</span> <span class="o">+</span> <span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">get_linear_interpolated_value</span><span class="p">(</span><span class="n">terminal_dens</span><span class="p">,</span> <span class="n">terminal_energies</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>

        <span class="n">terminal_dens</span> <span class="o">=</span> <span class="n">tdos</span><span class="p">[</span><span class="n">cbm_start</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">cbm_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">terminal_energies</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="n">cbm_start</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">cbm_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">get_linear_interpolated_value</span><span class="p">(</span><span class="n">terminal_dens</span><span class="p">,</span> <span class="n">terminal_energies</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">start</span></div>


<div class="viewcode-block" id="Dos.get_cbm_vbm">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.Dos.get_cbm_vbm">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cbm_vbm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">abs_tol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expects a DOS object and finds the CBM and VBM eigenvalues.</span>

<span class="sd">        `tol` may need to be increased for systems with noise/disorder.</span>

<span class="sd">        Args:</span>
<span class="sd">            tol (float): Tolerance in occupations for determining the gap.</span>
<span class="sd">            abs_tol (bool): Use absolute (True) or relative (False) tolerance.</span>
<span class="sd">            spin (Spin | None): Find the gap:</span>
<span class="sd">                None - In the summed DOS.</span>
<span class="sd">                Up - In the spin up channel.</span>
<span class="sd">                Down - In the spin down channel.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[float, float]: Energies in eV corresponding to the CBM and VBM.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine tolerance</span>
        <span class="n">tdos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_densities</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tdos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tdos is None&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">abs_tol</span><span class="p">:</span>
            <span class="n">tol</span> <span class="o">=</span> <span class="n">tol</span> <span class="o">*</span> <span class="n">tdos</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">tdos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Find index of Fermi level</span>
        <span class="n">i_fermi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="n">i_fermi</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">:</span>
            <span class="n">i_fermi</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Work backwards until tolerance is reached</span>
        <span class="n">i_gap_start</span> <span class="o">=</span> <span class="n">i_fermi</span>
        <span class="k">while</span> <span class="n">i_gap_start</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">tdos</span><span class="p">[</span><span class="n">i_gap_start</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">i_gap_start</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="c1"># Work forwards until tolerance is reached</span>
        <span class="n">i_gap_end</span> <span class="o">=</span> <span class="n">i_gap_start</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">i_gap_end</span> <span class="o">&lt;</span> <span class="n">tdos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">tdos</span><span class="p">[</span><span class="n">i_gap_end</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">i_gap_end</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">i_gap_end</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">i_gap_start</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span></div>


<div class="viewcode-block" id="Dos.get_gap">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.Dos.get_gap">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_gap</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span>
        <span class="n">abs_tol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the band gap.</span>

<span class="sd">        Args:</span>
<span class="sd">            tol (float): Tolerance in occupations for determining the band gap.</span>
<span class="sd">            abs_tol (bool): Use absolute (True) or relative (False) tolerance.</span>
<span class="sd">            spin (Spin | None): Find the band gap:</span>
<span class="sd">                None - In the summed DOS.</span>
<span class="sd">                Up - In the spin up channel.</span>
<span class="sd">                Down - In the spin down channel.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Band gap in eV.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cbm</span><span class="p">,</span> <span class="n">vbm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cbm_vbm</span><span class="p">(</span><span class="n">tol</span><span class="p">,</span> <span class="n">abs_tol</span><span class="p">,</span> <span class="n">spin</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">cbm</span> <span class="o">-</span> <span class="n">vbm</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Dos.from_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.Dos.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Dos from a dict representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;efermi&quot;</span><span class="p">],</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">],</span>
            <span class="p">{</span><span class="n">Spin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;densities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Dos.as_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.Dos.as_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;JSON-serializable dict representation of Dos.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
            <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;efermi&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="s2">&quot;energies&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;densities&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">dens</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">dens</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
        <span class="p">}</span></div>
</div>



<div class="viewcode-block" id="FermiDos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.FermiDos">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FermiDos</span><span class="p">(</span><span class="n">Dos</span><span class="p">,</span> <span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Relate the density of states, doping levels</span>
<span class="sd">    (i.e. carrier concentrations) and corresponding Fermi levels.</span>

<span class="sd">    A negative doping concentration indicates the majority carriers are</span>
<span class="sd">    electrons (N-type); a positive doping concentration indicates holes</span>
<span class="sd">    are the majority carriers (P-type).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dos</span><span class="p">:</span> <span class="n">Dos</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nelecs</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bandgap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            dos (Dos): Pymatgen Dos object.</span>
<span class="sd">            structure (Structure): A structure. If None, the Structure</span>
<span class="sd">                of the Dos will be used. If the Dos does not have an</span>
<span class="sd">                associated Structure, an ValueError will be raised.</span>
<span class="sd">            nelecs (float): The number of electrons included in the energy range of</span>
<span class="sd">                Dos. It is used for normalizing the DOS. Default None to</span>
<span class="sd">                the total number of electrons in the structure.</span>
<span class="sd">            bandgap (float): If not None, the energy values are scissored so that</span>
<span class="sd">                the electronic band gap matches this value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">dos</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="n">energies</span><span class="o">=</span><span class="n">dos</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span>
            <span class="n">densities</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dos</span><span class="o">.</span><span class="n">densities</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dos</span><span class="p">,</span> <span class="s2">&quot;structure&quot;</span><span class="p">):</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">dos</span><span class="o">.</span><span class="n">structure</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Structure object is not provided and not present in dos&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nelecs</span> <span class="o">=</span> <span class="n">nelecs</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">total_electrons</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">volume</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dos</span><span class="o">.</span><span class="n">energies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span>

        <span class="c1"># Normalize total density of states based on integral at 0 K</span>
        <span class="n">tdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_densities</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tdos</span> <span class="o">=</span> <span class="n">tdos</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nelecs</span> <span class="o">/</span> <span class="p">(</span><span class="n">tdos</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">de</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">ecbm</span><span class="p">,</span> <span class="n">evbm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cbm_vbm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_vbm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">evbm</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_cbm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">ecbm</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_mid_gap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_vbm</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_cbm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_vbm</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A_to_cm</span> <span class="o">=</span> <span class="mf">1e-8</span>

        <span class="k">if</span> <span class="n">bandgap</span><span class="p">:</span>
            <span class="n">eref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="k">if</span> <span class="n">evbm</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="o">&lt;</span> <span class="n">ecbm</span> <span class="k">else</span> <span class="p">(</span><span class="n">evbm</span> <span class="o">+</span> <span class="n">ecbm</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

            <span class="n">idx_fermi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">eref</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">idx_fermi</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_vbm</span><span class="p">:</span>
                <span class="c1"># Fermi level and VBM should have different indices</span>
                <span class="n">idx_fermi</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[:</span><span class="n">idx_fermi</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">bandgap</span> <span class="o">-</span> <span class="p">(</span><span class="n">ecbm</span> <span class="o">-</span> <span class="n">evbm</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="n">idx_fermi</span><span class="p">:]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">bandgap</span> <span class="o">-</span> <span class="p">(</span><span class="n">ecbm</span> <span class="o">-</span> <span class="n">evbm</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span>

<div class="viewcode-block" id="FermiDos.get_doping">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.FermiDos.get_doping">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_doping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fermi_level</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the doping (majority carrier concentration) at a given</span>
<span class="sd">        Fermi level and temperature. A simple Left Riemann sum is used for</span>
<span class="sd">        integrating the density of states over energy &amp; equilibrium Fermi-Dirac</span>
<span class="sd">        distribution.</span>

<span class="sd">        Args:</span>
<span class="sd">            fermi_level (float): The Fermi level in eV.</span>
<span class="sd">            temperature (float): The temperature in Kelvin.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The doping concentration in units of 1/cm^3. Negative values</span>
<span class="sd">                indicate that the majority carriers are electrons (N-type),</span>
<span class="sd">                whereas positive values indicates the majority carriers are holes</span>
<span class="sd">                (P-type).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cb_integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tdos</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_mid_gap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_vbm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:]</span>
            <span class="o">*</span> <span class="n">f0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_mid_gap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_vbm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:],</span> <span class="n">fermi_level</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">de</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_mid_gap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_vbm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">vb_integral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tdos</span><span class="p">[:</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_mid_gap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_cbm</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="o">*</span> <span class="n">f0</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">[:</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_mid_gap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_cbm</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">fermi_level</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">de</span><span class="p">[:</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx_mid_gap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_cbm</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">vb_integral</span> <span class="o">-</span> <span class="n">cb_integral</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volume</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">A_to_cm</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="FermiDos.get_fermi">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.FermiDos.get_fermi">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_fermi</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">concentration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="n">nstep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">step</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">precision</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the Fermi level at which the doping concentration at the given</span>
<span class="sd">        temperature (T) is equal to concentration. An algorithm is used</span>
<span class="sd">        where the relative error is minimized by calculating the doping at a</span>
<span class="sd">        grid which continually becomes finer.</span>

<span class="sd">        Args:</span>
<span class="sd">            concentration (float): The doping concentration in 1/cm^3. Negative</span>
<span class="sd">                values represent N-type doping and positive values represent P-type.</span>
<span class="sd">            temperature (float): The temperature in Kelvin.</span>
<span class="sd">            rtol (float): The maximum acceptable relative error.</span>
<span class="sd">            nstep (int): The number of steps checked around a given Fermi level.</span>
<span class="sd">            step (float): The initial Energy step length when searching.</span>
<span class="sd">            precision (int): The decimal places of calculated Fermi level.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the Fermi level cannot be found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The Fermi level in eV. Note that this is different from</span>
<span class="sd">                the default Dos.efermi.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fermi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span>  <span class="c1"># initialize target Fermi</span>
        <span class="n">relative_error</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">precision</span><span class="p">):</span>
            <span class="n">fermi_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">nstep</span><span class="p">,</span> <span class="n">nstep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span> <span class="o">+</span> <span class="n">fermi</span>
            <span class="n">calc_doping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_doping</span><span class="p">(</span><span class="n">fermi_lvl</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span> <span class="k">for</span> <span class="n">fermi_lvl</span> <span class="ow">in</span> <span class="n">fermi_range</span><span class="p">])</span>
            <span class="n">relative_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">calc_doping</span> <span class="o">/</span> <span class="n">concentration</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">fermi</span> <span class="o">=</span> <span class="n">fermi_range</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">relative_error</span><span class="p">)]</span>
            <span class="n">step</span> <span class="o">/=</span> <span class="mf">10.0</span>

        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">relative_error</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">rtol</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find fermi within </span><span class="si">{</span><span class="n">rtol</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">concentration</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fermi</span></div>


<div class="viewcode-block" id="FermiDos.get_fermi_interextrapolated">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.FermiDos.get_fermi_interextrapolated">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_fermi_interextrapolated</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">concentration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">warn</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">c_ref</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e10</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Similar to get_fermi method except that when it fails to converge, an</span>
<span class="sd">        interpolated or extrapolated Fermi level is returned, with the assumption</span>
<span class="sd">        that the Fermi level changes linearly with log(abs(concentration)),</span>
<span class="sd">        and therefore must be used with caution.</span>

<span class="sd">        Args:</span>
<span class="sd">            concentration (float): The doping concentration in 1/cm^3. Negative</span>
<span class="sd">                value represents N-type doping and positive value represents P-type.</span>
<span class="sd">            temperature (float): The temperature in Kelvin.</span>
<span class="sd">            warn (bool): Whether to give a warning the first time the Fermi level</span>
<span class="sd">                cannot be found.</span>
<span class="sd">            c_ref (float): A doping concentration where get_fermi returns a</span>
<span class="sd">                value without error for both c_ref and -c_ref.</span>
<span class="sd">            **kwargs: Keyword arguments passed to the get_fermi function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The possibly interpolated or extrapolated Fermi level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fermi</span><span class="p">(</span><span class="n">concentration</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">warn</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">concentration</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">c_ref</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">concentration</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>
                    <span class="n">concentration</span> <span class="o">=</span> <span class="mf">1e-10</span>

                <span class="c1"># max(10, ...) is to avoid log(0&lt;x&lt;1) and log(1+x) where both are slow</span>
                <span class="n">f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fermi_interextrapolated</span><span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">concentration</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">),</span>
                    <span class="n">temperature</span><span class="p">,</span>
                    <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">f1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fermi_interextrapolated</span><span class="p">(</span>
                    <span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">concentration</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">),</span>
                    <span class="n">temperature</span><span class="p">,</span>
                    <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_doping</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)))</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_doping</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)))</span>
                <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">f2</span> <span class="o">-</span> <span class="n">f1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c2</span> <span class="o">-</span> <span class="n">c1</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">f2</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">concentration</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">concentration</span><span class="p">))</span> <span class="o">-</span> <span class="n">c2</span><span class="p">)</span>

            <span class="n">f_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fermi_interextrapolated</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">concentration</span><span class="p">)</span> <span class="o">*</span> <span class="n">c_ref</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">f_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fermi_interextrapolated</span><span class="p">(</span><span class="n">concentration</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">clog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">concentration</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">concentration</span><span class="p">))</span>
            <span class="n">c_new_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">concentration</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_doping</span><span class="p">(</span><span class="n">f_new</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)))</span>
            <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_new</span> <span class="o">-</span> <span class="n">f_ref</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c_new_log</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">concentration</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f_new</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">clog</span> <span class="o">-</span> <span class="n">c_new_log</span><span class="p">)</span></div>


<div class="viewcode-block" id="FermiDos.from_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.FermiDos.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get FermiDos object from a dict representation.&quot;&quot;&quot;</span>
        <span class="n">dos</span> <span class="o">=</span> <span class="n">Dos</span><span class="p">(</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;efermi&quot;</span><span class="p">],</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">],</span>
            <span class="p">{</span><span class="n">Spin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;densities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">dos</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">Structure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]),</span> <span class="n">nelecs</span><span class="o">=</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;nelecs&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="FermiDos.as_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.FermiDos.as_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;JSON-serializable dict representation of FermiDos.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
            <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;efermi&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="s2">&quot;energies&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;densities&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">dens</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">dens</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span>
            <span class="s2">&quot;nelecs&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nelecs</span><span class="p">,</span>
        <span class="p">}</span></div>
</div>



<div class="viewcode-block" id="DosFingerprint">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.DosFingerprint">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DosFingerprint</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a Density of States (DOS) fingerprint.</span>

<span class="sd">    This named tuple is used to store information related to the Density of States (DOS)</span>
<span class="sd">    in a material. It includes the energies, densities, type, number of bins, and bin width.</span>

<span class="sd">    Args:</span>
<span class="sd">        energies: The energy values associated with the DOS.</span>
<span class="sd">        densities: The corresponding density values for each energy.</span>
<span class="sd">        fp_type: The type of DOS fingerprint.</span>
<span class="sd">        n_bins: The number of bins used in the fingerprint.</span>
<span class="sd">        bin_width: The width of each bin in the DOS fingerprint.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">energies</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">densities</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">fp_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">bin_width</span><span class="p">:</span> <span class="nb">float</span></div>



<div class="viewcode-block" id="CompleteDos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CompleteDos</span><span class="p">(</span><span class="n">Dos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define total DOS, and projected DOS (PDOS).</span>

<span class="sd">    Mainly used by pymatgen.io.vasp.Vasprun to create a complete DOS from</span>
<span class="sd">    a vasprun.xml file. You are unlikely to generate this object manually.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        structure (Structure): Structure associated with the CompleteDos.</span>
<span class="sd">        pdos (dict[PeriodicSite, dict[Orbital, dict[Spin, NDArray]]]): PDOS.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
        <span class="n">total_dos</span><span class="p">:</span> <span class="n">Dos</span><span class="p">,</span>
        <span class="n">pdoss</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PeriodicSite</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Orbital</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]]],</span>
        <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure (Structure): Structure associated with this DOS.</span>
<span class="sd">            total_dos (Dos): Total DOS for the structure.</span>
<span class="sd">            pdoss (dict): The PDOSs supplied as {Site: {Orbital: {Spin: Densities}}}.</span>
<span class="sd">            normalize (bool): Whether to normalize the DOS by the volume of</span>
<span class="sd">                the structure. If True, the units of the DOS are states/eV/Angstrom^3.</span>
<span class="sd">                Otherwise, the units are states/eV.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">volume</span> <span class="k">if</span> <span class="n">normalize</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">total_dos</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="n">energies</span><span class="o">=</span><span class="n">total_dos</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span>
            <span class="n">densities</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">total_dos</span><span class="o">.</span><span class="n">densities</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
            <span class="n">norm_vol</span><span class="o">=</span><span class="n">vol</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span> <span class="o">=</span> <span class="n">pdoss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Complete DOS for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="CompleteDos.get_normalized">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_normalized">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get normalized CompleteDos.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_vol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span>
            <span class="n">structure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span>
            <span class="n">total_dos</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">pdoss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">,</span>
            <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CompleteDos.get_site_orbital_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_site_orbital_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_site_orbital_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span><span class="p">:</span> <span class="n">PeriodicSite</span><span class="p">,</span> <span class="n">orbital</span><span class="p">:</span> <span class="n">Orbital</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Dos for a particular orbital of a particular site.</span>

<span class="sd">        Args:</span>
<span class="sd">            site: Site in Structure associated with CompleteDos.</span>
<span class="sd">            orbital: Orbital in the site.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dos: for a particular orbital of a particular site.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">orbital</span><span class="p">])</span></div>


<div class="viewcode-block" id="CompleteDos.get_site_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_site_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_site_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span><span class="p">:</span> <span class="n">PeriodicSite</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the total DOS for a site with all orbitals.</span>

<span class="sd">        Args:</span>
<span class="sd">            site (PeriodicSite): Site in Structure associated with CompleteDos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dos: Total DOS for a site with all orbitals.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">site_dos</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">add_densities</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">[</span><span class="n">site</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">site_dos</span><span class="p">)</span></div>


<div class="viewcode-block" id="CompleteDos.get_site_spd_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_site_spd_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_site_spd_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span><span class="p">:</span> <span class="n">PeriodicSite</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OrbitalType</span><span class="p">,</span> <span class="n">Dos</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get orbital projected DOS of a particular site.</span>

<span class="sd">        Args:</span>
<span class="sd">            site (PeriodicSite): Site in Structure associated with CompleteDos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[OrbitalType, Dos]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spd_dos</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OrbitalType</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">pdos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">[</span><span class="n">site</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">orbital_type</span> <span class="o">=</span> <span class="n">_get_orb_type</span><span class="p">(</span><span class="n">orb</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">orbital_type</span> <span class="ow">in</span> <span class="n">spd_dos</span><span class="p">:</span>
                <span class="n">spd_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">spd_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">],</span> <span class="n">pdos</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spd_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdos</span>  <span class="c1"># type: ignore[assignment]</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">orb</span><span class="p">:</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span> <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">densities</span> <span class="ow">in</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>


<div class="viewcode-block" id="CompleteDos.get_site_t2g_eg_resolved_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_site_t2g_eg_resolved_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_site_t2g_eg_resolved_dos</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">site</span><span class="p">:</span> <span class="n">PeriodicSite</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;e_g&quot;</span><span class="p">,</span> <span class="s2">&quot;t2g&quot;</span><span class="p">],</span> <span class="n">Dos</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the t2g/e_g projected DOS for a particular site.</span>

<span class="sd">        Args:</span>
<span class="sd">            site (PeriodicSite): Site in Structure associated with CompleteDos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[Literal[&quot;e_g&quot;, &quot;t2g&quot;], Dos]: Summed e_g and t2g DOS for the site.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t2g_dos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">eg_dos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">atom_dos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">site</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">pdos</span> <span class="ow">in</span> <span class="n">atom_dos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">orb</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Orbital</span><span class="o">.</span><span class="n">dxy</span><span class="p">,</span> <span class="n">Orbital</span><span class="o">.</span><span class="n">dxz</span><span class="p">,</span> <span class="n">Orbital</span><span class="o">.</span><span class="n">dyz</span><span class="p">):</span>
                        <span class="n">t2g_dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdos</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">orb</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Orbital</span><span class="o">.</span><span class="n">dx2</span><span class="p">,</span> <span class="n">Orbital</span><span class="o">.</span><span class="n">dz2</span><span class="p">):</span>
                        <span class="n">eg_dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdos</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;t2g&quot;</span><span class="p">:</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">add_densities</span><span class="p">,</span> <span class="n">t2g_dos</span><span class="p">)),</span>
            <span class="s2">&quot;e_g&quot;</span><span class="p">:</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">add_densities</span><span class="p">,</span> <span class="n">eg_dos</span><span class="p">)),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="CompleteDos.get_spd_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_spd_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_spd_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OrbitalType</span><span class="p">,</span> <span class="n">Dos</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get orbital projected DOS.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[OrbitalType, Dos]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spd_dos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">atom_dos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">pdos</span> <span class="ow">in</span> <span class="n">atom_dos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">orbital_type</span> <span class="o">=</span> <span class="n">_get_orb_type</span><span class="p">(</span><span class="n">orb</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">orbital_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spd_dos</span><span class="p">:</span>
                    <span class="n">spd_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdos</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">spd_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">spd_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">],</span> <span class="n">pdos</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">orb</span><span class="p">:</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span> <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">densities</span> <span class="ow">in</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>


<div class="viewcode-block" id="CompleteDos.get_element_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_element_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_element_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">SpeciesLike</span><span class="p">,</span> <span class="n">Dos</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get element projected DOS.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[Element, Dos]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">el_dos</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">SpeciesLike</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">atom_dos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">el</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">specie</span>
            <span class="k">for</span> <span class="n">pdos</span> <span class="ow">in</span> <span class="n">atom_dos</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">el_dos</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">el_dos</span><span class="p">[</span><span class="n">el</span><span class="p">],</span> <span class="n">pdos</span><span class="p">)</span> <span class="k">if</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">el_dos</span> <span class="k">else</span> <span class="n">pdos</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">el</span><span class="p">:</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">densities</span> <span class="ow">in</span> <span class="n">el_dos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>


<div class="viewcode-block" id="CompleteDos.get_element_spd_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_element_spd_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_element_spd_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">:</span> <span class="n">SpeciesLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OrbitalType</span><span class="p">,</span> <span class="n">Dos</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get element and orbital (spd) projected DOS.</span>

<span class="sd">        Args:</span>
<span class="sd">            el (SpeciesLike): Element associated with CompleteDos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[OrbitalType, Dos]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">get_el_sp</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="n">el_dos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">atom_dos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">site</span><span class="o">.</span><span class="n">specie</span> <span class="o">==</span> <span class="n">el</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">pdos</span> <span class="ow">in</span> <span class="n">atom_dos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">orbital_type</span> <span class="o">=</span> <span class="n">_get_orb_type</span><span class="p">(</span><span class="n">orb</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">orbital_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">el_dos</span><span class="p">:</span>
                        <span class="n">el_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdos</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">el_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">el_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">],</span> <span class="n">pdos</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">orb</span><span class="p">:</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span> <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">densities</span> <span class="ow">in</span> <span class="n">el_dos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">spin_polarization</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Spin polarization at Fermi level.</span>

<span class="sd">        Examples:</span>
<span class="sd">            See Sanvito et al., DOI: 10.1126/sciadv.1602241 for an example usage.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float | None: Spin polarization in range [0, 1], will return NaN</span>
<span class="sd">                if spin polarization is ill-defined (e.g. for insulator).</span>
<span class="sd">                None if the calculation is not spin-polarized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interpolated_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">)</span>

        <span class="n">n_F_up</span> <span class="o">=</span> <span class="n">n_F</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">n_F</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">n_F_down</span> <span class="o">=</span> <span class="n">n_F</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span>
        <span class="c1"># Only well defined for metals or half-metals</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_F_up</span> <span class="o">+</span> <span class="n">n_F_down</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>

        <span class="n">spin_polarization</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_F_up</span> <span class="o">-</span> <span class="n">n_F_down</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_F_up</span> <span class="o">+</span> <span class="n">n_F_down</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">spin_polarization</span><span class="p">)</span>

<div class="viewcode-block" id="CompleteDos.get_band_filling">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_band_filling">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_band_filling</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">band</span><span class="p">:</span> <span class="n">OrbitalType</span> <span class="o">=</span> <span class="n">OrbitalType</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
        <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpeciesLike</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PeriodicSite</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the orbital-projected band filling, defined as the zeroth moment</span>
<span class="sd">        up to the Fermi level.</span>

<span class="sd">        &quot;elements&quot; and &quot;sites&quot; cannot be used together.</span>

<span class="sd">        Args:</span>
<span class="sd">            band (OrbitalType): Orbital to get the band center of (default is d-band).</span>
<span class="sd">            elements (list[SpeciesLike]): Elements to get the band center of.</span>
<span class="sd">            sites (list[PeriodicSite]): Sites to get the band center of.</span>
<span class="sd">            spin (Spin): Spin channel to use. If None, both spin channels will be combined.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Band filling in eV, often denoted f_d for the d-band.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the projected DOS</span>
        <span class="k">if</span> <span class="n">elements</span> <span class="ow">and</span> <span class="n">sites</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both element and site cannot be specified.&quot;</span><span class="p">)</span>

        <span class="n">densities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">elements</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                <span class="n">spd_dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_spd_dos</span><span class="p">(</span><span class="n">el</span><span class="p">)[</span><span class="n">band</span><span class="p">]</span>
                <span class="n">densities</span> <span class="o">=</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">sites</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sites</span><span class="p">):</span>
                <span class="n">spd_dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_site_spd_dos</span><span class="p">(</span><span class="n">site</span><span class="p">)[</span><span class="n">band</span><span class="p">]</span>
                <span class="n">densities</span> <span class="o">=</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spd_dos</span><span class="p">()[</span><span class="n">band</span><span class="p">]</span>

        <span class="n">energies</span> <span class="o">=</span> <span class="n">dos</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">dos</span><span class="o">.</span><span class="n">efermi</span>
        <span class="n">dos_densities</span> <span class="o">=</span> <span class="n">dos</span><span class="o">.</span><span class="n">get_densities</span><span class="p">(</span><span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dos_densities</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dos_densities is None&quot;</span><span class="p">)</span>

        <span class="c1"># Only integrate up to Fermi level</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="n">dos</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">dos</span><span class="o">.</span><span class="n">efermi</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">dos_densities</span><span class="p">[</span><span class="n">energies</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">energies</span><span class="p">[</span><span class="n">energies</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span>
            <span class="n">dos_densities</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">energies</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CompleteDos.get_band_center">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_band_center">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_band_center</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">band</span><span class="p">:</span> <span class="n">OrbitalType</span> <span class="o">=</span> <span class="n">OrbitalType</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
        <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpeciesLike</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PeriodicSite</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">erange</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the orbital-projected band center, defined as the first moment</span>
<span class="sd">        relative to the Fermi level as:</span>
<span class="sd">            int_{-inf}^{+inf} rho(E)*E dE/int_{-inf}^{+inf} rho(E) dE.</span>

<span class="sd">        Note that the band center is often highly sensitive to the selected energy range.</span>

<span class="sd">        &quot;elements&quot; and &quot;sites&quot; cannot be used together.</span>

<span class="sd">        References:</span>
<span class="sd">            Hammer and Norskov, Surf. Sci., 343 (1995).</span>

<span class="sd">        Args:</span>
<span class="sd">            band (OrbitalType): Orbital to get the band center of (default is d-band)</span>
<span class="sd">            elements (list[SpeciesLike]): Elements to get the band center of.</span>
<span class="sd">            sites (list[PeriodicSite]): Sites to get the band center of.</span>
<span class="sd">            spin (Spin): Spin channel to use. If None, both spin channels will be combined.</span>
<span class="sd">            erange (tuple(min, max)): The energy range to consider, with respect to the</span>
<span class="sd">                Fermi level. Default to None for all energies.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The band center in eV, often denoted epsilon_d for the d-band center.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_n_moment</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span>
            <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span>
            <span class="n">band</span><span class="o">=</span><span class="n">band</span><span class="p">,</span>
            <span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">,</span>
            <span class="n">erange</span><span class="o">=</span><span class="n">erange</span><span class="p">,</span>
            <span class="n">center</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CompleteDos.get_band_width">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_band_width">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_band_width</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">band</span><span class="p">:</span> <span class="n">OrbitalType</span> <span class="o">=</span> <span class="n">OrbitalType</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
        <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpeciesLike</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PeriodicSite</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">erange</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the orbital-projected band width, defined as the square root</span>
<span class="sd">        of the second moment:</span>
<span class="sd">            sqrt(int_{-inf}^{+inf} rho(E)*(E-E_center)^2 dE/int_{-inf}^{+inf} rho(E) dE)</span>
<span class="sd">        where E_center is the orbital-projected band center.</span>

<span class="sd">        Note that the band width is often highly sensitive to the selected energy range.</span>

<span class="sd">        &quot;elements&quot; and &quot;sites&quot; cannot be used together.</span>

<span class="sd">        Args:</span>
<span class="sd">            band (OrbitalType): Orbital to get the band center of (default is d-band).</span>
<span class="sd">            elements (list[SpeciesLike]): Elements to get the band center of.</span>
<span class="sd">            sites (list[PeriodicSite]): Sites to get the band center of.</span>
<span class="sd">            spin (Spin): Spin channel to use. By default, both spin channels will be combined.</span>
<span class="sd">            erange (tuple(min, max)): The energy range to consider, with respect to the</span>
<span class="sd">                Fermi level. Default to None for all energies.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Orbital-projected band width in eV.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_n_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">band</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">,</span> <span class="n">erange</span><span class="o">=</span><span class="n">erange</span><span class="p">))</span></div>


<div class="viewcode-block" id="CompleteDos.get_band_skewness">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_band_skewness">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_band_skewness</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">band</span><span class="p">:</span> <span class="n">OrbitalType</span> <span class="o">=</span> <span class="n">OrbitalType</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
        <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpeciesLike</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PeriodicSite</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">erange</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the orbital-projected skewness, defined as the third standardized moment:</span>
<span class="sd">            int_{-inf}^{+inf} rho(E)*(E-E_center)^3 dE/int_{-inf}^{+inf} rho(E) dE)</span>
<span class="sd">            /</span>
<span class="sd">            (int_{-inf}^{+inf} rho(E)*(E-E_center)^2 dE/int_{-inf}^{+inf} rho(E) dE))^(3/2)</span>
<span class="sd">        where E_center is the orbital-projected band center.</span>

<span class="sd">        Note that the skewness is often highly sensitive to the selected energy range.</span>

<span class="sd">        &quot;elements&quot; and &quot;sites&quot; cannot be used together.</span>

<span class="sd">        Args:</span>
<span class="sd">            band (OrbitalType): Orbitals to get the band center of (default is d-band).</span>
<span class="sd">            elements (list[SpeciesLike]): Elements to get the band center of.</span>
<span class="sd">            sites (list[PeriodicSite]): Sites to get the band center of.</span>
<span class="sd">            spin (Spin): Spin channel to use. By default, both spin channels will be combined.</span>
<span class="sd">            erange (tuple(min, max)): The energy range to consider, with respect to the</span>
<span class="sd">                Fermi level. Default to None for all energies.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The orbital-projected skewness (dimensionless).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwds</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">band</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">,</span> <span class="n">erange</span><span class="o">=</span><span class="n">erange</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_n_moment</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_n_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="CompleteDos.get_band_kurtosis">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_band_kurtosis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_band_kurtosis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">band</span><span class="p">:</span> <span class="n">OrbitalType</span> <span class="o">=</span> <span class="n">OrbitalType</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
        <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpeciesLike</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PeriodicSite</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">erange</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the orbital-projected kurtosis, defined as the fourth standardized moment</span>
<span class="sd">            int_{-inf}^{+inf} rho(E)*(E-E_center)^4 dE/int_{-inf}^{+inf} rho(E) dE)</span>
<span class="sd">            /</span>
<span class="sd">            (int_{-inf}^{+inf} rho(E)*(E-E_center)^2 dE/int_{-inf}^{+inf} rho(E) dE))^2</span>
<span class="sd">        where E_center is the orbital-projected band center.</span>

<span class="sd">        Note that the kurtosis is often highly sensitive to the selected energy range.</span>

<span class="sd">        &quot;elements&quot; and &quot;sites&quot; cannot be used together.</span>

<span class="sd">        Args:</span>
<span class="sd">            band (OrbitalType): Orbitals to get the band center of (default is d-band).</span>
<span class="sd">            elements (list[SpeciesLike]): Elements to get the band center of.</span>
<span class="sd">            sites (list[PeriodicSite]): Sites to get the band center of.</span>
<span class="sd">            spin (Spin): Spin channel to use. By default, both spin channels will be combined.</span>
<span class="sd">            erange (tuple(min, max)): The energy range to consider, with respect to the</span>
<span class="sd">                Fermi level. Default to None for all energies.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The orbital-projected kurtosis (dimensionless).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwds</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">band</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">,</span> <span class="n">erange</span><span class="o">=</span><span class="n">erange</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_n_moment</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_n_moment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="CompleteDos.get_n_moment">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_n_moment">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_n_moment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">band</span><span class="p">:</span> <span class="n">OrbitalType</span> <span class="o">=</span> <span class="n">OrbitalType</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
        <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpeciesLike</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PeriodicSite</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">erange</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the nth moment of the DOS centered around the orbital-projected</span>
<span class="sd">        band center, defined as:</span>
<span class="sd">            int_{-inf}^{+inf} rho(E)*(E-E_center)^n dE/int_{-inf}^{+inf} rho(E) dE</span>
<span class="sd">        where n is the order, E_center is the orbital-projected band center, and</span>
<span class="sd">        E is the set of energies taken with respect to the Fermi level.</span>

<span class="sd">        &quot;elements&quot; and &quot;sites&quot; cannot be used together.</span>

<span class="sd">        Args:</span>
<span class="sd">            n (int): The order for the moment.</span>
<span class="sd">            band (OrbitalType): Orbital to get the band center of (default is d-band).</span>
<span class="sd">            elements (list[PeriodicSite]): Elements to get the band center of.</span>
<span class="sd">            sites (list[PeriodicSite]): Sites to get the band center of.</span>
<span class="sd">            spin (Spin): Spin channel to use. By default, both spin channels will be combined.</span>
<span class="sd">            erange (tuple(min, max)): The energy range to consider, with respect to the</span>
<span class="sd">                Fermi level. Default to None for all energies.</span>
<span class="sd">            center (bool): Take moments with respect to the band center.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Orbital-projected nth moment in eV</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the projected DOS</span>
        <span class="k">if</span> <span class="n">elements</span> <span class="ow">and</span> <span class="n">sites</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both element and site cannot be specified.&quot;</span><span class="p">)</span>

        <span class="n">densities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">elements</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                <span class="n">spd_dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_spd_dos</span><span class="p">(</span><span class="n">el</span><span class="p">)[</span><span class="n">band</span><span class="p">]</span>
                <span class="n">densities</span> <span class="o">=</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">sites</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sites</span><span class="p">):</span>
                <span class="n">spd_dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_site_spd_dos</span><span class="p">(</span><span class="n">site</span><span class="p">)[</span><span class="n">band</span><span class="p">]</span>
                <span class="n">densities</span> <span class="o">=</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spd_dos</span><span class="p">()[</span><span class="n">band</span><span class="p">]</span>

        <span class="n">energies</span> <span class="o">=</span> <span class="n">dos</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">dos</span><span class="o">.</span><span class="n">efermi</span>
        <span class="n">dos_densities</span> <span class="o">=</span> <span class="n">dos</span><span class="o">.</span><span class="n">get_densities</span><span class="p">(</span><span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dos_densities</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dos_densities is None&quot;</span><span class="p">)</span>

        <span class="c1"># Only consider a given energy range</span>
        <span class="k">if</span> <span class="n">erange</span><span class="p">:</span>
            <span class="n">dos_densities</span> <span class="o">=</span> <span class="n">dos_densities</span><span class="p">[(</span><span class="n">energies</span> <span class="o">&gt;=</span> <span class="n">erange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">energies</span> <span class="o">&lt;=</span> <span class="n">erange</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">energies</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[(</span><span class="n">energies</span> <span class="o">&gt;=</span> <span class="n">erange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">energies</span> <span class="o">&lt;=</span> <span class="n">erange</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Center the energies about the band center if requested</span>
        <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
            <span class="n">band_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_band_center</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">band</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">,</span> <span class="n">erange</span><span class="o">=</span><span class="n">erange</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">energies</span> <span class="o">-</span> <span class="n">band_center</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">energies</span>

        <span class="c1"># Take the nth moment</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">dos_densities</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">energies</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">dos_densities</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">energies</span><span class="p">)</span></div>


<div class="viewcode-block" id="CompleteDos.get_hilbert_transform">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_hilbert_transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_hilbert_transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">band</span><span class="p">:</span> <span class="n">OrbitalType</span> <span class="o">=</span> <span class="n">OrbitalType</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
        <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpeciesLike</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PeriodicSite</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Hilbert transform of the orbital-projected DOS,</span>
<span class="sd">        often plotted for a Newns-Anderson analysis.</span>

<span class="sd">        &quot;elements&quot; and &quot;sites&quot; cannot be used together.</span>

<span class="sd">        Args:</span>
<span class="sd">            band (OrbitalType): Orbital to get the band center of (default is d-band).</span>
<span class="sd">            elements (list[SpeciesLike]): Elements to get the band center of.</span>
<span class="sd">            sites (list[PeriodicSite]): Sites to get the band center of.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dos: Hilbert transformation of the projected DOS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the projected DOS</span>
        <span class="k">if</span> <span class="n">elements</span> <span class="ow">and</span> <span class="n">sites</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both element and site cannot be specified.&quot;</span><span class="p">)</span>

        <span class="n">densities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">elements</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                <span class="n">spd_dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_spd_dos</span><span class="p">(</span><span class="n">el</span><span class="p">)[</span><span class="n">band</span><span class="p">]</span>
                <span class="n">densities</span> <span class="o">=</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">sites</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sites</span><span class="p">):</span>
                <span class="n">spd_dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_site_spd_dos</span><span class="p">(</span><span class="n">site</span><span class="p">)[</span><span class="n">band</span><span class="p">]</span>
                <span class="n">densities</span> <span class="o">=</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spd_dos</span><span class="p">()[</span><span class="n">band</span><span class="p">]</span>

        <span class="c1"># Get Hilbert-transformed densities</span>
        <span class="n">densities_transformed</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">hilbert</span><span class="p">(</span><span class="n">dos</span><span class="o">.</span><span class="n">get_densities</span><span class="p">(</span><span class="n">spin</span><span class="o">=</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">)))}</span>
        <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">:</span>
            <span class="n">densities_transformed</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">hilbert</span><span class="p">(</span><span class="n">dos</span><span class="o">.</span><span class="n">get_densities</span><span class="p">(</span><span class="n">spin</span><span class="o">=</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities_transformed</span><span class="p">)</span></div>


<div class="viewcode-block" id="CompleteDos.get_upper_band_edge">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_upper_band_edge">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_upper_band_edge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">band</span><span class="p">:</span> <span class="n">OrbitalType</span> <span class="o">=</span> <span class="n">OrbitalType</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
        <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SpeciesLike</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sites</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PeriodicSite</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">erange</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the orbital-projected upper band edge.</span>

<span class="sd">        The definition by Xin et al. Phys. Rev. B, 89, 115114 (2014) is used,</span>
<span class="sd">        which is the highest peak position of the Hilbert transform of</span>
<span class="sd">        the orbital-projected DOS.</span>

<span class="sd">        &quot;elements&quot; and &quot;sites&quot; cannot be used together.</span>

<span class="sd">        Args:</span>
<span class="sd">            band (OrbitalType): Orbital to get the band center of (default is d-band).</span>
<span class="sd">            elements (list[SpeciesLike]): Elements to get the band center of.</span>
<span class="sd">            sites (list[PeriodicSite]): Sites to get the band center of.</span>
<span class="sd">            spin (Spin): Spin channel to use. Both spin channels will be combined by default.</span>
<span class="sd">            erange (tuple(min, max)): The energy range to consider, with respect to the</span>
<span class="sd">                Fermi level. Default to None for all energies.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Upper band edge in eV, often denoted epsilon_u.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get the Hilbert-transformed DOS</span>
        <span class="n">transformed_dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hilbert_transform</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">band</span><span class="p">)</span>

        <span class="n">energies</span> <span class="o">=</span> <span class="n">transformed_dos</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">transformed_dos</span><span class="o">.</span><span class="n">efermi</span>
        <span class="n">densities</span> <span class="o">=</span> <span class="n">transformed_dos</span><span class="o">.</span><span class="n">get_densities</span><span class="p">(</span><span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">densities</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;densities is None&quot;</span><span class="p">)</span>

        <span class="c1"># Only consider a given energy range, if specified</span>
        <span class="k">if</span> <span class="n">erange</span><span class="p">:</span>
            <span class="n">densities</span> <span class="o">=</span> <span class="n">densities</span><span class="p">[(</span><span class="n">energies</span> <span class="o">&gt;=</span> <span class="n">erange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">energies</span> <span class="o">&lt;=</span> <span class="n">erange</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">energies</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[(</span><span class="n">energies</span> <span class="o">&gt;=</span> <span class="n">erange</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">energies</span> <span class="o">&lt;=</span> <span class="n">erange</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Calculate the upper band edge</span>
        <span class="k">return</span> <span class="n">energies</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">densities</span><span class="p">)]</span></div>


<div class="viewcode-block" id="CompleteDos.get_dos_fp">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_dos_fp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_dos_fp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fp_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;summed_pdos&quot;</span><span class="p">,</span>
        <span class="n">binning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_e</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_e</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
        <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DosFingerprint</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the DOS fingerprint.</span>

<span class="sd">        Based on the work of:</span>
<span class="sd">            F. Knoop, T. A. r Purcell, M. Scheffler, C. Carbogno, J. Open Source Softw. 2020, 5, 2671.</span>
<span class="sd">            Source - https://gitlab.com/vibes-developers/vibes/-/tree/master/vibes/materials_fp</span>
<span class="sd">            Copyright (c) 2020 Florian Knoop, Thomas A.R.Purcell, Matthias Scheffler, Christian Carbogno.</span>

<span class="sd">        Args:</span>
<span class="sd">            fp_type (str): The FingerPrint type, can be &quot;{s/p/d/f/summed}_{pdos/tdos}&quot;</span>
<span class="sd">                (default is summed_pdos).</span>
<span class="sd">            binning (bool): Whether to bin the DOS FingerPrint using np.linspace and n_bins.</span>
<span class="sd">                Default is True.</span>
<span class="sd">            min_e (float): The minimum energy to include (default is None).</span>
<span class="sd">            max_e (float): The maximum energy to include (default is None).</span>
<span class="sd">            n_bins (int): Number of bins to be used, if binning (default is 256).</span>
<span class="sd">            normalize (bool): Whether to normalize the integrated DOS to 1. Default is True.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If &quot;fp_type&quot; is not one of the accepted values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DosFingerprint(energies, densities, type, n_bins): The DOS fingerprint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span>

        <span class="k">if</span> <span class="n">max_e</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">min_e</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">min_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>

        <span class="n">pdos_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spd_dos</span><span class="p">()</span>

        <span class="n">pdos</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">pdos_obj</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get_densities</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pdos_obj</span><span class="p">}</span>

        <span class="n">pdos</span><span class="p">[</span><span class="s2">&quot;summed_pdos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pdos</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pdos</span><span class="p">[</span><span class="s2">&quot;tdos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_densities</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">densities</span> <span class="o">=</span> <span class="n">pdos</span><span class="p">[</span><span class="n">fp_type</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">densities</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;densities is None&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_bins</span><span class="p">:</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">energies</span> <span class="o">&gt;=</span> <span class="n">min_e</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">energies</span> <span class="o">&lt;=</span> <span class="n">max_e</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">DosFingerprint</span><span class="p">(</span>
                    <span class="n">energies</span><span class="p">[</span><span class="n">inds</span><span class="p">],</span>
                    <span class="n">densities</span><span class="p">[</span><span class="n">inds</span><span class="p">],</span>
                    <span class="n">fp_type</span><span class="p">,</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">energies</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">binning</span><span class="p">:</span>
                <span class="n">ener_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_e</span><span class="p">,</span> <span class="n">max_e</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ener</span> <span class="o">=</span> <span class="n">ener_bounds</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">ener_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ener_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="n">bin_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ener</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ener_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
                <span class="n">ener</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energies</span><span class="p">,</span> <span class="p">[</span><span class="n">energies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">10</span><span class="p">])</span>
                <span class="n">n_bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
                <span class="n">bin_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">energies</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">dos_rebin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ener</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ener</span><span class="p">)),</span> <span class="n">ener_bounds</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ener_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">energies</span> <span class="o">&gt;=</span> <span class="n">e1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">energies</span> <span class="o">&lt;</span> <span class="n">e2</span><span class="p">))</span>
                <span class="n">dos_rebin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">densities</span><span class="p">[</span><span class="n">inds</span><span class="p">])</span>

            <span class="c1"># Scale DOS bins to make area under histogram equal 1</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dos_rebin</span> <span class="o">*</span> <span class="n">bin_width</span><span class="p">)</span>
                <span class="n">dos_rebin_sc</span> <span class="o">=</span> <span class="n">dos_rebin</span> <span class="o">/</span> <span class="n">area</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dos_rebin_sc</span> <span class="o">=</span> <span class="n">dos_rebin</span>

            <span class="k">return</span> <span class="n">DosFingerprint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ener</span><span class="p">]),</span> <span class="n">dos_rebin_sc</span><span class="p">,</span> <span class="n">fp_type</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">bin_width</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Please recheck fp_type requested, either the orbital projections unavailable in input DOS or &quot;</span>
                <span class="s2">&quot;there&#39;s a typo in type.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span></div>


<div class="viewcode-block" id="CompleteDos.fp_to_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.fp_to_dict">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fp_to_dict</span><span class="p">(</span><span class="n">fp</span><span class="p">:</span> <span class="n">DosFingerprint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a DOS FingerPrint into a dict.</span>

<span class="sd">        Args:</span>
<span class="sd">            fp (DosFingerprint): The DOS FingerPrint to convert.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict(Keys=type, Values=np.array(energies, densities)): The FingerPrint as dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">fp</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fp</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">}</span></div>


<div class="viewcode-block" id="CompleteDos.get_dos_fp_similarity">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.get_dos_fp_similarity">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_dos_fp_similarity</span><span class="p">(</span>
        <span class="n">fp1</span><span class="p">:</span> <span class="n">DosFingerprint</span><span class="p">,</span>
        <span class="n">fp2</span><span class="p">:</span> <span class="n">DosFingerprint</span><span class="p">,</span>
        <span class="n">col</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">pt</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;All&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;All&quot;</span><span class="p">,</span>
        <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;tanimoto&quot;</span><span class="p">,</span> <span class="s2">&quot;wasserstein&quot;</span><span class="p">,</span> <span class="s2">&quot;cosine-sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tanimoto&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the similarity index (dot product) of two DOS FingerPrints.</span>

<span class="sd">        Args:</span>
<span class="sd">            fp1 (DosFingerprint): The 1st dos fingerprint object</span>
<span class="sd">            fp2 (DosFingerprint): The 2nd dos fingerprint object</span>
<span class="sd">            col (int): The item in the fingerprints (0:energies,1: densities) to compute</span>
<span class="sd">                the similarity index of (default is 1)</span>
<span class="sd">            pt (int or str) : The index of the point that the dot product is to be taken (default is All)</span>
<span class="sd">            normalize (bool): If True normalize the scalar product to 1 (default is False)</span>
<span class="sd">            metric (Literal): Metric used to compute similarity default is &quot;tanimoto&quot;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If metric other than tanimoto, wasserstein and &quot;cosine-sim&quot; is requested.</span>
<span class="sd">            ValueError:  If normalize is set to True along with the metric.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Similarity index given by the dot product.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_metrics</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;tanimoto&quot;</span><span class="p">,</span> <span class="s2">&quot;wasserstein&quot;</span><span class="p">,</span> <span class="s2">&quot;cosine-sim&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_metrics</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid </span><span class="si">{</span><span class="n">metric</span><span class="si">=}</span><span class="s2">, choose from </span><span class="si">{</span><span class="n">valid_metrics</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">fp1_dict</span> <span class="o">=</span> <span class="n">CompleteDos</span><span class="o">.</span><span class="n">fp_to_dict</span><span class="p">(</span><span class="n">fp1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fp1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">fp1</span>
        <span class="n">fp2_dict</span> <span class="o">=</span> <span class="n">CompleteDos</span><span class="o">.</span><span class="n">fp_to_dict</span><span class="p">(</span><span class="n">fp2</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fp2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">fp2</span>

        <span class="k">if</span> <span class="n">pt</span> <span class="o">==</span> <span class="s2">&quot;All&quot;</span><span class="p">:</span>
            <span class="n">vec1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">fp1_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">vec2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">fp2_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vec1</span> <span class="o">=</span> <span class="n">fp1_dict</span><span class="p">[</span><span class="n">fp1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">pt</span><span class="p">]][</span><span class="n">col</span><span class="p">]</span>
            <span class="n">vec2</span> <span class="o">=</span> <span class="n">fp2_dict</span><span class="p">[</span><span class="n">fp2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">pt</span><span class="p">]][</span><span class="n">col</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">normalize</span> <span class="ow">and</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;tanimoto&quot;</span><span class="p">:</span>
            <span class="n">rescale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span> <span class="o">/</span> <span class="n">rescale</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">normalize</span> <span class="ow">and</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;wasserstein&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wasserstein_distance</span><span class="p">(</span>
                <span class="n">u_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">vec1</span> <span class="o">*</span> <span class="n">fp1</span><span class="o">.</span><span class="n">bin_width</span><span class="p">),</span>
                <span class="n">v_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">vec2</span> <span class="o">*</span> <span class="n">fp2</span><span class="o">.</span><span class="n">bin_width</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">normalize</span> <span class="ow">and</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;cosine-sim&quot;</span><span class="p">:</span>
            <span class="n">rescale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span> <span class="o">/</span> <span class="n">rescale</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">normalize</span> <span class="ow">and</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;cosine-sim&quot;</span><span class="p">:</span>
            <span class="n">rescale</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span> <span class="o">/</span> <span class="n">rescale</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute similarity index. When normalize=True, then please set metric=cosine-sim&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CompleteDos.from_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get CompleteDos object from dict representation.&quot;&quot;&quot;</span>
        <span class="n">tdos</span> <span class="o">=</span> <span class="n">Dos</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">])</span>
        <span class="n">pdoss</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;pdos&quot;</span><span class="p">])):</span>
            <span class="n">at</span> <span class="o">=</span> <span class="n">struct</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">orb_dos</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">orb_str</span><span class="p">,</span> <span class="n">odos</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;pdos&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">orb</span> <span class="o">=</span> <span class="n">Orbital</span><span class="p">[</span><span class="n">orb_str</span><span class="p">]</span>
                <span class="n">orb_dos</span><span class="p">[</span><span class="n">orb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">odos</span><span class="p">[</span><span class="s2">&quot;densities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">pdoss</span><span class="p">[</span><span class="n">at</span><span class="p">]</span> <span class="o">=</span> <span class="n">orb_dos</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">tdos</span><span class="p">,</span> <span class="n">pdoss</span><span class="p">)</span></div>


<div class="viewcode-block" id="CompleteDos.as_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.CompleteDos.as_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;JSON-serializable dict representation of CompleteDos.&quot;&quot;&quot;</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
            <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;efermi&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>
            <span class="s2">&quot;energies&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;densities&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">dens</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">dens</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
            <span class="s2">&quot;pdos&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">:</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">pdos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">[</span><span class="n">at</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">dd</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">orb</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;densities&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spin</span><span class="p">)):</span> <span class="nb">list</span><span class="p">(</span><span class="n">dens</span><span class="p">)</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">dens</span> <span class="ow">in</span> <span class="n">pdos</span><span class="o">.</span><span class="n">items</span><span class="p">()}}</span>
                <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;pdos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;atom_dos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">at</span><span class="p">):</span> <span class="n">dos</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">at</span><span class="p">,</span> <span class="n">dos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_element_dos</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;spd_dos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">orb</span><span class="p">):</span> <span class="n">dos</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">dos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spd_dos</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">dct</span></div>
</div>



<span class="n">_lobster_orb_labs</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="s2">&quot;p_y&quot;</span><span class="p">,</span>
    <span class="s2">&quot;p_z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;p_x&quot;</span><span class="p">,</span>
    <span class="s2">&quot;d_xy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;d_yz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;d_z^2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;d_xz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;d_x^2-y^2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f_y(3x^2-y^2)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f_xyz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f_yz^2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f_z^3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f_xz^2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f_z(x^2-y^2)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;f_x(x^2-3y^2)&quot;</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="LobsterCompleteDos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.LobsterCompleteDos">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LobsterCompleteDos</span><span class="p">(</span><span class="n">CompleteDos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extended CompleteDos for LOBSTER.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="LobsterCompleteDos.get_site_orbital_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.LobsterCompleteDos.get_site_orbital_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_site_orbital_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span><span class="p">:</span> <span class="n">PeriodicSite</span><span class="p">,</span> <span class="n">orbital</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the DOS for a particular orbital of a particular site.</span>

<span class="sd">        Args:</span>
<span class="sd">            site (PeriodicSite): Site in Structure associated with LobsterCompleteDos.</span>
<span class="sd">            orbital (str): Principal quantum number and orbital, e.g. &quot;4s&quot;.</span>
<span class="sd">                    Possible orbitals are: &quot;s&quot;, &quot;p_y&quot;, &quot;p_z&quot;, &quot;p_x&quot;, &quot;d_xy&quot;, &quot;d_yz&quot;, &quot;d_z^2&quot;,</span>
<span class="sd">                        &quot;d_xz&quot;, &quot;d_x^2-y^2&quot;, &quot;f_y(3x^2-y^2)&quot;, &quot;f_xyz&quot;,</span>
<span class="sd">                        &quot;f_yz^2&quot;, &quot;f_z^3&quot;, &quot;f_xz^2&quot;, &quot;f_z(x^2-y^2)&quot;, &quot;f_x(x^2-3y^2)&quot;.</span>
<span class="sd">                    In contrast to the Cohpcar and the Cohplist objects,</span>
<span class="sd">                        the strings from the LOBSTER files are used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dos: DOS of an orbital of a specific site.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">orbital</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_lobster_orb_labs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;orbital is not correct&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">orbital</span><span class="p">])</span>  <span class="c1"># type: ignore[index]</span></div>


<div class="viewcode-block" id="LobsterCompleteDos.get_site_t2g_eg_resolved_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.LobsterCompleteDos.get_site_t2g_eg_resolved_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_site_t2g_eg_resolved_dos</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">site</span><span class="p">:</span> <span class="n">PeriodicSite</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;e_g&quot;</span><span class="p">,</span> <span class="s2">&quot;t2g&quot;</span><span class="p">],</span> <span class="n">Dos</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the t2g/e_g projected DOS for a particular site.</span>

<span class="sd">        Args:</span>
<span class="sd">            site (PeriodicSite): Site in Structure associated with LobsterCompleteDos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[Literal[&quot;e_g&quot;, &quot;t2g&quot;], Dos]: Summed e_g and t2g DOS for the site.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Are the orbitals correctly oriented? Are you sure?&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">t2g_dos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">eg_dos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">atom_dos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">site</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">pdos</span> <span class="ow">in</span> <span class="n">atom_dos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">orbital</span> <span class="o">=</span> <span class="n">_get_orb_lobster</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">orb</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">orbital</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;orbital is None&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">orbital</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Orbital</span><span class="o">.</span><span class="n">dxy</span><span class="p">,</span> <span class="n">Orbital</span><span class="o">.</span><span class="n">dxz</span><span class="p">,</span> <span class="n">Orbital</span><span class="o">.</span><span class="n">dyz</span><span class="p">):</span>
                        <span class="n">t2g_dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdos</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">orbital</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Orbital</span><span class="o">.</span><span class="n">dx2</span><span class="p">,</span> <span class="n">Orbital</span><span class="o">.</span><span class="n">dz2</span><span class="p">):</span>
                        <span class="n">eg_dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdos</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;t2g&quot;</span><span class="p">:</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">add_densities</span><span class="p">,</span> <span class="n">t2g_dos</span><span class="p">)),</span>
            <span class="s2">&quot;e_g&quot;</span><span class="p">:</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">add_densities</span><span class="p">,</span> <span class="n">eg_dos</span><span class="p">)),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="LobsterCompleteDos.get_spd_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.LobsterCompleteDos.get_spd_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_spd_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dos</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get orbital projected DOS.</span>

<span class="sd">        For example, if 3s and 4s are included in the basis of some element,</span>
<span class="sd">        they will be both summed in the orbital projected DOS.</span>

<span class="sd">        Returns:</span>
<span class="sd">            {orbital: Dos}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spd_dos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">orb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">atom_dos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">pdos</span> <span class="ow">in</span> <span class="n">atom_dos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">orbital_type</span> <span class="o">=</span> <span class="n">_get_orb_type_lobster</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">orb</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">orbital_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spd_dos</span><span class="p">:</span>
                    <span class="n">spd_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdos</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">spd_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">spd_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">],</span> <span class="n">pdos</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">orb</span><span class="p">:</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span> <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">densities</span> <span class="ow">in</span> <span class="n">spd_dos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>  <span class="c1"># type: ignore[misc]</span></div>


<div class="viewcode-block" id="LobsterCompleteDos.get_element_spd_dos">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.LobsterCompleteDos.get_element_spd_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_element_spd_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">:</span> <span class="n">SpeciesLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dos</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get element and s/p/d projected DOS.</span>

<span class="sd">        Args:</span>
<span class="sd">            el (SpeciesLike): Element associated with LobsterCompleteDos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict of {OrbitalType.s: Dos, OrbitalType.p: Dos, OrbitalType.d: Dos}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">get_el_sp</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="n">el_dos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">atom_dos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">site</span><span class="o">.</span><span class="n">specie</span> <span class="o">==</span> <span class="n">el</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">pdos</span> <span class="ow">in</span> <span class="n">atom_dos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">orbital_type</span> <span class="o">=</span> <span class="n">_get_orb_type_lobster</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">orb</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">orbital_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">el_dos</span><span class="p">:</span>
                        <span class="n">el_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdos</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">el_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_densities</span><span class="p">(</span><span class="n">el_dos</span><span class="p">[</span><span class="n">orbital_type</span><span class="p">],</span> <span class="n">pdos</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">orb</span><span class="p">:</span> <span class="n">Dos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span> <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">densities</span> <span class="ow">in</span> <span class="n">el_dos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>  <span class="c1"># type: ignore[misc]</span></div>


<div class="viewcode-block" id="LobsterCompleteDos.from_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.LobsterCompleteDos.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get LobsterCompleteDos from a dict representation.&quot;&quot;&quot;</span>
        <span class="n">tdos</span> <span class="o">=</span> <span class="n">Dos</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">])</span>
        <span class="n">pdos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;pdos&quot;</span><span class="p">])):</span>
            <span class="n">pdos</span><span class="p">[</span><span class="n">struct</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">orb_str</span><span class="p">:</span> <span class="p">{</span><span class="n">Spin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">odos</span><span class="p">[</span><span class="s2">&quot;densities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="k">for</span> <span class="n">orb_str</span><span class="p">,</span> <span class="n">odos</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;pdos&quot;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">tdos</span><span class="p">,</span> <span class="n">pdos</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="add_densities">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.add_densities">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_densities</span><span class="p">(</span>
    <span class="n">density1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">],</span>
    <span class="n">density2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sum two DOS along each spin channel.</span>

<span class="sd">    Args:</span>
<span class="sd">        density1 (dict[Spin, NDArray]): First DOS.</span>
<span class="sd">        density2 (dict[Spin, NDArray]): Second DOS.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[Spin, NDArray]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">density1</span><span class="p">[</span><span class="n">spin</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">density2</span><span class="p">[</span><span class="n">spin</span><span class="p">])</span> <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="n">density1</span><span class="p">}</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_get_orb_type</span><span class="p">(</span><span class="n">orb</span><span class="p">:</span> <span class="n">Orbital</span> <span class="o">|</span> <span class="n">OrbitalType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrbitalType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get OrbitalType.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">Orbital</span><span class="p">,</span> <span class="n">orb</span><span class="p">)</span><span class="o">.</span><span class="n">orbital_type</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">OrbitalType</span><span class="p">,</span> <span class="n">orb</span><span class="p">)</span>


<div class="viewcode-block" id="f0">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.dos.f0">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">f0</span><span class="p">(</span><span class="n">E</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">fermi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fermi-Dirac distribution function.</span>

<span class="sd">    Args:</span>
<span class="sd">        E (float): Energy in eV.</span>
<span class="sd">        fermi (float): The Fermi level in eV.</span>
<span class="sd">        T (float): The temperature in kelvin.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The Fermi-Dirac occupation probability at energy E.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exponent</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span> <span class="o">-</span> <span class="n">fermi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">_constant</span><span class="p">(</span><span class="s2">&quot;Boltzmann constant in eV/K&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">expit</span><span class="p">(</span><span class="o">-</span><span class="n">exponent</span><span class="p">)</span>  <span class="c1"># scipy logistic sigmoid function; expit(x) = 1/(1+exp(-x))</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_get_orb_type_lobster</span><span class="p">(</span><span class="n">orb</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrbitalType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get OrbitalType from str representation of the orbital.</span>

<span class="sd">    Args:</span>
<span class="sd">        orb (str): String representation of the orbital.</span>

<span class="sd">    Returns:</span>
<span class="sd">        OrbitalType</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">orbital</span> <span class="o">=</span> <span class="n">Orbital</span><span class="p">(</span><span class="n">_lobster_orb_labs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">orb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="k">return</span> <span class="n">orbital</span><span class="o">.</span><span class="n">orbital_type</span>

    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orb not in list&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_orb_lobster</span><span class="p">(</span><span class="n">orb</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Orbital</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Orbital from str representation of the orbital.</span>

<span class="sd">    Args:</span>
<span class="sd">        orb (str): String representation of the orbital.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pymatgen.electronic_structure.core.Orbital</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Orbital</span><span class="p">(</span><span class="n">_lobster_orb_labs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">orb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>

    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orb not in list&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.electronic_structure.dos</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>