<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymatgen.electronic_structure.cohp &#8212; pymatgen 2025.1.24 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=5c69cfe2" />
    <script src="../../../_static/documentation_options.js?v=d2bc030c"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.electronic_structure.cohp</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.electronic_structure.cohp</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module defines classes to represent:</span>
<span class="sd">    - Crystal orbital Hamilton population (COHP) and integrated COHP (ICOHP).</span>
<span class="sd">    - Crystal orbital overlap population (COOP).</span>
<span class="sd">    - Crystal orbital bond index (COBI).</span>

<span class="sd">If you use this module, please cite:</span>
<span class="sd">J. George, G. Petretto, A. Naik, M. Esters, A. J. Jackson, R. Nelson, R. Dronskowski, G.-M. Rignanese, G. Hautier,</span>
<span class="sd">&quot;Automated Bonding Analysis with Crystal Orbital Hamilton Populations&quot;,</span>
<span class="sd">ChemPlusChem 2022, e202200123,</span>
<span class="sd">DOI: 10.1002/cplu.202200123.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.json</span><span class="w"> </span><span class="kn">import</span> <span class="n">MSONable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterpolatedUnivariateSpline</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.sites</span><span class="w"> </span><span class="kn">import</span> <span class="n">PeriodicSite</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.structure</span><span class="w"> </span><span class="kn">import</span> <span class="n">Structure</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.electronic_structure.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">Orbital</span><span class="p">,</span> <span class="n">Spin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.lmto</span><span class="w"> </span><span class="kn">import</span> <span class="n">LMTOCopl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.lobster</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cohpcar</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.coord</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_linear_interpolated_value</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.due</span><span class="w"> </span><span class="kn">import</span> <span class="n">Doi</span><span class="p">,</span> <span class="n">due</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.num</span><span class="w"> </span><span class="kn">import</span> <span class="n">round_to_sigfigs</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Literal</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NDArray</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Self</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">PathLike</span><span class="p">,</span> <span class="n">SpinLike</span><span class="p">,</span> <span class="n">Vector3D</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Marco Esters, Janine George&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2017, The Materials Project&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.2&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Janine George&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;janinegeorge.ulfen@gmail.com&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;Dec 13, 2017&quot;</span>

<span class="n">due</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span>
    <span class="n">Doi</span><span class="p">(</span><span class="s2">&quot;10.1002/cplu.202200123&quot;</span><span class="p">),</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Automated Bonding Analysis with Crystal Orbital Hamilton Populations&quot;</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="Cohp">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.Cohp">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Cohp</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic COHP object.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">efermi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">energies</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">cohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">],</span>
        <span class="n">are_coops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_multi_center_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">icohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            efermi (float): The Fermi level.</span>
<span class="sd">            energies (Sequence[float]): Energies.</span>
<span class="sd">            cohp ({Spin: NDArrary}): The COHP for each spin.</span>
<span class="sd">            are_coops (bool): Whether this object describes COOPs.</span>
<span class="sd">            are_cobis (bool): Whether this object describes COBIs.</span>
<span class="sd">            are_multi_center_cobis (bool): Whether this object describes multi-center COBIs.</span>
<span class="sd">            icohp ({Spin: NDArrary}): The ICOHP for each spin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">are_coops</span> <span class="o">=</span> <span class="n">are_coops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">are_cobis</span> <span class="o">=</span> <span class="n">are_cobis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">are_multi_center_cobis</span> <span class="o">=</span> <span class="n">are_multi_center_cobis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="n">efermi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span> <span class="o">=</span> <span class="n">cohp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">icohp</span> <span class="o">=</span> <span class="n">icohp</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A string that can be easily plotted (e.g. using gnuplot).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_coops</span><span class="p">:</span>
            <span class="n">cohp_str</span> <span class="o">=</span> <span class="s2">&quot;COOP&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_cobis</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_multi_center_cobis</span><span class="p">:</span>
            <span class="n">cohp_str</span> <span class="o">=</span> <span class="s2">&quot;COBI&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cohp_str</span> <span class="o">=</span> <span class="s2">&quot;COHP&quot;</span>

        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Energy&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohp_str</span><span class="si">}</span><span class="s2">Up&quot;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span><span class="p">:</span>
            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cohp_str</span><span class="si">}</span><span class="s2">Down&quot;</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">icohp</span><span class="p">:</span>
            <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I</span><span class="si">{</span><span class="n">cohp_str</span><span class="si">}</span><span class="s2">Up&quot;</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span><span class="p">:</span>
                <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I</span><span class="si">{</span><span class="n">cohp_str</span><span class="si">}</span><span class="s2">Down&quot;</span><span class="p">)</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">])</span>
        <span class="n">format_header</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:15s}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">__</span> <span class="ow">in</span> <span class="n">header</span><span class="p">)</span>
        <span class="n">format_data</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.5f}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">__</span> <span class="ow">in</span> <span class="n">header</span><span class="p">)</span>
        <span class="n">str_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">format_header</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">header</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">)):</span>
            <span class="n">str_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_data</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_arr</span><span class="p">)</span>

<div class="viewcode-block" id="Cohp.as_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.Cohp.as_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;JSON-serializable dict representation of COHP.&quot;&quot;&quot;</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
            <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;are_coops&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_coops</span><span class="p">,</span>
            <span class="s2">&quot;are_cobis&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_cobis</span><span class="p">,</span>
            <span class="s2">&quot;are_multi_center_cobis&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_multi_center_cobis</span><span class="p">,</span>
            <span class="s2">&quot;efermi&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="s2">&quot;energies&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">pops</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">pops</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">icohp</span><span class="p">:</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">pops</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">pops</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">icohp</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">dct</span></div>


<div class="viewcode-block" id="Cohp.get_cohp">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.Cohp.get_cohp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cohp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">SpinLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">integrated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the COHP or ICOHP for a particular spin.</span>

<span class="sd">        Args:</span>
<span class="sd">            spin (SpinLike): Selected spin. If is None and both</span>
<span class="sd">                spins are present, both will be returned.</span>
<span class="sd">            integrated: Return ICOHP (True) or COHP (False).</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The COHP or ICOHP for the selected spin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">populations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">icohp</span> <span class="k">if</span> <span class="n">integrated</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span>

        <span class="k">if</span> <span class="n">populations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">populations</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spin</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="p">({</span><span class="s2">&quot;up&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}[</span><span class="n">spin</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">populations</span><span class="p">[</span><span class="n">spin</span><span class="p">]}</span></div>


<div class="viewcode-block" id="Cohp.get_icohp">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.Cohp.get_icohp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_icohp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">SpinLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convenient wrapper to get the ICOHP for a particular spin.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cohp</span><span class="p">(</span><span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">,</span> <span class="n">integrated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="Cohp.get_interpolated_value">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.Cohp.get_interpolated_value">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_interpolated_value</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">energy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">integrated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the interpolated COHP for a particular energy.</span>

<span class="sd">        Args:</span>
<span class="sd">            energy (float): Energy to get the COHP value for.</span>
<span class="sd">            integrated (bool): Return ICOHP (True) or COHP (False).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">integrated</span><span class="p">:</span>
                <span class="n">inters</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_linear_interpolated_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span><span class="p">[</span><span class="n">spin</span><span class="p">],</span> <span class="n">energy</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">icohp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">inters</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_linear_interpolated_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">icohp</span><span class="p">[</span><span class="n">spin</span><span class="p">],</span> <span class="n">energy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ICOHP is empty.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inters</span></div>


<div class="viewcode-block" id="Cohp.has_antibnd_states_below_efermi">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.Cohp.has_antibnd_states_below_efermi">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_antibnd_states_below_efermi</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">SpinLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get dict of antibonding states below the Fermi level for the spin.</span>

<span class="sd">        Args:</span>
<span class="sd">            spin (SpinLike): Selected spin.</span>
<span class="sd">            limit (float): Only COHP higher than this value will be considered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">populations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span>
        <span class="n">n_energies_below_efermi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">energy</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">populations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">dict_to_return</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">cohp_vals</span> <span class="ow">in</span> <span class="n">populations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># NOTE: Casting to bool is necessary, otherwise ended up</span>
                <span class="c1"># getting &quot;bool_&quot; instead of &quot;bool&quot; from NumPy</span>
                <span class="n">dict_to_return</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">cohp_vals</span><span class="p">[:</span><span class="n">n_energies_below_efermi</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spin</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="p">({</span><span class="s2">&quot;up&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}[</span><span class="n">spin</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
            <span class="n">dict_to_return</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">populations</span><span class="p">[</span><span class="n">spin</span><span class="p">][:</span><span class="n">n_energies_below_efermi</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dict_to_return</span></div>


<div class="viewcode-block" id="Cohp.from_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.Cohp.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate Cohp from a dict representation.&quot;&quot;&quot;</span>
        <span class="n">icohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="k">if</span> <span class="s2">&quot;ICOHP&quot;</span> <span class="ow">in</span> <span class="n">dct</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;efermi&quot;</span><span class="p">],</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">],</span>
            <span class="p">{</span><span class="n">Spin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
            <span class="n">icohp</span><span class="o">=</span><span class="n">icohp</span><span class="p">,</span>
            <span class="n">are_coops</span><span class="o">=</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;are_coops&quot;</span><span class="p">],</span>
            <span class="n">are_cobis</span><span class="o">=</span><span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;are_cobis&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">are_multi_center_cobis</span><span class="o">=</span><span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;are_multi_center_cobis&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CompleteCohp">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.CompleteCohp">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CompleteCohp</span><span class="p">(</span><span class="n">Cohp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A wrapper that defines an average COHP, and individual COHPs.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        are_coops (bool): Whether the object consists of COOPs.</span>
<span class="sd">        are_cobis (bool): Whether the object consists of COBIs.</span>
<span class="sd">        efermi (float): The Fermi level.</span>
<span class="sd">        energies (Sequence[float]): Sequence of energies.</span>
<span class="sd">        structure (Structure): Structure associated with the COHPs.</span>
<span class="sd">        cohp (Sequence[float]): The average COHP.</span>
<span class="sd">        icohp (Sequence[float]): The average ICOHP.</span>
<span class="sd">        all_cohps (dict[str, Sequence[float]]): COHPs for individual bonds of the form {label: COHP}.</span>
<span class="sd">        orb_res_cohp (dict[str, Dict[str, Sequence[float]]]): Orbital-resolved COHPs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
        <span class="n">avg_cohp</span><span class="p">:</span> <span class="n">Cohp</span><span class="p">,</span>
        <span class="n">cohp_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Cohp</span><span class="p">],</span>
        <span class="n">bonds</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">are_coops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_multi_center_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">orb_res_cohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure (Structure): Structure associated with this COHP.</span>
<span class="sd">            avg_cohp (Cohp): The average COHP.</span>
<span class="sd">            cohp_dict (dict[str, Cohp]): COHP for individual bonds of the form</span>
<span class="sd">                {label: COHP}.</span>
<span class="sd">            bonds (dict[str, Any]): Information on the bonds of the form</span>
<span class="sd">                {label: {key: val}}. The value can be any information,</span>
<span class="sd">                but typically contains the sites, the bond length,</span>
<span class="sd">                and the number of bonds. If nothing is</span>
<span class="sd">                supplied, it will default to an empty dict.</span>
<span class="sd">            are_coops (bool): Whether the Cohp objects are COOPs.</span>
<span class="sd">                Defaults to False for COHPs.</span>
<span class="sd">            are_cobis (bool): Whether the Cohp objects are COBIs.</span>
<span class="sd">                Defaults to False for COHPs.</span>
<span class="sd">            are_multi_center_cobis (bool): Whether the Cohp objects are multi-center COBIs.</span>
<span class="sd">                Defaults to False for COHPs.</span>
<span class="sd">            orb_res_cohp (dict): Orbital-resolved COHPs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">are_coops</span> <span class="ow">and</span> <span class="n">are_cobis</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">are_coops</span> <span class="ow">and</span> <span class="n">are_multi_center_cobis</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">are_cobis</span> <span class="ow">and</span> <span class="n">are_multi_center_cobis</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot have info about COOPs, COBIs and/or multi-center COBIS in the same file.&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">avg_cohp</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="n">avg_cohp</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span>
            <span class="n">avg_cohp</span><span class="o">.</span><span class="n">cohp</span><span class="p">,</span>
            <span class="n">are_coops</span><span class="o">=</span><span class="n">are_coops</span><span class="p">,</span>
            <span class="n">are_cobis</span><span class="o">=</span><span class="n">are_cobis</span><span class="p">,</span>
            <span class="n">are_multi_center_cobis</span><span class="o">=</span><span class="n">are_multi_center_cobis</span><span class="p">,</span>
            <span class="n">icohp</span><span class="o">=</span><span class="n">avg_cohp</span><span class="o">.</span><span class="n">icohp</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">are_coops</span> <span class="o">=</span> <span class="n">are_coops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">are_cobis</span> <span class="o">=</span> <span class="n">are_cobis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">are_multi_center_cobis</span> <span class="o">=</span> <span class="n">are_multi_center_cobis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_cohps</span> <span class="o">=</span> <span class="n">cohp_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span> <span class="o">=</span> <span class="n">orb_res_cohp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">=</span> <span class="n">bonds</span> <span class="ow">or</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_cohps</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_coops</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;COOPs&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_cobis</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;COBIs&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;COHPs&quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Complete </span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="CompleteCohp.as_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.CompleteCohp.as_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;JSON-serializable dict representation of CompleteCohp.&quot;&quot;&quot;</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
            <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;are_coops&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_coops</span><span class="p">,</span>
            <span class="s2">&quot;are_cobis&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_cobis</span><span class="p">,</span>
            <span class="s2">&quot;are_multi_center_cobis&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_multi_center_cobis</span><span class="p">,</span>
            <span class="s2">&quot;efermi&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>
            <span class="s2">&quot;energies&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">pops</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">pops</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span><span class="o">.</span><span class="n">items</span><span class="p">()}},</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">icohp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">pops</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">pops</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">icohp</span><span class="o">.</span><span class="n">items</span><span class="p">()}}</span>

        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_cohps</span><span class="p">:</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">]</span> <span class="o">|=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">pops</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">pops</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_cohps</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">cohp</span><span class="o">.</span><span class="n">items</span><span class="p">()}}</span>
            <span class="n">icohp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_cohps</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">icohp</span>
            <span class="k">if</span> <span class="n">icohp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;ICOHP&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
                    <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">pops</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">pops</span> <span class="ow">in</span> <span class="n">icohp</span><span class="o">.</span><span class="n">items</span><span class="p">()}}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span> <span class="o">|=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">pops</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">pops</span> <span class="ow">in</span> <span class="n">icohp</span><span class="o">.</span><span class="n">items</span><span class="p">()}}</span>

        <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bond_dict</span> <span class="o">==</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">bond_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">values</span><span class="p">()]:</span>
            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;bonds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">bond</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="n">bond</span><span class="p">][</span><span class="s2">&quot;length&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="n">bond</span><span class="p">][</span><span class="s2">&quot;sites&quot;</span><span class="p">]],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span><span class="p">:</span>
            <span class="n">orb_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span><span class="p">:</span>
                <span class="n">orb_dict</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">orbs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]:</span>
                    <span class="n">orb_dict</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orbs</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">pops</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">pops</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orbs</span><span class="p">][</span><span class="s2">&quot;COHP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">):</span> <span class="n">pops</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">pops</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orbs</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="n">orb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orbs</span><span class="p">][</span><span class="s2">&quot;orbitals&quot;</span><span class="p">]],</span>
                    <span class="p">}</span>

            <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;orb_res_cohp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orb_dict</span>

        <span class="k">return</span> <span class="n">dct</span></div>


<div class="viewcode-block" id="CompleteCohp.get_cohp_by_label">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.CompleteCohp.get_cohp_by_label">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_cohp_by_label</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">summed_spin_channels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Cohp</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get specific Cohp by the label, to simplify plotting.</span>

<span class="sd">        Args:</span>
<span class="sd">            label (str): Label for the interaction.</span>
<span class="sd">            summed_spin_channels (bool): Sum the spin channels and return the sum as Spin.up.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Cohp.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;average&quot;</span><span class="p">:</span>
            <span class="n">divided_cohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span>
            <span class="n">divided_icohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">icohp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">divided_cohp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_cohps</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">get_cohp</span><span class="p">(</span><span class="n">spin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">integrated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">divided_icohp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_cohps</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">get_icohp</span><span class="p">(</span><span class="n">spin</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">divided_cohp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;divided_cohp is None&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">summed_spin_channels</span> <span class="ow">and</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cohp</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">divided_icohp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;divided_icohp is None&quot;</span><span class="p">)</span>
            <span class="n">final_cohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">divided_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">divided_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)}</span>
            <span class="n">final_icohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">divided_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">divided_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_cohp</span> <span class="o">=</span> <span class="n">divided_cohp</span>
            <span class="n">final_icohp</span> <span class="o">=</span> <span class="n">divided_icohp</span>

        <span class="k">return</span> <span class="n">Cohp</span><span class="p">(</span>
            <span class="n">efermi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="n">energies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span>
            <span class="n">cohp</span><span class="o">=</span><span class="n">final_cohp</span><span class="p">,</span>
            <span class="n">are_coops</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">are_coops</span><span class="p">,</span>
            <span class="n">are_cobis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">are_cobis</span><span class="p">,</span>
            <span class="n">icohp</span><span class="o">=</span><span class="n">final_icohp</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CompleteCohp.get_summed_cohp_by_label_list">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.CompleteCohp.get_summed_cohp_by_label_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_summed_cohp_by_label_list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">label_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">divisor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">summed_spin_channels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Cohp</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a Cohp object that includes a summed COHP divided by divisor.</span>

<span class="sd">        Args:</span>
<span class="sd">            label_list (list[str]): Labels for the COHP to include.</span>
<span class="sd">            divisor (float): The summed COHP will be divided by this divisor.</span>
<span class="sd">            summed_spin_channels (bool): Sum the spin channels and return the sum in Spin.up.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Cohp object for the summed COHP.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if COHPs are spin polarized</span>
        <span class="n">first_cohpobject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cohp_by_label</span><span class="p">(</span><span class="n">label_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">summed_cohp</span> <span class="o">=</span> <span class="n">first_cohpobject</span><span class="o">.</span><span class="n">cohp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">first_cohpobject</span><span class="o">.</span><span class="n">icohp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;icohp of first_cohpobject is None&quot;</span><span class="p">)</span>
        <span class="n">summed_icohp</span> <span class="o">=</span> <span class="n">first_cohpobject</span><span class="o">.</span><span class="n">icohp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">cohp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cohp_by_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">icohp</span> <span class="o">=</span> <span class="n">cohp</span><span class="o">.</span><span class="n">icohp</span>
            <span class="k">if</span> <span class="n">icohp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;icohp is None&quot;</span><span class="p">)</span>

            <span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">cohp</span><span class="o">.</span><span class="n">cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">summed_cohp</span><span class="p">:</span>
                <span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">cohp</span><span class="o">.</span><span class="n">cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">summed_icohp</span><span class="p">:</span>
                <span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">divided_cohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">divisor</span><span class="p">)}</span>
        <span class="n">divided_icohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">divisor</span><span class="p">)}</span>
        <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">summed_cohp</span><span class="p">:</span>
            <span class="n">divided_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">divisor</span><span class="p">)</span>
            <span class="n">divided_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">divisor</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">summed_spin_channels</span> <span class="ow">and</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">summed_cohp</span><span class="p">:</span>
            <span class="n">final_cohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">divided_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">divided_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)}</span>
            <span class="n">final_icohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">divided_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">divided_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_cohp</span> <span class="o">=</span> <span class="n">divided_cohp</span>
            <span class="n">final_icohp</span> <span class="o">=</span> <span class="n">divided_icohp</span>

        <span class="k">return</span> <span class="n">Cohp</span><span class="p">(</span>
            <span class="n">efermi</span><span class="o">=</span><span class="n">first_cohpobject</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="n">energies</span><span class="o">=</span><span class="n">first_cohpobject</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span>
            <span class="n">cohp</span><span class="o">=</span><span class="n">final_cohp</span><span class="p">,</span>
            <span class="n">are_coops</span><span class="o">=</span><span class="n">first_cohpobject</span><span class="o">.</span><span class="n">are_coops</span><span class="p">,</span>
            <span class="n">are_cobis</span><span class="o">=</span><span class="n">first_cohpobject</span><span class="o">.</span><span class="n">are_coops</span><span class="p">,</span>
            <span class="n">icohp</span><span class="o">=</span><span class="n">final_icohp</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CompleteCohp.get_summed_cohp_by_label_and_orbital_list">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.CompleteCohp.get_summed_cohp_by_label_and_orbital_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_summed_cohp_by_label_and_orbital_list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">label_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">orbital_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">divisor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">summed_spin_channels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Cohp</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a Cohp object that includes a summed COHP divided by divisor.</span>

<span class="sd">        Args:</span>
<span class="sd">            label_list (list[str]): Labels for the COHP that should be included.</span>
<span class="sd">            orbital_list (list[str]): Orbitals for the COHPs that should be included</span>
<span class="sd">                (same order as label_list).</span>
<span class="sd">            divisor (float): The summed COHP will be divided by this divisor.</span>
<span class="sd">            summed_spin_channels (bool): Sum the spin channels and return the sum in Spin.up.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Cohp object including the summed COHP.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check length of label_list and orbital_list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">label_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">orbital_list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;label_list and orbital_list don&#39;t have the same length!&quot;</span><span class="p">)</span>

        <span class="c1"># Check if COHPs are spin polarized</span>
        <span class="n">first_cohpobject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orbital_resolved_cohp</span><span class="p">(</span><span class="n">label_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orbital_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">first_cohpobject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;first_cohpobject is None&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">first_cohpobject</span><span class="o">.</span><span class="n">icohp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;icohp of first_cohpobject is None&quot;</span><span class="p">)</span>
        <span class="n">summed_cohp</span> <span class="o">=</span> <span class="n">first_cohpobject</span><span class="o">.</span><span class="n">cohp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">summed_icohp</span> <span class="o">=</span> <span class="n">first_cohpobject</span><span class="o">.</span><span class="n">icohp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">cohp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orbital_resolved_cohp</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">orbital_list</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">cohp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cohp is None.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cohp</span><span class="o">.</span><span class="n">icohp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;icohp of cohp is None.&quot;</span><span class="p">)</span>
            <span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">cohp</span><span class="o">.</span><span class="n">cohp</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">summed_cohp</span><span class="p">:</span>
                <span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">cohp</span><span class="o">.</span><span class="n">cohp</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">cohp</span><span class="o">.</span><span class="n">icohp</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">summed_icohp</span><span class="p">:</span>
                <span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">cohp</span><span class="o">.</span><span class="n">icohp</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">divided_cohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">divisor</span><span class="p">)}</span>
        <span class="n">divided_icohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">divisor</span><span class="p">)}</span>
        <span class="k">if</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">summed_cohp</span><span class="p">:</span>
            <span class="n">divided_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">summed_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">divisor</span><span class="p">)</span>
            <span class="n">divided_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">summed_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">divisor</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">summed_spin_channels</span> <span class="ow">and</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">divided_cohp</span><span class="p">:</span>
            <span class="n">final_cohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">divided_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">divided_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)}</span>
            <span class="n">final_icohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">divided_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">divided_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_cohp</span> <span class="o">=</span> <span class="n">divided_cohp</span>
            <span class="n">final_icohp</span> <span class="o">=</span> <span class="n">divided_icohp</span>

        <span class="k">return</span> <span class="n">Cohp</span><span class="p">(</span>
            <span class="n">efermi</span><span class="o">=</span><span class="n">first_cohpobject</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="n">energies</span><span class="o">=</span><span class="n">first_cohpobject</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span>
            <span class="n">cohp</span><span class="o">=</span><span class="n">final_cohp</span><span class="p">,</span>
            <span class="n">are_coops</span><span class="o">=</span><span class="n">first_cohpobject</span><span class="o">.</span><span class="n">are_coops</span><span class="p">,</span>
            <span class="n">are_cobis</span><span class="o">=</span><span class="n">first_cohpobject</span><span class="o">.</span><span class="n">are_cobis</span><span class="p">,</span>
            <span class="n">icohp</span><span class="o">=</span><span class="n">final_icohp</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CompleteCohp.get_orbital_resolved_cohp">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.CompleteCohp.get_orbital_resolved_cohp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_orbital_resolved_cohp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">orbitals</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Orbital</span><span class="p">]]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Orbital</span><span class="p">],</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">summed_spin_channels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Cohp</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get orbital-resolved COHP.</span>

<span class="sd">        Args:</span>
<span class="sd">            label (str): Bond labels as in ICOHPLIST/ICOOPLIST.lobster.</span>
<span class="sd">            orbitals: The orbitals as a label, or list/tuple of</span>
<span class="sd">                [(n1, orbital1), (n2, orbital2), ...].</span>
<span class="sd">                Where each orbital can either be str, int, or Orbital.</span>
<span class="sd">            summed_spin_channels (bool): Sum the spin channels and return the sum as Spin.up.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Cohp object if CompleteCohp contains orbital-resolved COHP,</span>
<span class="sd">                or None if it doesn&#39;t.</span>

<span class="sd">        Note: It currently assumes that orbitals are str if they aren&#39;t the</span>
<span class="sd">            other valid types. This is not ideal, but is the easiest way to</span>
<span class="sd">            avoid unicode issues between Python 2 and Python 3.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orbitals</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">cohp_orbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;orbitals&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
            <span class="n">orbs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">orbital</span> <span class="ow">in</span> <span class="n">orbitals</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orbital</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">orbs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">orbital</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Orbital</span><span class="p">(</span><span class="n">orbital</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orbital</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Orbital</span><span class="p">):</span>
                    <span class="n">orbs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">orbital</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orbital</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orbital</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">orbs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">orbital</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Orbital</span><span class="p">[</span><span class="n">orbital</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Orbital must be str, int, or Orbital.&quot;</span><span class="p">)</span>
            <span class="n">orb_index</span> <span class="o">=</span> <span class="n">cohp_orbs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span>
            <span class="n">orb_label</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">])[</span><span class="n">orb_index</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orbitals</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">orb_label</span> <span class="o">=</span> <span class="n">orbitals</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Orbitals must be str, list, or tuple.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">icohp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orb_label</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">icohp</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">start_cohp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orb_label</span><span class="p">][</span><span class="s2">&quot;COHP&quot;</span><span class="p">]</span>
        <span class="n">start_icohp</span> <span class="o">=</span> <span class="n">icohp</span>

        <span class="k">if</span> <span class="n">summed_spin_channels</span> <span class="ow">and</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">start_cohp</span><span class="p">:</span>
            <span class="n">final_cohp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">final_icohp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">final_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">start_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">start_cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start_icohp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">final_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">start_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">start_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_cohp</span> <span class="o">=</span> <span class="n">start_cohp</span>
            <span class="n">final_icohp</span> <span class="o">=</span> <span class="n">start_icohp</span>

        <span class="k">return</span> <span class="n">Cohp</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energies</span><span class="p">,</span>
            <span class="n">final_cohp</span><span class="p">,</span>
            <span class="n">icohp</span><span class="o">=</span><span class="n">final_icohp</span><span class="p">,</span>
            <span class="n">are_coops</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">are_coops</span><span class="p">,</span>
            <span class="n">are_cobis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">are_cobis</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CompleteCohp.from_dict">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.CompleteCohp.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get CompleteCohp object from a dict representation.</span>

<span class="sd">        TODO: Clean this up.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cohp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">efermi</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;efermi&quot;</span><span class="p">]</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">]</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">])</span>
        <span class="n">are_cobis</span> <span class="o">=</span> <span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;are_cobis&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">are_multi_center_cobis</span> <span class="o">=</span> <span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;are_multi_center_cobis&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">are_coops</span> <span class="o">=</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;are_coops&quot;</span><span class="p">]</span>
        <span class="n">avg_cohp</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;bonds&quot;</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
            <span class="n">bonds</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">bond</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;bonds&quot;</span><span class="p">][</span><span class="n">bond</span><span class="p">][</span><span class="s2">&quot;length&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">PeriodicSite</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">site</span><span class="p">)</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;bonds&quot;</span><span class="p">][</span><span class="n">bond</span><span class="p">][</span><span class="s2">&quot;sites&quot;</span><span class="p">]),</span>
                    <span class="s2">&quot;cells&quot;</span><span class="p">:</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;bonds&quot;</span><span class="p">][</span><span class="n">bond</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;bonds&quot;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bonds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">]:</span>
            <span class="n">cohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spin</span><span class="p">)):</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="n">spin</span><span class="p">])</span> <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">]}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">icohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">Spin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spin</span><span class="p">)):</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="n">spin</span><span class="p">])</span> <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">]}</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">icohp</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;average&quot;</span><span class="p">:</span>
                <span class="n">avg_cohp</span> <span class="o">=</span> <span class="n">Cohp</span><span class="p">(</span>
                    <span class="n">efermi</span><span class="p">,</span>
                    <span class="n">energies</span><span class="p">,</span>
                    <span class="n">cohp</span><span class="p">,</span>
                    <span class="n">icohp</span><span class="o">=</span><span class="n">icohp</span><span class="p">,</span>
                    <span class="n">are_coops</span><span class="o">=</span><span class="n">are_coops</span><span class="p">,</span>
                    <span class="n">are_cobis</span><span class="o">=</span><span class="n">are_cobis</span><span class="p">,</span>
                    <span class="n">are_multi_center_cobis</span><span class="o">=</span><span class="n">are_multi_center_cobis</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cohp_dict</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cohp</span><span class="p">(</span><span class="n">efermi</span><span class="p">,</span> <span class="n">energies</span><span class="p">,</span> <span class="n">cohp</span><span class="p">,</span> <span class="n">icohp</span><span class="o">=</span><span class="n">icohp</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;orb_res_cohp&quot;</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">:</span>
            <span class="n">orb_cohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Orbital</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;orb_res_cohp&quot;</span><span class="p">]:</span>
                <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;orb_res_cohp&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">]:</span>
                    <span class="n">cohp</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">Spin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;orb_res_cohp&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">][</span><span class="s2">&quot;COHP&quot;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;orb_res_cohp&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">][</span><span class="s2">&quot;COHP&quot;</span><span class="p">]</span>
                    <span class="p">}</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">icohp</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="n">Spin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;orb_res_cohp&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">][</span><span class="n">s</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;orb_res_cohp&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span>
                        <span class="p">}</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">icohp</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">orbitals</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">Orbital</span><span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;orb_res_cohp&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">][</span><span class="s2">&quot;orbitals&quot;</span><span class="p">]]</span>
                    <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="n">cohp</span><span class="p">,</span>
                        <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="n">icohp</span><span class="p">,</span>
                        <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="n">orbitals</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="c1"># If no total COHPs are present, calculate the total</span>
                <span class="c1"># COHPs from the single-orbital populations.</span>
                <span class="c1"># Total COHPs may not be present when the COHP generator keyword</span>
                <span class="c1"># is used in LOBSTER versions 2.2.0 and earlier.</span>
                <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cohp</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">][</span><span class="s2">&quot;COHP&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]]),</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">][</span><span class="s2">&quot;COHP&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]]),</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="n">orb_res_icohp</span> <span class="o">=</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">[</span><span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">orb_res_icohp</span><span class="p">:</span>
                    <span class="n">icohp</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]]),</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orb</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]]),</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orb_cohp</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">avg_cohp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;avg_cohp is None&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span>
            <span class="n">avg_cohp</span><span class="p">,</span>
            <span class="n">cohp_dict</span><span class="p">,</span>
            <span class="n">bonds</span><span class="o">=</span><span class="n">bonds</span><span class="p">,</span>
            <span class="n">are_coops</span><span class="o">=</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;are_coops&quot;</span><span class="p">],</span>
            <span class="n">are_cobis</span><span class="o">=</span><span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;are_cobis&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">are_multi_center_cobis</span><span class="o">=</span><span class="n">are_multi_center_cobis</span><span class="p">,</span>
            <span class="n">orb_res_cohp</span><span class="o">=</span><span class="n">orb_cohp</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CompleteCohp.from_file">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.CompleteCohp.from_file">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_file</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">fmt</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;LMTO&quot;</span><span class="p">,</span> <span class="s2">&quot;LOBSTER&quot;</span><span class="p">],</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">structure_file</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">are_coops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_multi_center_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create CompleteCohp from an output file of a COHP calculation.</span>

<span class="sd">        Args:</span>
<span class="sd">            fmt (Literal[&quot;LMTO&quot;, &quot;LOBSTER&quot;]): The code used to calculate COHPs.</span>
<span class="sd">            filename (PathLike): The COHP output file. Defaults to &quot;COPL&quot;</span>
<span class="sd">                for LMTO and &quot;COHPCAR.lobster/COOPCAR.lobster&quot; for LOBSTER.</span>
<span class="sd">            structure_file (PathLike): The file containing the structure.</span>
<span class="sd">                If None, use &quot;CTRL&quot; for LMTO and &quot;POSCAR&quot; for LOBSTER.</span>
<span class="sd">            are_coops (bool): Whether the populations are COOPs or COHPs.</span>
<span class="sd">                Defaults to False for COHPs.</span>
<span class="sd">            are_cobis (bool): Whether the populations are COBIs or COHPs.</span>
<span class="sd">                Defaults to False for COHPs.</span>
<span class="sd">            are_multi_center_cobis (bool): Whether this file</span>
<span class="sd">                includes information on multi-center COBIs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A CompleteCohp object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">are_coops</span> <span class="ow">and</span> <span class="n">are_cobis</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot have info about COOPs and COBIs in the same file.&quot;</span><span class="p">)</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c1"># type: ignore[assignment]</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;LMTO&quot;</span><span class="p">:</span>
            <span class="c1"># TODO: LMTO COOPs and orbital-resolved COHP cannot be handled yet</span>
            <span class="n">are_coops</span> <span class="o">=</span> <span class="n">are_cobis</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">orb_res_cohp</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">structure_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">structure_file</span> <span class="o">=</span> <span class="s2">&quot;CTRL&quot;</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;COPL&quot;</span>

            <span class="n">cohp_file</span><span class="p">:</span> <span class="n">LMTOCopl</span> <span class="o">|</span> <span class="n">Cohpcar</span> <span class="o">=</span> <span class="n">LMTOCopl</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">to_eV</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;LOBSTER&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">are_coops</span> <span class="ow">and</span> <span class="n">are_cobis</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">are_coops</span> <span class="ow">and</span> <span class="n">are_multi_center_cobis</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">are_cobis</span> <span class="ow">and</span> <span class="n">are_multi_center_cobis</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot have info about COOPs, COBIs and/or multi-center COBIS in the same file.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">structure_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">structure_file</span> <span class="o">=</span> <span class="s2">&quot;POSCAR&quot;</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">are_coops</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;COOPCAR.lobster&quot;</span>
                <span class="k">elif</span> <span class="n">are_cobis</span> <span class="ow">or</span> <span class="n">are_multi_center_cobis</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;COBICAR.lobster&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;COHPCAR.lobster&quot;</span>
            <span class="n">cohp_file</span> <span class="o">=</span> <span class="n">Cohpcar</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">are_coops</span><span class="o">=</span><span class="n">are_coops</span><span class="p">,</span>
                <span class="n">are_cobis</span><span class="o">=</span><span class="n">are_cobis</span><span class="p">,</span>
                <span class="n">are_multi_center_cobis</span><span class="o">=</span><span class="n">are_multi_center_cobis</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">orb_res_cohp</span> <span class="o">=</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">orb_res_cohp</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown format </span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">. Valid formats are LMTO and LOBSTER.&quot;</span><span class="p">)</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">structure_file</span><span class="p">)</span>
        <span class="n">efermi</span> <span class="o">=</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">efermi</span>
        <span class="n">cohp_data</span> <span class="o">=</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">cohp_data</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">energies</span>

        <span class="c1"># LOBSTER shifts the energies so that the Fermi level is at zero.</span>
        <span class="c1"># Shifting should be done by the plotter object though.</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="k">if</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="k">else</span> <span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;LOBSTER&quot;</span><span class="p">:</span>
            <span class="n">energies</span> <span class="o">+=</span> <span class="n">efermi</span>

        <span class="k">if</span> <span class="n">orb_res_cohp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If no total COHPs are present, calculate the total</span>
            <span class="c1"># COHPs from the single-orbital populations. Total COHPs</span>
            <span class="c1"># may not be present when the cohpgenerator keyword is used</span>
            <span class="c1"># in LOBSTER versions 2.2.0 and earlier.</span>

            <span class="c1"># TODO: Test this more extensively</span>

            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">orb_res_cohp</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">cohp_data</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="s2">&quot;COHP&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cohp_data</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="s2">&quot;COHP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">sp</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orbs</span><span class="p">][</span><span class="s2">&quot;COHP&quot;</span><span class="p">][</span><span class="n">sp</span><span class="p">]</span> <span class="k">for</span> <span class="n">orbs</span> <span class="ow">in</span> <span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]],</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">spins</span>
                    <span class="p">}</span>
                <span class="k">if</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">cohp_data</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cohp_data</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">sp</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">orbs</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">][</span><span class="n">sp</span><span class="p">]</span> <span class="k">for</span> <span class="n">orbs</span> <span class="ow">in</span> <span class="n">orb_res_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]],</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">spins</span>
                    <span class="p">}</span>

        <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;LMTO&quot;</span><span class="p">:</span>
            <span class="c1"># Calculate the average COHP for the LMTO file to be consistent with LOBSTER</span>
            <span class="n">avg_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">,</span> <span class="s2">&quot;ICOHP&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="p">{}}</span>
            <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">avg_data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="n">spins</span><span class="p">:</span>
                    <span class="n">rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="n">spin</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cohp_data</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
                    <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1"># LMTO COHPs have 5 significant digits</span>
                    <span class="n">avg_data</span><span class="p">[</span><span class="n">dtype</span><span class="p">]</span> <span class="o">|=</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">round_to_sigfigs</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">avg</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)}</span>
            <span class="n">avg_cohp</span> <span class="o">=</span> <span class="n">Cohp</span><span class="p">(</span><span class="n">efermi</span><span class="p">,</span> <span class="n">energies</span><span class="p">,</span> <span class="n">avg_data</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">],</span> <span class="n">icohp</span><span class="o">=</span><span class="n">avg_data</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">])</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">are_multi_center_cobis</span><span class="p">:</span>
            <span class="n">avg_cohp</span> <span class="o">=</span> <span class="n">Cohp</span><span class="p">(</span>
                <span class="n">efermi</span><span class="p">,</span>
                <span class="n">energies</span><span class="p">,</span>
                <span class="n">cohp_data</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">][</span><span class="s2">&quot;COHP&quot;</span><span class="p">],</span>
                <span class="n">icohp</span><span class="o">=</span><span class="n">cohp_data</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">][</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">],</span>
                <span class="n">are_coops</span><span class="o">=</span><span class="n">are_coops</span><span class="p">,</span>
                <span class="n">are_cobis</span><span class="o">=</span><span class="n">are_cobis</span><span class="p">,</span>
                <span class="n">are_multi_center_cobis</span><span class="o">=</span><span class="n">are_multi_center_cobis</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">del</span> <span class="n">cohp_data</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Only include two-center COBIs in average for both spin channels</span>
            <span class="n">cohp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">cohp_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">cohp_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">icohp</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">cohp_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cohp_file</span><span class="o">.</span><span class="n">cohp_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">icohp</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">avg_cohp</span> <span class="o">=</span> <span class="n">Cohp</span><span class="p">(</span>
                <span class="n">efermi</span><span class="p">,</span>
                <span class="n">energies</span><span class="p">,</span>
                <span class="n">cohp</span><span class="p">,</span>
                <span class="n">icohp</span><span class="o">=</span><span class="n">icohp</span><span class="p">,</span>
                <span class="n">are_coops</span><span class="o">=</span><span class="n">are_coops</span><span class="p">,</span>
                <span class="n">are_cobis</span><span class="o">=</span><span class="n">are_cobis</span><span class="p">,</span>
                <span class="n">are_multi_center_cobis</span><span class="o">=</span><span class="n">are_multi_center_cobis</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">cohp_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">Cohp</span><span class="p">(</span>
                <span class="n">efermi</span><span class="p">,</span>
                <span class="n">energies</span><span class="p">,</span>
                <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;COHP&quot;</span><span class="p">],</span>
                <span class="n">icohp</span><span class="o">=</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;ICOHP&quot;</span><span class="p">],</span>
                <span class="n">are_coops</span><span class="o">=</span><span class="n">are_coops</span><span class="p">,</span>
                <span class="n">are_cobis</span><span class="o">=</span><span class="n">are_cobis</span><span class="p">,</span>
                <span class="n">are_multi_center_cobis</span><span class="o">=</span><span class="n">are_multi_center_cobis</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">dct</span> <span class="ow">in</span> <span class="n">cohp_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">bond_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span>
                <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">structure</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">]],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">dct</span> <span class="ow">in</span> <span class="n">cohp_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span>
            <span class="n">avg_cohp</span><span class="p">,</span>
            <span class="n">cohp_dict</span><span class="p">,</span>
            <span class="n">bonds</span><span class="o">=</span><span class="n">bond_dict</span><span class="p">,</span>
            <span class="n">are_coops</span><span class="o">=</span><span class="n">are_coops</span><span class="p">,</span>
            <span class="n">are_cobis</span><span class="o">=</span><span class="n">are_cobis</span><span class="p">,</span>
            <span class="n">orb_res_cohp</span><span class="o">=</span><span class="n">orb_res_cohp</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="IcohpValue">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.IcohpValue">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">IcohpValue</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Information for an ICOHP or ICOOP value.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        energies (NDArray): Energy values for the COHP/ICOHP/COOP/ICOOP.</span>
<span class="sd">        densities (NDArray): Density of states for the COHP/ICOHP/COOP/ICOOP.</span>
<span class="sd">        energies_are_cartesian (bool): Whether the energies are cartesian.</span>
<span class="sd">        are_coops (bool): Whether the object is COOP/ICOOP.</span>
<span class="sd">        are_cobis (bool): Whether the object is COBIS/ICOBIS.</span>
<span class="sd">        icohp (dict): The ICOHP/COHP values, whose keys are Spin.up and Spin.down.</span>
<span class="sd">        summed_icohp (float): The summed ICOHP/COHP values.</span>
<span class="sd">        num_bonds (int): The number of bonds used for the average COHP (for LOBSTER versions &lt;3.0).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">atom1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">atom2</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">length</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">translation</span><span class="p">:</span> <span class="n">Vector3D</span><span class="p">,</span>
        <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">icohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">are_coops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">orbitals</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;icohp&quot;</span><span class="p">,</span> <span class="s2">&quot;orbitals&quot;</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            label (str): Label for the ICOHP.</span>
<span class="sd">            atom1 (str): The first atom that contributes to the bond.</span>
<span class="sd">            atom2 (str): The second atom that contributes to the bond.</span>
<span class="sd">            length (float): Bond length.</span>
<span class="sd">            translation (Vector3D): cell translation vector, e.g. (0, 0, 0).</span>
<span class="sd">            num (int): The number of equivalent bonds.</span>
<span class="sd">            icohp (dict[Spin, float]): {Spin.up: ICOHP_up, Spin.down: ICOHP_down}</span>
<span class="sd">            are_coops (bool): Whether these are COOPs.</span>
<span class="sd">            are_cobis (bool): Whether these are COBIs.</span>
<span class="sd">            orbitals (dict): {[str(Orbital1)-str(Orbital2)]: {</span>
<span class="sd">                &quot;icohp&quot;: {</span>
<span class="sd">                            Spin.up: IcohpValue for spin.up,</span>
<span class="sd">                            Spin.down: IcohpValue for spin.down</span>
<span class="sd">                        },</span>
<span class="sd">                &quot;orbitals&quot;: [Orbital1, Orbital2, ...]}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">are_coops</span> <span class="ow">and</span> <span class="n">are_cobis</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot have info about COOPs and COBIs in the same file.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_are_coops</span> <span class="o">=</span> <span class="n">are_coops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_are_cobis</span> <span class="o">=</span> <span class="n">are_cobis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atom1</span> <span class="o">=</span> <span class="n">atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atom2</span> <span class="o">=</span> <span class="n">atom2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_translation</span> <span class="o">=</span> <span class="n">translation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num</span> <span class="o">=</span> <span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_icohp</span> <span class="o">=</span> <span class="n">icohp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orbitals</span> <span class="o">=</span> <span class="n">orbitals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohp</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation of the ICOHP/ICOOP.&quot;&quot;&quot;</span>
        <span class="c1"># (are_coops and are_cobis) is never True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_coops</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;ICOOP&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_cobis</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;ICOBI&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;ICOHP&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="si">}</span><span class="s2"> between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom2</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translation</span><span class="si">}</span><span class="s2">): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span><span class="si">}</span><span class="s2"> eV (Spin up) and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span><span class="si">}</span><span class="s2"> eV (Spin down)&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="si">}</span><span class="s2"> between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom2</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_translation</span><span class="si">}</span><span class="s2">): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span><span class="si">}</span><span class="s2"> eV (Spin up)&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of bonds for which the ICOHP value is an average.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">are_coops</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether these are ICOOPs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_coops</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">are_cobis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether these are ICOBIs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_cobis</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_spin_polarized</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this is a spin polarized calculation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span>

<div class="viewcode-block" id="IcohpValue.icohpvalue">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.IcohpValue.icohpvalue">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">icohpvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            spin: Spin.up or Spin.down.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: ICOHP value corresponding to chosen spin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="ow">and</span> <span class="n">spin</span> <span class="o">==</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The calculation was not performed with spin polarization&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohp</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span></div>


<div class="viewcode-block" id="IcohpValue.icohpvalue_orbital">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.IcohpValue.icohpvalue_orbital">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">icohpvalue_orbital</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">orbitals</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Orbital</span><span class="p">,</span> <span class="n">Orbital</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            orbitals: tuple[Orbital, Orbital] or &quot;str(Orbital0)-str(Orbital1)&quot;.</span>
<span class="sd">            spin (Spin): Spin.up or Spin.down.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: ICOHP value corresponding to chosen spin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="ow">and</span> <span class="n">spin</span> <span class="o">==</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The calculation was not performed with spin polarization&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orbitals</span><span class="p">,</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">orbitals</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orbitals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">orbitals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbitals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;self._orbitals is None&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbitals</span><span class="p">[</span><span class="n">orbitals</span><span class="p">][</span><span class="s2">&quot;icohp&quot;</span><span class="p">][</span><span class="n">spin</span><span class="p">]</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">icohp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dict with ICOHPs for spin up and spin down.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[Spin, float]: {Spin.up: ICOHP_up, Spin.down: ICOHP_down}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohp</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">summed_icohp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Summed ICOHPs of both spin channels if spin polarized.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: ICOHP value in eV.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">summed_orbital_icohp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Summed orbital-resolved ICOHPs of both spin channels if spin-polarized.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, float]: &quot;str(Orbital1)-str(Ortibal2)&quot;: ICOHP value in eV.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbitals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;_orbitals attrib is None.&quot;</span><span class="p">)</span>

        <span class="n">orbital_icohp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">orb</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orbitals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">orbital_icohp</span><span class="p">[</span><span class="n">orb</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">item</span><span class="p">[</span><span class="s2">&quot;icohp&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">+</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;icohp&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span> <span class="k">else</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;icohp&quot;</span><span class="p">][</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">orbital_icohp</span></div>



<div class="viewcode-block" id="IcohpCollection">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.IcohpCollection">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">IcohpCollection</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collection of IcohpValues.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        are_coops (bool): Whether these are ICOOPs.</span>
<span class="sd">        are_cobis (bool): Whether these are ICOOPs.</span>
<span class="sd">        is_spin_polarized (bool): Whether the calculation is spin polarized.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">list_labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">list_atom1</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">list_atom2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">list_length</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">list_translation</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Vector3D</span><span class="p">],</span>
        <span class="n">list_num</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">list_icohp</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">is_spin_polarized</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">list_orb_icohp</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;icohp&quot;</span><span class="p">,</span> <span class="s2">&quot;orbitals&quot;</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">are_coops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            list_labels (list[str]): Labels for ICOHP/ICOOP values.</span>
<span class="sd">            list_atom1 (list[str]): Atom names, e.g. &quot;O1&quot;.</span>
<span class="sd">            list_atom2 (list[str]): Atom names, e.g. &quot;O1&quot;.</span>
<span class="sd">            list_length (list[float]): Bond lengths in Angstrom.</span>
<span class="sd">            list_translation (list[Vector3D]): Cell translation vectors.</span>
<span class="sd">            list_num (list[int]): Numbers of equivalent bonds, usually 1 starting from LOBSTER 3.0.0.</span>
<span class="sd">            list_icohp (list[dict]): Dicts as {Spin.up: ICOHP_up, Spin.down: ICOHP_down}.</span>
<span class="sd">            is_spin_polarized (bool): Whether the calculation is spin polarized.</span>
<span class="sd">            list_orb_icohp (list[dict]): Dicts as {[str(Orbital1)-str(Orbital2)]: {</span>
<span class="sd">                &quot;icohp&quot;: {Spin.up: IcohpValue for spin.up, Spin.down: IcohpValue for spin.down},</span>
<span class="sd">                &quot;orbitals&quot;: [Orbital1, Orbital2]}.</span>
<span class="sd">            are_coops (bool): Whether ICOOPs are stored.</span>
<span class="sd">            are_cobis (bool): Whether ICOBIs are stored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">are_coops</span> <span class="ow">and</span> <span class="n">are_cobis</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot have info about COOPs and COBIs in the same file.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_are_coops</span> <span class="o">=</span> <span class="n">are_coops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_are_cobis</span> <span class="o">=</span> <span class="n">are_cobis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span> <span class="o">=</span> <span class="n">is_spin_polarized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_labels</span> <span class="o">=</span> <span class="n">list_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_atom1</span> <span class="o">=</span> <span class="n">list_atom1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_atom2</span> <span class="o">=</span> <span class="n">list_atom2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_length</span> <span class="o">=</span> <span class="n">list_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_translation</span> <span class="o">=</span> <span class="n">list_translation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_num</span> <span class="o">=</span> <span class="n">list_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_icohp</span> <span class="o">=</span> <span class="n">list_icohp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_orb_icohp</span> <span class="o">=</span> <span class="n">list_orb_icohp</span>

        <span class="c1"># TODO: DanielYang: self._icohplist name is misleading</span>
        <span class="c1"># (not list), and confuses with self._list_icohp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_icohplist</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IcohpValue</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_labels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_icohplist</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">IcohpValue</span><span class="p">(</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">atom1</span><span class="o">=</span><span class="n">list_atom1</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                <span class="n">atom2</span><span class="o">=</span><span class="n">list_atom2</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                <span class="n">length</span><span class="o">=</span><span class="n">list_length</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                <span class="n">translation</span><span class="o">=</span><span class="n">list_translation</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                <span class="n">num</span><span class="o">=</span><span class="n">list_num</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                <span class="n">icohp</span><span class="o">=</span><span class="n">list_icohp</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                <span class="n">are_coops</span><span class="o">=</span><span class="n">are_coops</span><span class="p">,</span>
                <span class="n">are_cobis</span><span class="o">=</span><span class="n">are_cobis</span><span class="p">,</span>
                <span class="n">orbitals</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">list_orb_icohp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">list_orb_icohp</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohplist</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

<div class="viewcode-block" id="IcohpCollection.get_icohp_by_label">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.IcohpCollection.get_icohp_by_label">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_icohp_by_label</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">summed_spin_channels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">,</span>
        <span class="n">orbitals</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Orbital</span><span class="p">,</span> <span class="n">Orbital</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an ICOHP value for a certain bond indicated by the label.</span>

<span class="sd">        Args:</span>
<span class="sd">            label (str): The bond number in Icohplist.lobster/Icooplist.lobster,</span>
<span class="sd">                starting from &quot;1&quot;.</span>
<span class="sd">            summed_spin_channels (bool): Whether the ICOHPs/ICOOPs of both</span>
<span class="sd">                spin channels should be summed.</span>
<span class="sd">            spin (Spin): If not summed_spin_channels, indicate</span>
<span class="sd">                which spin channel should be returned.</span>
<span class="sd">            orbitals: List of Orbital or &quot;str(Orbital1)-str(Orbital2)&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: ICOHP/ICOOP value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">icohp</span><span class="p">:</span> <span class="n">IcohpValue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohplist</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">orbitals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">icohp</span><span class="o">.</span><span class="n">summed_icohp</span> <span class="k">if</span> <span class="n">summed_spin_channels</span> <span class="k">else</span> <span class="n">icohp</span><span class="o">.</span><span class="n">icohpvalue</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orbitals</span><span class="p">,</span> <span class="nb">tuple</span> <span class="o">|</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">orbitals</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orbitals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">orbitals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">summed_spin_channels</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">icohp</span><span class="o">.</span><span class="n">summed_orbital_icohp</span><span class="p">[</span><span class="n">orbitals</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">icohp</span><span class="o">.</span><span class="n">icohpvalue_orbital</span><span class="p">(</span><span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">,</span> <span class="n">orbitals</span><span class="o">=</span><span class="n">orbitals</span><span class="p">)</span></div>


<div class="viewcode-block" id="IcohpCollection.get_summed_icohp_by_label_list">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.IcohpCollection.get_summed_icohp_by_label_list">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_summed_icohp_by_label_list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">label_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">divisor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">summed_spin_channels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the sum of ICOHP values.</span>

<span class="sd">        Args:</span>
<span class="sd">            label_list (list[str]): Labels of the ICOHPs/ICOOPs that should be summed,</span>
<span class="sd">                the same as in ICOHPLIST/ICOOPLIST.</span>
<span class="sd">            divisor (float): Divisor used to divide the sum.</span>
<span class="sd">            summed_spin_channels (bool): Whether the ICOHPs/ICOOPs of both</span>
<span class="sd">                spin channels should be summed.</span>
<span class="sd">            spin (Spin): If not summed_spin_channels, indicate</span>
<span class="sd">                which spin channel should be returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Sum of ICOHPs selected with label_list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sum_icohp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_list</span><span class="p">:</span>
            <span class="n">icohp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohplist</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">icohp</span><span class="o">.</span><span class="n">num_bonds</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;One of the ICOHP values is an average over bonds. This is currently not considered.&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">icohp</span><span class="o">.</span><span class="n">_is_spin_polarized</span> <span class="ow">and</span> <span class="n">summed_spin_channels</span><span class="p">:</span>
                <span class="n">sum_icohp</span> <span class="o">+=</span> <span class="n">icohp</span><span class="o">.</span><span class="n">summed_icohp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sum_icohp</span> <span class="o">+=</span> <span class="n">icohp</span><span class="o">.</span><span class="n">icohpvalue</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sum_icohp</span> <span class="o">/</span> <span class="n">divisor</span></div>


<div class="viewcode-block" id="IcohpCollection.get_icohp_dict_by_bondlengths">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.IcohpCollection.get_icohp_dict_by_bondlengths">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_icohp_dict_by_bondlengths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">minbondlength</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">maxbondlength</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IcohpValue</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get IcohpValues within certain bond length range.</span>

<span class="sd">        Args:</span>
<span class="sd">            minbondlength (float): The minimum bond length.</span>
<span class="sd">            maxbondlength (float): The maximum bond length.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, IcohpValue]: Keys are the labels from the initial list_labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_icohp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohplist</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">minbondlength</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="o">.</span><span class="n">_length</span> <span class="o">&lt;=</span> <span class="n">maxbondlength</span><span class="p">:</span>
                <span class="n">new_icohp_dict</span><span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">new_icohp_dict</span></div>


<div class="viewcode-block" id="IcohpCollection.get_icohp_dict_of_site">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.IcohpCollection.get_icohp_dict_of_site">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_icohp_dict_of_site</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">site</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">minsummedicohp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">maxsummedicohp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">minbondlength</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">maxbondlength</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
        <span class="n">only_bonds_to</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IcohpValue</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get IcohpValues for a certain site.</span>

<span class="sd">        Args:</span>
<span class="sd">            site (int): The site of interest, ordered as in Icohplist.lobster/Icooplist.lobster,</span>
<span class="sd">                starts from 0.</span>
<span class="sd">            minsummedicohp (float): Minimal ICOHP/ICOOP of the bonds that are considered.</span>
<span class="sd">                It is the summed ICOHP value from both spin channels for spin polarized cases</span>
<span class="sd">            maxsummedicohp (float): Maximal ICOHP/ICOOP of the bonds that are considered.</span>
<span class="sd">                It is the summed ICOHP value from both spin channels for spin polarized cases</span>
<span class="sd">            minbondlength (float): The minimum bond length.</span>
<span class="sd">            maxbondlength (float): The maximum bond length.</span>
<span class="sd">            only_bonds_to (list[str]): The bonding partners that are allowed, e.g. [&quot;O&quot;].</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict of IcohpValues, the keys correspond to the values from the initial list_labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_icohp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohplist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">atomnumber1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d+)&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">_atom1</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">atomnumber2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d+)&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">_atom2</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">site</span> <span class="ow">in</span> <span class="p">(</span><span class="n">atomnumber1</span><span class="p">,</span> <span class="n">atomnumber2</span><span class="p">):</span>
                <span class="c1"># Swap order of atoms so that searched one is always atom1</span>
                <span class="k">if</span> <span class="n">site</span> <span class="o">==</span> <span class="n">atomnumber2</span><span class="p">:</span>
                    <span class="n">save</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">_atom1</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">_atom1</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">_atom2</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">_atom2</span> <span class="o">=</span> <span class="n">save</span>

                <span class="n">second_test</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">only_bonds_to</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(</span><span class="se">\\</span><span class="s2">d+)&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">_atom2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">only_bonds_to</span>
                <span class="k">if</span> <span class="n">minbondlength</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="o">.</span><span class="n">_length</span> <span class="o">&lt;=</span> <span class="n">maxbondlength</span> <span class="ow">and</span> <span class="n">second_test</span><span class="p">:</span>
                    <span class="c1"># TODO: DanielYang: merge the following condition blocks</span>
                    <span class="k">if</span> <span class="n">minsummedicohp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">summed_icohp</span> <span class="o">&gt;=</span> <span class="n">minsummedicohp</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">maxsummedicohp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">summed_icohp</span> <span class="o">&lt;=</span> <span class="n">maxsummedicohp</span><span class="p">:</span>
                                    <span class="n">new_icohp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">new_icohp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">elif</span> <span class="n">maxsummedicohp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">summed_icohp</span> <span class="o">&lt;=</span> <span class="n">maxsummedicohp</span><span class="p">:</span>
                            <span class="n">new_icohp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_icohp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">new_icohp_dict</span></div>


<div class="viewcode-block" id="IcohpCollection.extremum_icohpvalue">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.IcohpCollection.extremum_icohpvalue">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extremum_icohpvalue</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">summed_spin_channels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ICOHP/ICOOP of the strongest bond.</span>

<span class="sd">        Args:</span>
<span class="sd">            summed_spin_channels (bool): Whether the ICOHPs/ICOOPs of both</span>
<span class="sd">                spin channels should be summed.</span>
<span class="sd">            spin (Spin): If not summed_spin_channels, this indicates which</span>
<span class="sd">                spin channel should be returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Lowest ICOHP/largest ICOOP value (i.e. ICOHP/ICOOP value of strongest bond).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extremum</span> <span class="o">=</span> <span class="o">-</span><span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_coops</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_cobis</span> <span class="k">else</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">spin</span> <span class="o">==</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;This spin channel does not exist. I am switching to Spin.up&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span>

        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohplist</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">summed_spin_channels</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_coops</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_cobis</span><span class="p">:</span>
                    <span class="n">extremum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">icohpvalue</span><span class="p">(</span><span class="n">spin</span><span class="p">),</span> <span class="n">extremum</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">icohpvalue</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">extremum</span><span class="p">:</span>
                    <span class="n">extremum</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">icohpvalue</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_coops</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_cobis</span><span class="p">:</span>
                <span class="n">extremum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">summed_icohp</span><span class="p">,</span> <span class="n">extremum</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">value</span><span class="o">.</span><span class="n">summed_icohp</span> <span class="o">&gt;</span> <span class="n">extremum</span><span class="p">:</span>
                <span class="n">extremum</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">summed_icohp</span>

        <span class="k">return</span> <span class="n">extremum</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_spin_polarized</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this is spin polarized.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">are_coops</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this is COOP.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_coops</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">are_cobis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this is COBI.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_are_cobis</span></div>



<div class="viewcode-block" id="get_integrated_cohp_in_energy_range">
<a class="viewcode-back" href="../../../pymatgen.electronic_structure.html#pymatgen.electronic_structure.cohp.get_integrated_cohp_in_energy_range">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_integrated_cohp_in_energy_range</span><span class="p">(</span>
    <span class="n">cohp</span><span class="p">:</span> <span class="n">CompleteCohp</span><span class="p">,</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">orbital</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">energy_range</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">relative_E_Fermi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">summed_spin_channels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrate CompleteCohps which include data of integrated COHPs (ICOHPs).</span>

<span class="sd">    Args:</span>
<span class="sd">        cohp (CompleteCohp): CompleteCohp object.</span>
<span class="sd">        label (str): Label of the COHP data.</span>
<span class="sd">        orbital (str): If not None, a orbital resolved integrated COHP will be returned.</span>
<span class="sd">        energy_range: If None, return the ICOHP value at Fermi level.</span>
<span class="sd">            If float, integrate from this value up to Fermi level.</span>
<span class="sd">            If (float, float), integrate in between.</span>
<span class="sd">        relative_E_Fermi (bool): Whether energy scale with Fermi level at 0 eV is chosen.</span>
<span class="sd">        summed_spin_channels (bool): Whether Spin channels will be summed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If summed_spin_channels:</span>
<span class="sd">            float: the ICOHP.</span>
<span class="sd">        else:</span>
<span class="sd">            dict: {Spin.up: float, Spin.down: float}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">orbital</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">icohps</span> <span class="o">=</span> <span class="n">cohp</span><span class="o">.</span><span class="n">all_cohps</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">get_icohp</span><span class="p">(</span><span class="n">spin</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_icohps</span> <span class="o">=</span> <span class="n">cohp</span><span class="o">.</span><span class="n">get_orbital_resolved_cohp</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">orbitals</span><span class="o">=</span><span class="n">orbital</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_icohps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;_icohps is None&quot;</span><span class="p">)</span>
        <span class="n">icohps</span> <span class="o">=</span> <span class="n">_icohps</span><span class="o">.</span><span class="n">icohp</span>

    <span class="k">if</span> <span class="n">icohps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ichops is None&quot;</span><span class="p">)</span>

    <span class="n">summedicohp</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">summed_spin_channels</span> <span class="ow">and</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">icohps</span><span class="p">:</span>
        <span class="n">summedicohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">icohps</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">+</span> <span class="n">icohps</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">summedicohp</span> <span class="o">=</span> <span class="n">icohps</span>

    <span class="k">if</span> <span class="n">energy_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">energies_corrected</span> <span class="o">=</span> <span class="n">cohp</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">cohp</span><span class="o">.</span><span class="n">efermi</span>
        <span class="n">spl_spinup</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">energies_corrected</span><span class="p">,</span> <span class="n">summedicohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">summed_spin_channels</span> <span class="ow">and</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">icohps</span><span class="p">:</span>
            <span class="n">spl_spindown</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">energies_corrected</span><span class="p">,</span> <span class="n">summedicohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="n">spl_spindown</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)}</span>

        <span class="k">return</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span> <span class="k">if</span> <span class="n">summed_spin_channels</span> <span class="k">else</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)}</span>

    <span class="c1"># Return ICOHP value at the Fermi level</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">energy_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">relative_E_Fermi</span><span class="p">:</span>
            <span class="n">energies_corrected</span> <span class="o">=</span> <span class="n">cohp</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">cohp</span><span class="o">.</span><span class="n">efermi</span>
            <span class="n">spl_spinup</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">energies_corrected</span><span class="p">,</span> <span class="n">summedicohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">summed_spin_channels</span> <span class="ow">and</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">icohps</span><span class="p">:</span>
                <span class="n">spl_spindown</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">energies_corrected</span><span class="p">,</span> <span class="n">summedicohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">),</span>
                    <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="n">spl_spindown</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">spl_spindown</span><span class="p">(</span><span class="n">energy_range</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="k">if</span> <span class="n">summed_spin_channels</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">)}</span>

        <span class="n">energies_corrected</span> <span class="o">=</span> <span class="n">cohp</span><span class="o">.</span><span class="n">energies</span>
        <span class="n">spl_spinup</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">energies_corrected</span><span class="p">,</span> <span class="n">summedicohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">summed_spin_channels</span> <span class="ow">and</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">icohps</span><span class="p">:</span>
            <span class="n">spl_spindown</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">energies_corrected</span><span class="p">,</span> <span class="n">summedicohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">cohp</span><span class="o">.</span><span class="n">efermi</span><span class="p">)</span> <span class="o">-</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">),</span>
                <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="n">spl_spindown</span><span class="p">(</span><span class="n">cohp</span><span class="o">.</span><span class="n">efermi</span><span class="p">)</span> <span class="o">-</span> <span class="n">spl_spindown</span><span class="p">(</span><span class="n">energy_range</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="n">summed_spin_channels</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">cohp</span><span class="o">.</span><span class="n">efermi</span><span class="p">)</span> <span class="o">-</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">cohp</span><span class="o">.</span><span class="n">efermi</span><span class="p">)</span> <span class="o">-</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">)}</span>

    <span class="n">energies_corrected</span> <span class="o">=</span> <span class="n">cohp</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">cohp</span><span class="o">.</span><span class="n">efermi</span> <span class="k">if</span> <span class="n">relative_E_Fermi</span> <span class="k">else</span> <span class="n">cohp</span><span class="o">.</span><span class="n">energies</span>

    <span class="n">spl_spinup</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">energies_corrected</span><span class="p">,</span> <span class="n">summedicohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">summed_spin_channels</span> <span class="ow">and</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="ow">in</span> <span class="n">icohps</span><span class="p">:</span>
        <span class="n">spl_spindown</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">energies_corrected</span><span class="p">,</span> <span class="n">summedicohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="n">ext</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="n">spl_spindown</span><span class="p">(</span><span class="n">energy_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">spl_spindown</span><span class="p">(</span><span class="n">energy_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="p">}</span>
    <span class="k">if</span> <span class="n">summed_spin_channels</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">{</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">spl_spinup</span><span class="p">(</span><span class="n">energy_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.electronic_structure.cohp</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>