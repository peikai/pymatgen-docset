<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymatgen.ext.matproj &#8212; pymatgen 2025.1.24 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=5c69cfe2" />
    <script src="../../../_static/documentation_options.js?v=d2bc030c"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.ext.matproj</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.ext.matproj</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module provides classes to interface with the Materials Project REST</span>
<span class="sd">API v2 to enable the creation of data structures and pymatgen objects using</span>
<span class="sd">Materials Project data.</span>

<span class="sd">To make use of the Materials API, you need to be a registered user of the</span>
<span class="sd">Materials Project, and obtain an API key by going to your dashboard at</span>
<span class="sd">https://materialsproject.org/dashboard.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">NamedTuple</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.json</span><span class="w"> </span><span class="kn">import</span> <span class="n">MontyDecoder</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">SETTINGS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">PMG_VERSION</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.symmetry.analyzer</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpacegroupAnalyzer</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">mp_api.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">MPRester</span> <span class="k">as</span> <span class="n">_MPResterNew</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Self</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.structure</span><span class="w"> </span><span class="kn">import</span> <span class="n">Structure</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.entries.computed_entries</span><span class="w"> </span><span class="kn">import</span> <span class="n">ComputedStructureEntry</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.ext.matproj_legacy</span><span class="w"> </span><span class="kn">import</span> <span class="n">_MPResterLegacy</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">MP_LOG_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span> <span class="s2">&quot;.mprester.log.yaml&quot;</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_MPResterBasic</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is Pymatgen&#39;s own implement of a MPRester that supports the new MP API. If you are getting your API key from</span>
<span class="sd">    the new dashboard of MP, you will need to use this instead of the original MPRester because the new API keys do</span>
<span class="sd">    not work with the old MP API (???!).</span>

<span class="sd">    The reason why this class exists is because it is the belief of the pymatgen maintainers that access to the MP API</span>
<span class="sd">    remains a critical part of pymatgen functionality. However, the new mp-api package is written in a way that</span>
<span class="sd">    prevents us from importing the mp-api package because of cyclic dependencies. It is also the opinion of Pymatgen</span>
<span class="sd">    maintainers that the implementation of mp-api is too heavy duty for most users (few care about document models,</span>
<span class="sd">    etc.). Further, this implementation serves as a simple reference for end developers who want to develop their own</span>
<span class="sd">    interfaces to the MP API via the REST urls.</span>

<span class="sd">    If you are a power user, feel free to install the mp-api package. All issues regarding that implementation should</span>
<span class="sd">    be directed to the maintainers of that repository and not pymatgen. We will support only issues with regards to</span>
<span class="sd">    our implementation only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_user_agent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            api_key (str): A String API key for accessing the MaterialsProject</span>
<span class="sd">                REST interface. Please obtain your API key at</span>
<span class="sd">                https://www.materialsproject.org/dashboard. If this is None,</span>
<span class="sd">                the code will check if there is a &quot;PMG_MAPI_KEY&quot; setting.</span>
<span class="sd">                If so, it will use that environment variable. This makes</span>
<span class="sd">                easier for heavy users to simply add this environment variable to</span>
<span class="sd">                their setups and MPRester can then be called without any arguments.</span>
<span class="sd">            include_user_agent (bool): If True, will include a user agent with the</span>
<span class="sd">                HTTP request including information on pymatgen and system version</span>
<span class="sd">                making the API request. This helps MP support pymatgen users, and</span>
<span class="sd">                is similar to what most web browsers send with each page request.</span>
<span class="sd">                Set to False to disable the user agent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">SETTINGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PMG_MAPI_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preamble</span> <span class="o">=</span> <span class="n">SETTINGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PMG_MAPI_ENDPOINT&quot;</span><span class="p">,</span> <span class="s2">&quot;https://api.materialsproject.org/&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x-api-key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">include_user_agent</span><span class="p">:</span>
            <span class="n">pymatgen_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pymatgen/</span><span class="si">{</span><span class="n">PMG_VERSION</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">python_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Python/</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">platform_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">platform</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;user-agent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pymatgen_info</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">python_info</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">platform_info</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># This is a hack, but it fakes most of the functionality of mp-api&#39;s summary.search.</span>
        <span class="k">class</span><span class="w"> </span><span class="nc">Summary</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
            <span class="n">search</span><span class="p">:</span> <span class="n">Callable</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">summary</span> <span class="o">=</span> <span class="n">Summary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_search</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="s2">&quot;materials&quot;</span><span class="p">,</span> <span class="s2">&quot;thermo&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2"> is not an attribute of this implementation of MPRester, which only supports functionality&quot;</span>
                <span class="s2">&quot;used by 80</span><span class="si">% o</span><span class="s2">f users. If you are looking for the full functionality MPRester, pls install the mp-api .&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Support for &quot;with&quot; context.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Support for &quot;with&quot; context.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub_url</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">mp_decode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to make the requests and perform decoding based on MSONable protocol.&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preamble</span> <span class="o">+</span> <span class="n">sub_url</span>

        <span class="n">per_page</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">actual_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&amp;_per_page=</span><span class="si">{</span><span class="n">per_page</span><span class="si">}</span><span class="s2">&amp;_page=</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">actual_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">actual_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">]:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">MontyDecoder</span><span class="p">)</span> <span class="k">if</span> <span class="n">mp_decode</span> <span class="k">else</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MPRestError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;REST query returned with error status code </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">all_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">per_page</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">. Content: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">MPRestError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">summary_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function mirrors the mp-api&#39;s summary.search functionality.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: This function only takes kwargs. All kwargs that do not start with an underscore are treated as</span>
<span class="sd">                search criteria and those with underscores are treated as params. Example usage:</span>
<span class="sd">                MPRester().summary.search(material_ids=&quot;mp-19770,mp-19017&quot;, _fields=&quot;formula_pretty,energy_above_hull&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)}</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;_fields&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;_fields&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;_all_fields=True&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;_fields&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;_fields&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;_fields&quot;</span><span class="p">]</span>
            <span class="n">params</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;_fields=</span><span class="si">{</span><span class="n">fields</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;_all_fields=False&quot;</span><span class="p">))</span>
        <span class="n">get</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;query=</span><span class="si">{</span><span class="n">get</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;materials/summary/?</span><span class="si">{</span><span class="n">get</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">criteria</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get  a data corresponding to a criteria.</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria (dict): Materials Project ID (e.g. mp-1234), e.g. {&quot;formula&quot;: &quot;Fe2O3,FeO&quot;}</span>
<span class="sd">            fields (list): Fields to query for. If None (the default), all fields are returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of dict of summary docs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">get</span> <span class="o">=</span> <span class="s2">&quot;_all_fields=True&quot;</span> <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;_fields=&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;materials/summary/?</span><span class="si">{</span><span class="n">get</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">criteria</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_summary_by_material_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get  a data corresponding to a material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project ID (e.g. mp-1234).</span>
<span class="sd">            fields (list): Fields to query for. If None (the default), all fields are returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">get</span> <span class="o">=</span> <span class="s2">&quot;_all_fields=True&quot;</span> <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;_fields=&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;materials/summary/?</span><span class="si">{</span><span class="n">get</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;material_ids&quot;</span><span class="p">:</span> <span class="n">material_id</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">get_doc</span> <span class="o">=</span> <span class="n">get_summary_by_material_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_material_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formula</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get  all materials ids for a formula.</span>

<span class="sd">        Args:</span>
<span class="sd">            formula (str): A formula (e.g., Fe2O3).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: all materials ids.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;material_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_summary</span><span class="p">({</span><span class="s2">&quot;formula&quot;</span><span class="p">:</span> <span class="n">formula</span><span class="p">},</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;material_id&quot;</span><span class="p">])]</span>

    <span class="c1"># For backwards compatibility and poor spelling.</span>
    <span class="n">get_materials_ids</span> <span class="o">=</span> <span class="n">get_material_ids</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_structures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chemsys_formula</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Structure</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of Structures corresponding to a chemical system or formula.</span>

<span class="sd">        Args:</span>
<span class="sd">            chemsys_formula (str): A chemical system, list of chemical systems</span>
<span class="sd">                (e.g., Li-Fe-O, Si-*), or single formula (e.g., Fe2O3, Si*).</span>
<span class="sd">            final (bool): Whether to get the final structure, or the list of initial</span>
<span class="sd">                (pre-relaxation) structures. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Structure objects. ([Structure])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;chemsys=</span><span class="si">{</span><span class="n">chemsys_formula</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">chemsys_formula</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;formula=</span><span class="si">{</span><span class="n">chemsys_formula</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="s2">&quot;structure&quot;</span> <span class="k">if</span> <span class="n">final</span> <span class="k">else</span> <span class="s2">&quot;initial_structure&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;materials/summary/?</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&amp;_all_fields=false&amp;_fields=</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">dct</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span> <span class="k">for</span> <span class="n">dct</span> <span class="ow">in</span> <span class="n">response</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_structure_by_material_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conventional_unit_cell</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get  a Structure corresponding to a material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project ID (e.g. mp-1234).</span>
<span class="sd">            final (bool): Whether to get the final structure, or the initial</span>
<span class="sd">                (pre-relaxation) structures. Defaults to True.</span>
<span class="sd">            conventional_unit_cell (bool): Whether to get the standard conventional unit cell</span>

<span class="sd">        Returns:</span>
<span class="sd">            Structure object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="s2">&quot;structure&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;materials/summary?material_ids=</span><span class="si">{</span><span class="n">material_id</span><span class="si">}</span><span class="s2">&amp;_fields=</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">prop</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">conventional_unit_cell</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">structure</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_initial_structures_by_material_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conventional_unit_cell</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Structure</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get  a Structure corresponding to a material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project ID (e.g. mp-1234).</span>
<span class="sd">            final (bool): Whether to get the final structure, or the initial</span>
<span class="sd">                (pre-relaxation) structures. Defaults to True.</span>
<span class="sd">            conventional_unit_cell (bool): Whether to get the standard conventional unit cell</span>

<span class="sd">        Returns:</span>
<span class="sd">            Structure object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="s2">&quot;initial_structures&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;materials/summary/</span><span class="si">{</span><span class="n">material_id</span><span class="si">}</span><span class="s2">/?_fields=</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">structures</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">prop</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">conventional_unit_cell</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">get_conventional_standard_structure</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">structures</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">structures</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_entries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">criteria</span><span class="p">,</span>
        <span class="n">compatible_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">inc_structure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">property_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">conventional_unit_cell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">sort_by_e_above_hull</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get  a list of ComputedEntries or ComputedStructureEntries corresponding</span>
<span class="sd">        to a chemical system, formula, or materials_id or full criteria.</span>

<span class="sd">        Args:</span>
<span class="sd">            criteria: Chemsys, formula, or mp-id.</span>
<span class="sd">            compatible_only (bool): Whether to return only &quot;compatible&quot;</span>
<span class="sd">                entries. Compatible entries are entries that have been</span>
<span class="sd">                processed using the MaterialsProject2020Compatibility class,</span>
<span class="sd">                which performs adjustments to allow mixing of GGA and GGA+U</span>
<span class="sd">                calculations for more accurate phase diagrams and reaction</span>
<span class="sd">                energies.</span>
<span class="sd">            inc_structure (str): If None, entries returned are</span>
<span class="sd">                ComputedEntries. If inc_structure=&quot;initial&quot;,</span>
<span class="sd">                ComputedStructureEntries with initial structures are returned.</span>
<span class="sd">                Otherwise, ComputedStructureEntries with final structures</span>
<span class="sd">                are returned.</span>
<span class="sd">            property_data (list): Specify additional properties to include in</span>
<span class="sd">                entry.data. If None, no data. Should be a subset of</span>
<span class="sd">                supported_properties.</span>
<span class="sd">            conventional_unit_cell (bool): Whether to get the standard</span>
<span class="sd">                conventional unit cell</span>
<span class="sd">            sort_by_e_above_hull (bool): Whether to sort the list of entries by</span>
<span class="sd">                e_above_hull (will query e_above_hull as a property_data if True).</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of ComputedStructureEntry objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">criteria</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mp-&quot;</span><span class="p">):</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;material_ids=</span><span class="si">{</span><span class="n">criteria</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">criteria</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;chemsys=</span><span class="si">{</span><span class="n">criteria</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;formula=</span><span class="si">{</span><span class="n">criteria</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;materials/thermo/?_fields=entries&amp;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dct</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">compatible_only</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.entries.compatibility</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaterialsProject2020Compatibility</span>

            <span class="c1"># suppress the warning about missing oxidation states</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Failed to guess oxidation states.*&quot;</span><span class="p">)</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="n">MaterialsProject2020Compatibility</span><span class="p">()</span><span class="o">.</span><span class="n">process_entries</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">entries</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_entry_by_material_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ComputedStructureEntry</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get  a ComputedEntry corresponding to a material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project material_id (a string,</span>
<span class="sd">                e.g. mp-1234).</span>
<span class="sd">            *args: Pass-through to get_entries.</span>
<span class="sd">            **kwargs: Pass-through to get_entries.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ComputedStructureEntry object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entries</span><span class="p">(</span><span class="n">material_id</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_entries_in_chemsys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to get a list of ComputedEntries in a chemical system. For example, elements = [&quot;Li&quot;, &quot;Fe&quot;, &quot;O&quot;]</span>
<span class="sd">        will return a list of all entries in the Li-Fe-O chemical system, i.e., all LixOy, FexOy, LixFey, LixFeyOz,</span>
<span class="sd">        Li, Fe and O phases. Extremely useful for creating phase diagrams of entire chemical systems.</span>

<span class="sd">        Args:</span>
<span class="sd">            elements (str | list[str]): Chemical system string comprising element</span>
<span class="sd">                symbols separated by dashes, e.g. &quot;Li-Fe-O&quot; or List of element</span>
<span class="sd">                symbols, e.g. [&quot;Li&quot;, &quot;Fe&quot;, &quot;O&quot;].</span>
<span class="sd">            *args: Pass-through to get_entries.</span>
<span class="sd">            **kwargs: Pass-through to get_entries.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of ComputedEntries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chemsys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">els</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                <span class="n">chemsys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">els</span><span class="p">)))</span>
        <span class="n">criteria</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chemsys</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entries</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_phonon_bandstructure_by_material_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get phonon bandstructure by material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project material_id</span>

<span class="sd">        Returns:</span>
<span class="sd">            PhononBandStructureSymmLine: A phonon band structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="s2">&quot;ph_bs&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;materials/phonon/?material_ids=</span><span class="si">{</span><span class="n">material_id</span><span class="si">}</span><span class="s2">&amp;_fields=</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">prop</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_phonon_dos_by_material_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get phonon density of states by material_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            material_id (str): Materials Project material_id</span>

<span class="sd">        Returns:</span>
<span class="sd">            CompletePhononDos: A phonon DOS object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="s2">&quot;ph_dos&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;materials/phonon/?material_ids=</span><span class="si">{</span><span class="n">material_id</span><span class="si">}</span><span class="s2">&amp;_fields=</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">prop</span><span class="p">]</span>


<div class="viewcode-block" id="MPRester">
<a class="viewcode-back" href="../../../pymatgen.ext.html#pymatgen.ext.matproj.MPRester">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MPRester</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class to conveniently interface with the new and legacy Materials Project REST interface.</span>

<span class="sd">    The recommended way to use MPRester is as a context manager to ensure</span>
<span class="sd">    that sessions are properly closed after usage:</span>

<span class="sd">        with MPRester(&quot;API_KEY&quot;) as mpr:</span>
<span class="sd">            docs = mpr.call_some_method()</span>

<span class="sd">    MPRester uses the &quot;requests&quot; package, which provides HTTP connection</span>
<span class="sd">    pooling. All connections are made via https for security.</span>

<span class="sd">    For more advanced uses of the Materials API, please consult the API</span>
<span class="sd">    documentation at https://materialsproject.org/api and https://docs.materialsproject.org.</span>

<span class="sd">    This class handles the transition between old and new MP API, making it easy to switch between them</span>
<span class="sd">    by passing a new (length 32) or old (15 &lt;= length &lt;= 17) API key. See https://docs.materialsproject.org</span>
<span class="sd">    for which API to use.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_MPResterNew</span> <span class="o">|</span> <span class="n">_MPResterBasic</span> <span class="o">|</span> <span class="n">_MPResterLegacy</span><span class="p">:</span>  <span class="c1"># type: ignore[misc]</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">           *args: Pass through to either legacy or new MPRester.</span>
<span class="sd">           **kwargs: Pass through to either legacy or new MPRester.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_key&quot;</span><span class="p">,</span> <span class="n">SETTINGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PMG_MAPI_KEY&quot;</span><span class="p">))</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;api_key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_key</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_key</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please supply an API key. See https://materialsproject.org/api for details.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.ext.matproj_legacy</span><span class="w"> </span><span class="kn">import</span> <span class="n">_MPResterLegacy</span>

            <span class="k">return</span> <span class="n">_MPResterLegacy</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">mp_api.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">MPRester</span> <span class="k">as</span> <span class="n">_MPResterNew</span>

            <span class="k">return</span> <span class="n">_MPResterNew</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_MPResterBasic</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="MPRestError">
<a class="viewcode-back" href="../../../pymatgen.ext.html#pymatgen.ext.matproj.MPRestError">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MPRestError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exception class for legacy MPRestAdaptor. Raised when query is malformed.&quot;&quot;&quot;</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.ext.matproj</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>