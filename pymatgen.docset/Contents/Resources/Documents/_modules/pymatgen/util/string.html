<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymatgen.util.string &#8212; pymatgen 2025.1.24 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=5c69cfe2" />
    <script src="../../../_static/documentation_options.js?v=d2bc030c"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.util.string</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.util.string</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module provides utility classes for string operations.</span>

<span class="sd">TODO: make standalone functions in this module use the same implementation as Stringify</span>
<span class="sd">Note: previous deprecations of standalone functions in this module were removed due to</span>
<span class="sd">a community need.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fractions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fraction</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">TextIO</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArrayLike</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">Structure</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vector3D</span>

<span class="n">SUBSCRIPT_UNICODE</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="s2">&quot;₀&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;₁&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;₂&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="s2">&quot;₃&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="s2">&quot;₄&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5&quot;</span><span class="p">:</span> <span class="s2">&quot;₅&quot;</span><span class="p">,</span>
    <span class="s2">&quot;6&quot;</span><span class="p">:</span> <span class="s2">&quot;₆&quot;</span><span class="p">,</span>
    <span class="s2">&quot;7&quot;</span><span class="p">:</span> <span class="s2">&quot;₇&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8&quot;</span><span class="p">:</span> <span class="s2">&quot;₈&quot;</span><span class="p">,</span>
    <span class="s2">&quot;9&quot;</span><span class="p">:</span> <span class="s2">&quot;₉&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">SUPERSCRIPT_UNICODE</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="s2">&quot;⁰&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;¹&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;²&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="s2">&quot;³&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="s2">&quot;⁴&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5&quot;</span><span class="p">:</span> <span class="s2">&quot;⁵&quot;</span><span class="p">,</span>
    <span class="s2">&quot;6&quot;</span><span class="p">:</span> <span class="s2">&quot;⁶&quot;</span><span class="p">,</span>
    <span class="s2">&quot;7&quot;</span><span class="p">:</span> <span class="s2">&quot;⁷&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8&quot;</span><span class="p">:</span> <span class="s2">&quot;⁸&quot;</span><span class="p">,</span>
    <span class="s2">&quot;9&quot;</span><span class="p">:</span> <span class="s2">&quot;⁹&quot;</span><span class="p">,</span>
    <span class="s2">&quot;+&quot;</span><span class="p">:</span> <span class="s2">&quot;⁺&quot;</span><span class="p">,</span>
    <span class="s2">&quot;-&quot;</span><span class="p">:</span> <span class="s2">&quot;⁻&quot;</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="Stringify">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.Stringify">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Stringify</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mix-in class for string formatting, e.g. superscripting numbers and symbols or superscripting.&quot;&quot;&quot;</span>

    <span class="n">STRING_MODE</span> <span class="o">=</span> <span class="s2">&quot;SUBSCRIPT&quot;</span>

<div class="viewcode-block" id="Stringify.to_pretty_string">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.Stringify.to_pretty_string">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_pretty_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A pretty string representation. By default, the __str__ output is used, but this method can be</span>
<span class="sd">        overridden if a different representation from default is desired.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Stringify.to_latex_string">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.Stringify.to_latex_string">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_latex_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a LaTeX formatted string. The mode is set by the class variable STRING_MODE, which defaults to</span>
<span class="sd">        &quot;SUBSCRIPT&quot;. e.g. Fe2O3 is transformed to Fe$_{2}$O$_{3}$. Setting STRING_MODE to &quot;SUPERSCRIPT&quot; creates</span>
<span class="sd">        superscript, e.g. Fe2+ becomes Fe^{2+}. The initial string is obtained from the class&#39;s __str__ method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: for LaTeX display with proper sub-/superscripts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_pretty_string</span><span class="p">()</span>
        <span class="c1"># First we process strings that already have _ and ^ by escaping the relevant parts.</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_(\d+)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$_{\1}$&quot;</span><span class="p">,</span> <span class="n">str_</span><span class="p">)</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\^([\d\+\-]+)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$^{\1}$&quot;</span><span class="p">,</span> <span class="n">str_</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">STRING_MODE</span> <span class="o">==</span> <span class="s2">&quot;SUBSCRIPT&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Za-z\(\)])([\d\+\-\.]+)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1$_{\2}$&quot;</span><span class="p">,</span> <span class="n">str_</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">STRING_MODE</span> <span class="o">==</span> <span class="s2">&quot;SUPERSCRIPT&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Za-z\(\)])([\d\+\-\.]+)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1$^{\2}$&quot;</span><span class="p">,</span> <span class="n">str_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">str_</span></div>


<div class="viewcode-block" id="Stringify.to_html_string">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.Stringify.to_html_string">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_html_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a HTML formatted string. This uses the output from to_latex_string to generate a HTML output.</span>

<span class="sd">        Returns:</span>
<span class="sd">            HTML formatted string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\$_\{([^}]+)\}\$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;&lt;sub&gt;\1&lt;/sub&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_latex_string</span><span class="p">())</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\$\^\{([^}]+)\}\$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;&lt;sup&gt;\1&lt;/sup&gt;&quot;</span><span class="p">,</span> <span class="n">str_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;\$</span><span class="se">\\</span><span class="s2">overline\{([^}]+)\}\$&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s1">&#39;&lt;span style=&quot;text-decoration:overline&quot;&gt;\1&lt;/span&gt;&#39;</span><span class="p">,</span>
            <span class="n">str_</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Stringify.to_unicode_string">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.Stringify.to_unicode_string">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_unicode_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unicode string with proper sub and superscripts. Note that this works only</span>
<span class="sd">        with systems where the sub and superscripts are pure integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">str_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_latex_string</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\$_\{(\d+)\}\$&quot;</span><span class="p">,</span> <span class="n">str_</span><span class="p">):</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="n">SUBSCRIPT_UNICODE</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">str_</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\$\^\{([\d\+\-]+)\}\$&quot;</span><span class="p">,</span> <span class="n">str_</span><span class="p">):</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="n">SUPERSCRIPT_UNICODE</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">str_</span> <span class="o">=</span> <span class="n">str_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">str_</span></div>
</div>



<div class="viewcode-block" id="str_delimited">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.str_delimited">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">str_delimited</span><span class="p">(</span>
    <span class="n">results</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
    <span class="n">header</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Given a tuple of tuples, generate a delimited string form.</span>
<span class="sd">    &gt;&gt;&gt; results = ((&quot;a&quot;, &quot;b&quot;, &quot;c&quot;), (&quot;d&quot;, &quot;e&quot;, &quot;f&quot;), (1, 2, 3))</span>
<span class="sd">    &gt;&gt;&gt; print(str_delimited(results, delimiter=&quot;,&quot;))</span>
<span class="sd">        a,b,c</span>
<span class="sd">        d,e,f</span>
<span class="sd">        1,2,3.</span>

<span class="sd">    Args:</span>
<span class="sd">        results (Sequence[Sequence[Any]]): 2D sequence of arbitrary types.</span>
<span class="sd">        header (Sequence[str]): optional headers.</span>
<span class="sd">        delimiter (str): Defaults to &quot;\t&quot; for tab-delimited output.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Aligned string output in a table-like format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">out</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">result</span><span class="p">])</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">)</span></div>



<div class="viewcode-block" id="formula_double_format">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.formula_double_format">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">formula_double_format</span><span class="p">(</span>
    <span class="n">afloat</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">ignore_ones</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format a float for pretty formulas.</span>
<span class="sd">    E.g. &quot;Li1.0 Fe1.0 P1.0 O4.0&quot; -&gt; &quot;LiFePO4&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        afloat (float): The float to be formatted.</span>
<span class="sd">        ignore_ones (bool): if true, floats of 1.0 are ignored.</span>
<span class="sd">        tol (float): Absolute tolerance to round to nearest int. i.e. (2 + 1E-9) -&gt; 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float | &quot;&quot;: Formatted float for formulas.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ignore_ones</span> <span class="ow">and</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">afloat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="n">tol</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">afloat</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">afloat</span><span class="p">),</span> <span class="n">abs_tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">rel_tol</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">afloat</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">afloat</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span></div>



<div class="viewcode-block" id="charge_string">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.charge_string">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">charge_string</span><span class="p">(</span><span class="n">charge</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">brackets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">explicit_one</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a string representing the charge of an Ion. By default, the</span>
<span class="sd">    charge is placed in brackets with the sign preceding the magnitude, e.g.</span>
<span class="sd">    &#39;[+2]&#39;. For uncharged species, the string returned is &#39;(aq)&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        charge (float): The charge of the ion.</span>
<span class="sd">        brackets (bool): Whether to enclose the charge in brackets, e.g. [+2]. Default is True.</span>
<span class="sd">        explicit_one (bool): whether to include the number one for monovalent ions,</span>
<span class="sd">            e.g. &quot;+1&quot; rather than &quot;+&quot;. Default is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chg_str</span> <span class="o">=</span> <span class="s2">&quot;(aq)&quot;</span> <span class="k">if</span> <span class="n">charge</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">formula_double_format</span><span class="p">(</span><span class="n">charge</span><span class="p">,</span><span class="w"> </span><span class="n">ignore_ones</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="si">:</span><span class="s2">+</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">chg_str</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;+1&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">explicit_one</span><span class="p">:</span>
        <span class="n">chg_str</span> <span class="o">=</span> <span class="n">chg_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">chg_str</span> <span class="o">!=</span> <span class="s2">&quot;(aq)&quot;</span> <span class="ow">and</span> <span class="n">brackets</span><span class="p">:</span>
        <span class="n">chg_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">chg_str</span><span class="si">}</span><span class="s2">]&quot;</span>

    <span class="k">return</span> <span class="n">chg_str</span></div>



<div class="viewcode-block" id="latexify">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.latexify">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">latexify</span><span class="p">(</span><span class="n">formula</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a LaTeX formatted formula. e.g. Fe2O3 is transformed to</span>
<span class="sd">    Fe$_{2}$O$_{3}$.</span>

<span class="sd">    Note that Composition now has `to_latex_string` method that may</span>
<span class="sd">    be used instead.</span>

<span class="sd">    Args:</span>
<span class="sd">        formula (str): Input formula.</span>
<span class="sd">        bold (bool): Whether to make the subscripts bold. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Formula suitable for display as in LaTeX with proper subscripts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;([A-Za-z\(\)])([\d\.]+)&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;\1$_{</span><span class="se">\\</span><span class="s2">mathbf{\2}}$&quot;</span> <span class="k">if</span> <span class="n">bold</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;\1$_{\2}$&quot;</span><span class="p">,</span>
        <span class="n">formula</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="htmlify">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.htmlify">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">htmlify</span><span class="p">(</span><span class="n">formula</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a HTML formatted formula, e.g. Fe2O3 is transformed to</span>
<span class="sd">    Fe&lt;sub&gt;2&lt;/sub&gt;O&lt;/sub&gt;3&lt;/sub&gt;.</span>

<span class="sd">    Note that Composition now has a to_html_string() method that may</span>
<span class="sd">    be used instead.</span>

<span class="sd">    Args:</span>
<span class="sd">        formula (str): The string to format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([A-Za-z\(\)])([\d\.]+)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1&lt;sub&gt;\2&lt;/sub&gt;&quot;</span><span class="p">,</span> <span class="n">formula</span><span class="p">)</span></div>



<div class="viewcode-block" id="unicodeify">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.unicodeify">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">unicodeify</span><span class="p">(</span><span class="n">formula</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a formula with unicode subscripts, e.g. Fe2O3 is transformed</span>
<span class="sd">    to Fe₂O₃. Does not support formulae with decimal points.</span>

<span class="sd">    Note that Composition now has a to_unicode_string() method that may</span>
<span class="sd">    be used instead.</span>

<span class="sd">    Args:</span>
<span class="sd">        formula (str): The string to format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">formula</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No unicode character exists for subscript period.&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">original_subscript</span><span class="p">,</span> <span class="n">subscript_unicode</span> <span class="ow">in</span> <span class="n">SUBSCRIPT_UNICODE</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">formula</span> <span class="o">=</span> <span class="n">formula</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">original_subscript</span><span class="p">),</span> <span class="n">subscript_unicode</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">formula</span></div>



<div class="viewcode-block" id="latexify_spacegroup">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.latexify_spacegroup">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">latexify_spacegroup</span><span class="p">(</span><span class="n">spacegroup_symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generate a latex formatted spacegroup. e.g. P2_1/c is converted to</span>
<span class="sd">    P2$_{1}$/c and P-1 is converted to P$\\overline{1}$.</span>

<span class="sd">    Note that SymmetryGroup now has a to_latex_string() method that may</span>
<span class="sd">    be called instead.</span>

<span class="sd">    Args:</span>
<span class="sd">        spacegroup_symbol (str): A spacegroup symbol</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A latex formatted spacegroup with proper subscripts and overlines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_(\d+)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$_{\1}$&quot;</span><span class="p">,</span> <span class="n">spacegroup_symbol</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;-(\d)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">overline{\1}$&quot;</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span></div>



<div class="viewcode-block" id="unicodeify_spacegroup">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.unicodeify_spacegroup">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">unicodeify_spacegroup</span><span class="p">(</span><span class="n">spacegroup_symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Generate a unicode formatted spacegroup. e.g. P2$_{1}$/c is converted to</span>
<span class="sd">    P2₁/c and P$\\overline{1}$ is converted to P̅1.</span>

<span class="sd">    Note that SymmetryGroup now has a to_unicode_string() method that</span>
<span class="sd">    may be called instead.</span>

<span class="sd">    Args:</span>
<span class="sd">        spacegroup_symbol (str): A spacegroup symbol as LaTeX.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A unicode spacegroup with proper subscripts and overlines.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spacegroup_symbol</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="n">symbol</span> <span class="o">=</span> <span class="n">latexify_spacegroup</span><span class="p">(</span><span class="n">spacegroup_symbol</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">unicode_number</span> <span class="ow">in</span> <span class="n">SUBSCRIPT_UNICODE</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;$_</span><span class="se">{{</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="se">}}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">unicode_number</span><span class="p">)</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">unicode_number</span><span class="p">)</span>

    <span class="n">overline</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\u0305</span><span class="s2">&quot;</span>  <span class="c1"># u&quot;\u0304&quot; (macron) is also an option</span>

    <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">overline{&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># overline unicode symbol comes after the character with the overline</span>
    <span class="k">return</span> <span class="n">symbol</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span> <span class="n">overline</span><span class="p">)</span></div>



<div class="viewcode-block" id="unicodeify_species">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.unicodeify_species">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">unicodeify_species</span><span class="p">(</span><span class="n">specie_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a unicode formatted species string, with appropriate</span>
<span class="sd">    superscripts for oxidation states.</span>

<span class="sd">    Note that Species now has `to_unicode_string` method that</span>
<span class="sd">    may be used instead.</span>

<span class="sd">    Args:</span>
<span class="sd">        specie_string (str): Species string, e.g. &quot;O2-&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Species string, e.g. &quot;O²⁻&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">specie_string</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">unicode_char</span> <span class="ow">in</span> <span class="n">SUPERSCRIPT_UNICODE</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">specie_string</span> <span class="o">=</span> <span class="n">specie_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">unicode_char</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">specie_string</span></div>



<div class="viewcode-block" id="stream_has_colors">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.stream_has_colors">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stream_has_colors</span><span class="p">(</span><span class="n">stream</span><span class="p">:</span> <span class="n">TextIO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;True if stream supports colors. Python cookbook, #475186.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s2">&quot;isatty&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">stream</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># auto color only on TTYs</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">curses</span>

        <span class="n">curses</span><span class="o">.</span><span class="n">setupterm</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># guess false in case of error</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">curses</span><span class="o">.</span><span class="n">tigetnum</span><span class="p">(</span><span class="s2">&quot;colors&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span></div>



<div class="viewcode-block" id="transformation_to_string">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.transformation_to_string">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">transformation_to_string</span><span class="p">(</span>
    <span class="n">matrix</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
    <span class="n">translation_vec</span><span class="p">:</span> <span class="n">Vector3D</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">components</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">),</span>
    <span class="n">c</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">delim</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience method. Given matrix returns string, e.g. x+2y+1/4.</span>

<span class="sd">    Args:</span>
<span class="sd">        matrix (ArrayLike): A 3x3 matrix.</span>
<span class="sd">        translation_vec (Vector3D): The translation vector. Defaults to (0, 0, 0).</span>
<span class="sd">        components(tuple[str, str, str]): The components. Either (&#39;x&#39;, &#39;y&#39;, &#39;z&#39;) or (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;).</span>
<span class="sd">            Defaults to (&#39;x&#39;, &#39;y&#39;, &#39;z&#39;).</span>
<span class="sd">        c (str): An optional additional character to print (used for magmoms). Defaults to &quot;&quot;.</span>
<span class="sd">        delim (str): A delimiter. Defaults to &quot;,&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: xyz string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">translation_vec</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">components</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">string</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">f</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot;+&quot;</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">numerator</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">numerator</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot;-&quot;</span>
                <span class="n">string</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">+</span> <span class="n">dim</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">denominator</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">denominator</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;+&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">string</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Fraction</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s2">&quot;0&quot;</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span></div>



<div class="viewcode-block" id="disordered_formula">
<a class="viewcode-back" href="../../../pymatgen.util.html#pymatgen.util.string.disordered_formula">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">disordered_formula</span><span class="p">(</span>
    <span class="n">disordered_struct</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
    <span class="n">symbols</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">),</span>
    <span class="n">fmt</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;plain&quot;</span><span class="p">,</span> <span class="s2">&quot;HTML&quot;</span><span class="p">,</span> <span class="s2">&quot;LaTex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;plain&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a formula of a form like AxB1-x (x=0.5)</span>
<span class="sd">    for disordered structures. Will only return a</span>
<span class="sd">    formula for disordered structures with one</span>
<span class="sd">    kind of disordered site at present.</span>

<span class="sd">    Args:</span>
<span class="sd">        disordered_struct (Structure): a disordered structure.</span>
<span class="sd">        symbols (Sequence[str]): Characters to use for subscripts,</span>
<span class="sd">            by default this is (&#39;x&#39;, &#39;y&#39;, &#39;z&#39;) but if you have more than three</span>
<span class="sd">            disordered species more symbols will need to be added.</span>
<span class="sd">        fmt (str): &#39;plain&#39;, &#39;HTML&#39; or &#39;LaTeX&#39;,</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: a disordered formula string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># this is in string utils and not in Composition because we need to have access to</span>
    <span class="c1"># site occupancies to calculate this, so have to pass the full structure as an</span>
    <span class="c1"># argument (alternatively this could be made a method on Structure)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">Composition</span><span class="p">,</span> <span class="n">get_el_sp</span>

    <span class="k">if</span> <span class="n">disordered_struct</span><span class="o">.</span><span class="n">is_ordered</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Structure is not disordered, so disordered formula not defined.&quot;</span><span class="p">)</span>

    <span class="n">disordered_site_compositions</span> <span class="o">=</span> <span class="p">{</span><span class="n">site</span><span class="o">.</span><span class="n">species</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">disordered_struct</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">site</span><span class="o">.</span><span class="n">is_ordered</span><span class="p">}</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">disordered_site_compositions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># this probably won&#39;t happen too often</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Ambiguous how to define disordered formula when more than one type of disordered site is present.&quot;</span>
        <span class="p">)</span>
    <span class="n">disordered_site_composition</span> <span class="o">=</span> <span class="n">disordered_site_compositions</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="n">disordered_species</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span> <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">_occu</span> <span class="ow">in</span> <span class="n">disordered_site_composition</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">disordered_species</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">):</span>
        <span class="c1"># this probably won&#39;t happen too often either</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not enough symbols to describe disordered composition: </span><span class="si">{</span><span class="n">symbols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">symbols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="p">)[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">disordered_species</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">comp</span> <span class="o">=</span> <span class="n">disordered_struct</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_el_amt_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="c1"># sort by electronegativity, as per composition</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_el_sp</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>

    <span class="n">disordered_comp</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">variable_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">total_disordered_occu</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occu</span> <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">occu</span> <span class="ow">in</span> <span class="n">comp</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span> <span class="ow">in</span> <span class="n">disordered_species</span><span class="p">)</span>

    <span class="c1"># composition to get common factor</span>
    <span class="n">factor_comp</span> <span class="o">=</span> <span class="n">disordered_struct</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
    <span class="n">factor_comp</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_disordered_occu</span>
    <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">disordered_species</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">factor_comp</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sp</span><span class="p">)]</span>
    <span class="n">factor_comp</span> <span class="o">=</span> <span class="n">Composition</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">factor_comp</span><span class="p">)</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">factor_comp</span><span class="o">.</span><span class="n">get_reduced_formula_and_factor</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">total_disordered_occu</span> <span class="o">/=</span> <span class="n">factor</span>
    <span class="n">remainder</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">formula_double_format</span><span class="p">(</span><span class="n">total_disordered_occu</span><span class="p">,</span><span class="w"> </span><span class="n">ignore_ones</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">occu</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">:</span>
        <span class="n">species</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">species</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">disordered_species</span><span class="p">:</span>
            <span class="n">disordered_comp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">species</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">formula_double_format</span><span class="p">(</span><span class="n">occu</span> <span class="o">/</span> <span class="n">factor</span><span class="p">))))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbols</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">disordered_comp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">species</span><span class="p">,</span> <span class="n">symbol</span><span class="p">))</span>
            <span class="n">variable_map</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">occu</span> <span class="o">/</span> <span class="n">total_disordered_occu</span> <span class="o">/</span> <span class="n">factor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">disordered_comp</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">species</span><span class="p">,</span> <span class="n">remainder</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;LaTeX&quot;</span><span class="p">:</span>
        <span class="n">sub_start</span> <span class="o">=</span> <span class="s2">&quot;_{&quot;</span>
        <span class="n">sub_end</span> <span class="o">=</span> <span class="s2">&quot;}&quot;</span>
    <span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;HTML&quot;</span><span class="p">:</span>
        <span class="n">sub_start</span> <span class="o">=</span> <span class="s2">&quot;&lt;sub&gt;&quot;</span>
        <span class="n">sub_end</span> <span class="o">=</span> <span class="s2">&quot;&lt;/sub&gt;&quot;</span>
    <span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;plain&quot;</span><span class="p">:</span>
        <span class="n">sub_start</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">sub_end</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported output format, choose from: LaTeX, HTML, plain&quot;</span><span class="p">)</span>

    <span class="n">disordered_formulas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">occu</span> <span class="ow">in</span> <span class="n">disordered_comp</span><span class="p">:</span>
        <span class="n">disordered_formulas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">occu</span><span class="p">:</span>  <span class="c1"># can be empty string if 1</span>
            <span class="k">if</span> <span class="n">fmt</span> <span class="o">!=</span> <span class="s2">&quot;plain&quot;</span><span class="p">:</span>
                <span class="n">disordered_formulas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_start</span><span class="p">)</span>
            <span class="n">disordered_formulas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">occu</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fmt</span> <span class="o">!=</span> <span class="s2">&quot;plain&quot;</span><span class="p">:</span>
                <span class="n">disordered_formulas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_end</span><span class="p">)</span>
    <span class="n">disordered_formulas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">disordered_formulas</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">formula_double_format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">variable_map</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">disordered_formulas</span><span class="p">))[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.util.string</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>