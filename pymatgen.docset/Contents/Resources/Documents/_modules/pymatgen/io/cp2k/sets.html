
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pymatgen.io.cp2k.sets &#8212; pymatgen 2021.2.8.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33990148-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 2021.2.8.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.io.cp2k.sets</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module defines input sets for CP2K and is a work in progress. The structure/philosophy</span>
<span class="sd">of this module is based on the Vasp input sets in Pymatgen. These sets are meant to contain</span>
<span class="sd">tested parameters that will result in successful, reproducible, consistent calculations without</span>
<span class="sd">need for intervention 99% of the time. 99% of the time, you only need to provide a pymatgen</span>
<span class="sd">structure object and let the defaults take over from there.</span>

<span class="sd">The sets are intended to be very general, e.g. a set for geometry relaxation, and so most of the</span>
<span class="sd">time, if you have specific needs, you can simply specify them via the keyword argument</span>
<span class="sd">override_default_params (see Section.update() method). If you have the need to create a new input</span>
<span class="sd">set (say for a standardized high throughput calculation) then you can create a new child of the</span>
<span class="sd">Cp2kInputSet class.</span>

<span class="sd">In order to implement a new Set within the current code structure, follow this 3 step flow:</span>
<span class="sd">    (1) Inherit from Cp2kInputSet or one of its children and call the super() constructor</span>
<span class="sd">    (2) Create the new sections and insert them into self and its subsections as needed</span>
<span class="sd">    (3) Call self.update(override_default_params) in order to allow user settings.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">pymatgen.core.periodic_table</span> <span class="k">import</span> <span class="n">Element</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.lattice</span> <span class="k">import</span> <span class="n">Lattice</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="k">import</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">Structure</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.cp2k.inputs</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">LDOS</span><span class="p">,</span>
    <span class="n">PBE</span><span class="p">,</span>
    <span class="n">PDOS</span><span class="p">,</span>
    <span class="n">QS</span><span class="p">,</span>
    <span class="n">XC_FUNCTIONAL</span><span class="p">,</span>
    <span class="n">Cell</span><span class="p">,</span>
    <span class="n">Coord</span><span class="p">,</span>
    <span class="n">Cp2kInput</span><span class="p">,</span>
    <span class="n">Dft</span><span class="p">,</span>
    <span class="n">E_Density_Cube</span><span class="p">,</span>
    <span class="n">ForceEval</span><span class="p">,</span>
    <span class="n">Global</span><span class="p">,</span>
    <span class="n">Keyword</span><span class="p">,</span>
    <span class="n">KeywordList</span><span class="p">,</span>
    <span class="n">Kind</span><span class="p">,</span>
    <span class="n">Kpoints</span><span class="p">,</span>
    <span class="n">Mgrid</span><span class="p">,</span>
    <span class="n">MO_Cubes</span><span class="p">,</span>
    <span class="n">OrbitalTransformation</span><span class="p">,</span>
    <span class="n">Scf</span><span class="p">,</span>
    <span class="n">Section</span><span class="p">,</span>
    <span class="n">Smear</span><span class="p">,</span>
    <span class="n">Subsys</span><span class="p">,</span>
    <span class="n">V_Hartree_Cube</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.cp2k.utils</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">get_aux_basis</span><span class="p">,</span>
    <span class="n">get_basis_and_potential</span><span class="p">,</span>
    <span class="n">get_unique_site_indices</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Nicholas Winner&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.2&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;nwinner@berkeley.edu&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;January 2019&quot;</span>

<span class="n">MODULE_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span>


<div class="viewcode-block" id="Cp2kInputSet"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.Cp2kInputSet">[docs]</a><span class="k">class</span> <span class="nc">Cp2kInputSet</span><span class="p">(</span><span class="n">Cp2kInput</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The basic representation of a CP2K input set as a collection of &quot;sections&quot; defining the simulation</span>
<span class="sd">    connected to a structure object. At the most basis level, CP2K requires a &amp;GLOBAL section and</span>
<span class="sd">    &amp;FORCE_EVAL section. Global sets parameters like &quot;RUN_TYPE&quot; or the overall verbosity. FORCE_EVAL is</span>
<span class="sd">    the largest section usually, containing the cell and coordinates of atoms, the DFT settings, and more.</span>
<span class="sd">    This top level input set is meant to initialize GLOBAL and FORCE_EVAL based on a structure object and</span>
<span class="sd">    and sections that the user provides.</span>

<span class="sd">    Like everything that goes into a cp2k input file, this base input set is essentially a section object.</span>
<span class="sd">    These sets are distinguished by saving default settings for easy implementation of calculations such</span>
<span class="sd">    as relaxation and static calculations. This base set is here to transfer a pymatgen structure object</span>
<span class="sd">    into the input format for cp2k and associate the basis set and pseudopotential to use with each</span>
<span class="sd">    element in the structure.</span>

<span class="sd">    Generally, this class will not be used directly, and instead one of</span>
<span class="sd">    its child-classes will be used, which contain more predefined initializations of various sections, and,</span>
<span class="sd">    if modifications are required, the user can specify override_default_settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">],</span>
        <span class="n">potential_and_basis</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">multiplicity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;CP2K&quot;</span><span class="p">,</span>
        <span class="n">override_default_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure: (Structure or Molecule) pymatgen structure or molecule object used to define</span>
<span class="sd">                the lattice, coordinates, and elements. This structure object cannot contain &quot;special&quot;</span>
<span class="sd">                species like the Dummy species, e.g. X, or fractional occupations, e.g. Fe0.2, etc.</span>
<span class="sd">            potential_and_basis: (dict) Specifies what basis set and potential to use. Specify these</span>
<span class="sd">                as a dict of the form:</span>
<span class="sd">                    { element: {&#39;cardinality&#39;: __, &#39;sr&#39;: __, &#39;q&#39;: __},</span>
<span class="sd">                     &#39;cardinality&#39;: __, &#39;functional&#39;: __}</span>
<span class="sd">                Where cardinality and functional are overall specifications (for all elements), while</span>
<span class="sd">                &lt;key=&#39;element&#39;&gt; specifies the overrides for a specific element. Currently the following</span>
<span class="sd">                conventions must be followed:</span>
<span class="sd">                    (a) All species of a particular element must have the same potential/basis</span>
<span class="sd">            multiplicity: (int) Specify the system&#39;s multiplicity if appropriate</span>
<span class="sd">            project_name: (str) Specify the project name. This will be used to name the output files</span>
<span class="sd">                from a CP2K calculation</span>
<span class="sd">            override_default_params: (dict) Specifies user-defined settings to override the settings of any</span>
<span class="sd">                input set (See Section.update())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;CP2K_INPUT&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{})</span>

        <span class="c1"># Important CP2K set parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">charge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_and_basis</span> <span class="o">=</span> <span class="n">potential_and_basis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span> <span class="o">=</span> <span class="n">multiplicity</span>  <span class="c1"># spin multiplicity = 2s+1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">override_default_params</span> <span class="o">=</span> <span class="n">override_default_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">Element</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">ForceEval</span><span class="p">())</span>  <span class="c1"># always present in cp2k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis_set_file_names</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># need for dft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_file_name</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># need for dft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_subsys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>  <span class="c1"># assemble structure with atom types and pseudopotentials assigned</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;print_forces&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_forces</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;print_motion&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_motion</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">override_default_params</span><span class="p">)</span>

<div class="viewcode-block" id="Cp2kInputSet.create_subsys"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.Cp2kInputSet.create_subsys">[docs]</a>    <span class="k">def</span> <span class="nf">create_subsys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the structure for the input</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subsys</span> <span class="o">=</span> <span class="n">Subsys</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">Structure</span><span class="p">):</span>
            <span class="n">subsys</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Cell</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="p">))</span>

        <span class="c1"># Decide what basis sets/pseudopotentials to use</span>
        <span class="n">basis_and_potential</span> <span class="o">=</span> <span class="n">get_basis_and_potential</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">species</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">potential_and_basis</span><span class="p">)</span>

        <span class="c1"># Insert atom kinds by identifying the unique sites (unique element and site properties)</span>
        <span class="n">unique_kinds</span> <span class="o">=</span> <span class="n">get_unique_site_indices</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">unique_kinds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s2">&quot;magmom&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">site_properties</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;magnetization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">site_properties</span><span class="p">[</span><span class="s2">&quot;magmom&quot;</span><span class="p">][</span><span class="n">unique_kinds</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

            <span class="k">if</span> <span class="s2">&quot;ghost&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">site_properties</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;ghost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">site_properties</span><span class="p">[</span><span class="s2">&quot;ghost&quot;</span><span class="p">][</span><span class="n">unique_kinds</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

            <span class="k">if</span> <span class="s2">&quot;basis_set&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">site_properties</span><span class="p">:</span>
                <span class="n">basis_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">site_properties</span><span class="p">[</span><span class="s2">&quot;basis_set&quot;</span><span class="p">][</span><span class="n">unique_kinds</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">basis_set</span> <span class="o">=</span> <span class="n">basis_and_potential</span><span class="p">[</span><span class="n">kind</span><span class="p">][</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s2">&quot;potential&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">site_properties</span><span class="p">:</span>
                <span class="n">potential</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">site_properties</span><span class="p">[</span><span class="s2">&quot;potential&quot;</span><span class="p">][</span><span class="n">unique_kinds</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">potential</span> <span class="o">=</span> <span class="n">basis_and_potential</span><span class="p">[</span><span class="n">kind</span><span class="p">][</span><span class="s2">&quot;potential&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s2">&quot;aux_basis&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">site_properties</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">site_properties</span><span class="p">[</span><span class="s2">&quot;aux_basis&quot;</span><span class="p">][</span><span class="n">unique_kinds</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

            <span class="n">subsys</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Kind</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="n">basis_set</span><span class="p">,</span> <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="n">unique_kinds</span><span class="p">)</span>
        <span class="n">subsys</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">subsys</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis_set_file_names</span> <span class="o">=</span> <span class="n">basis_and_potential</span><span class="p">[</span><span class="s2">&quot;basis_filenames&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_file_name</span> <span class="o">=</span> <span class="n">basis_and_potential</span><span class="p">[</span><span class="s2">&quot;potential_filename&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="Cp2kInputSet.print_forces"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.Cp2kInputSet.print_forces">[docs]</a>    <span class="k">def</span> <span class="nf">print_forces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print out the forces and stress during calculation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;PRINT&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;FORCES&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;STRESS_TENSOR&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span></div>

<div class="viewcode-block" id="Cp2kInputSet.print_motion"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.Cp2kInputSet.print_motion">[docs]</a>    <span class="k">def</span> <span class="nf">print_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the motion info (trajectory, cell, forces, stress</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s2">&quot;MOTION&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;MOTION&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;MOTION&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;PRINT&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;MOTION&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;TRAJECTORY&quot;</span><span class="p">,</span> <span class="n">section_parameters</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ON&quot;</span><span class="p">],</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;MOTION&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;CELL&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;MOTION&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;FORCES&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;MOTION&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;STRESS&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span></div></div>


<div class="viewcode-block" id="DftSet"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet">[docs]</a><span class="k">class</span> <span class="nc">DftSet</span><span class="p">(</span><span class="n">Cp2kInputSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base for an input set using the Quickstep module (i.e. a DFT calculation). The DFT section is pretty vast</span>
<span class="sd">    in CP2K, so this set hopes to make the DFT setup fairly simple. The provided parameters are pretty conservative,</span>
<span class="sd">    and so they should not need to be changed very often.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">],</span>
        <span class="n">ot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">band_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="n">eps_default</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-12</span><span class="p">,</span>
        <span class="n">eps_scf</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">,</span>
        <span class="n">max_scf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">minimizer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DIIS&quot;</span><span class="p">,</span>
        <span class="n">preconditioner</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;FULL_ALL&quot;</span><span class="p">,</span>
        <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;STRICT&quot;</span><span class="p">,</span>
        <span class="n">linesearch</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;2PNT&quot;</span><span class="p">,</span>
        <span class="n">cutoff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
        <span class="n">rel_cutoff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>
        <span class="n">ngrids</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">progression_factor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">override_default_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">wfn_restart_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kpoints</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Kpoints</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">smearing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure: Pymatgen structure or molecule object</span>
<span class="sd">            ot (bool): Whether or not to use orbital transformation method for matrix diagonalization. OT is the</span>
<span class="sd">                flagship scf solver of CP2K, and will provide huge speed-ups for this part of the calculation,</span>
<span class="sd">                but the system must have a band gap for OT to be used (higher band-gap --&gt; faster convergence).</span>
<span class="sd">                Band gap is also used by the preconditioner for OT, and should be set as a value SMALLER than the true</span>
<span class="sd">                band gap to get good efficiency. Generally, this parameter does not need to be changed from</span>
<span class="sd">                default of 0.01</span>
<span class="sd">            band_gap (float): The band gap can also be specified in order to determine if ot should be turned on.</span>
<span class="sd">            eps_default (float): Replaces all EPS_XX Keywords in the DFT section (NOT its subsections!) to have this</span>
<span class="sd">                value, ensuring an overall accuracy of at least this much.</span>
<span class="sd">            eps_scf (float): The convergence criteria for leaving the SCF loop in Hartrees. Default is 1e-7. Should</span>
<span class="sd">                ensure reasonable results for all properties. Smaller than 1e-7 is generally not needed unless</span>
<span class="sd">                you need very high precision. 1e-6 may be used for difficult systems, and should still give</span>
<span class="sd">                reasonable results for most properties.</span>
<span class="sd">            max_scf (int): The max number of SCF cycles before terminating the solver. NOTE: With the OT solver, this</span>
<span class="sd">                corresponds to the max number of INNER scf loops, and then the outer loops are set with outer_max_scf,</span>
<span class="sd">                while with diagnolization it corresponds to the overall (INNER*OUTER) number of SCF steps, with the</span>
<span class="sd">                inner loop limit set by</span>
<span class="sd">            minimizer (str): The minimization scheme. DIIS can be as much as 50% faster than the more robust conjugate</span>
<span class="sd">                gradient method, and so it is chosen as default. Switch to CG if dealing with a difficult system.</span>
<span class="sd">            preconditioner (str): Preconditioner for the OT method. FULL_ALL is the most reliable, and is the</span>
<span class="sd">                default. Though FULL_SINGLE_INVERSE has faster convergence according to our internal tests. Should</span>
<span class="sd">                only change from theses two when simulation cell gets to be VERY large,</span>
<span class="sd">                in which case FULL_KINETIC might be preferred.</span>
<span class="sd">            cutoff (int): Cutoff energy (in Ry) for the finest level of the multigrid. A high cutoff will allow you to</span>
<span class="sd">                have very accurate calculations PROVIDED that REL_CUTOFF is appropriate.</span>
<span class="sd">            rel_cutoff (int): This cutoff decides how the Guassians are mapped onto the different levels of the</span>
<span class="sd">                multigrid. From CP2K: A Gaussian is mapped onto the coarsest level of the multi-grid, on which the</span>
<span class="sd">                    function will cover number of grid points greater than or equal to the number of grid points</span>
<span class="sd">                    will cover on a reference grid defined by REL_CUTOFF.</span>
<span class="sd">            progression_factor (int): Divisor of CUTOFF to get the cutoff for the next level of the multigrid.</span>

<span class="sd">            Takeaway for the cutoffs: https://www.cp2k.org/howto:converging_cutoff</span>
<span class="sd">            If CUTOFF is too low, then all grids will be coarse and the calculation may become inaccurate; and if</span>
<span class="sd">            REL_CUTOFF is too low, then even if you have a high CUTOFF, all Gaussians will be mapped onto the coarsest</span>
<span class="sd">            level of the multi-grid, and thus the effective integration grid for the calculation may still be too</span>
<span class="sd">            coarse.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ot</span> <span class="o">=</span> <span class="n">ot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">band_gap</span> <span class="o">=</span> <span class="n">band_gap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps_default</span> <span class="o">=</span> <span class="n">eps_default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps_scf</span> <span class="o">=</span> <span class="n">eps_scf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scf</span> <span class="o">=</span> <span class="n">max_scf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimizer</span> <span class="o">=</span> <span class="n">minimizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preconditioner</span> <span class="o">=</span> <span class="n">preconditioner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="n">algorithm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linesearch</span> <span class="o">=</span> <span class="n">linesearch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_cutoff</span> <span class="o">=</span> <span class="n">rel_cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ngrids</span> <span class="o">=</span> <span class="n">ngrids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progression_factor</span> <span class="o">=</span> <span class="n">progression_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">override_default_params</span> <span class="o">=</span> <span class="n">override_default_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfn_restart_file_name</span> <span class="o">=</span> <span class="n">wfn_restart_file_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">kpoints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smearing</span> <span class="o">=</span> <span class="n">smearing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="c1"># Build the QS Section</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">QS</span><span class="p">(</span><span class="n">eps_default</span><span class="o">=</span><span class="n">eps_default</span><span class="p">)</span>
        <span class="n">max_scf</span> <span class="o">=</span> <span class="n">max_scf</span> <span class="k">if</span> <span class="n">max_scf</span> <span class="k">else</span> <span class="mi">20</span> <span class="k">if</span> <span class="n">ot</span> <span class="k">else</span> <span class="mi">400</span>  <span class="c1"># If ot, max_scf is for inner loop</span>
        <span class="n">scf</span> <span class="o">=</span> <span class="n">Scf</span><span class="p">(</span><span class="n">eps_scf</span><span class="o">=</span><span class="n">eps_scf</span><span class="p">,</span> <span class="n">max_scf</span><span class="o">=</span><span class="n">max_scf</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{})</span>

        <span class="c1"># If there&#39;s a band gap, use OT, else use Davidson</span>
        <span class="k">if</span> <span class="n">ot</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">band_gap</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Orbital Transformation method is being used for&quot;</span>
                    <span class="s2">&quot;a system without a bandgap. OT can have very poor&quot;</span>
                    <span class="s2">&quot;convergence for metallic systems, proceed with caution.&quot;</span><span class="p">,</span>
                    <span class="ne">UserWarning</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">scf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">OrbitalTransformation</span><span class="p">(</span>
                    <span class="n">minimizer</span><span class="o">=</span><span class="n">minimizer</span><span class="p">,</span>
                    <span class="n">preconditioner</span><span class="o">=</span><span class="n">preconditioner</span><span class="p">,</span>
                    <span class="n">energy_gap</span><span class="o">=</span><span class="n">band_gap</span><span class="p">,</span>
                    <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
                    <span class="n">linesearch</span><span class="o">=</span><span class="n">linesearch</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">scf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">Section</span><span class="p">(</span>
                    <span class="s2">&quot;OUTER_SCF&quot;</span><span class="p">,</span>
                    <span class="n">subsections</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">keywords</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;MAX_SCF&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;MAX_SCF&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outer_max_scf&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)),</span>
                        <span class="s2">&quot;EPS_SCF&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;EPS_SCF&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outer_eps_scf&quot;</span><span class="p">,</span> <span class="n">eps_scf</span><span class="p">)),</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;DIAGONALIZATION&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span>
            <span class="n">mixing_kwds</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;METHOD&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;METHOD&quot;</span><span class="p">,</span> <span class="s2">&quot;BROYDEN_MIXING&quot;</span><span class="p">),</span>
                <span class="s2">&quot;ALPHA&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;ALPHA&quot;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
                <span class="s2">&quot;NBUFFER&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;NBUFFER&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">mixing</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="s2">&quot;MIXING&quot;</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="n">mixing_kwds</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">scf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">mixing</span><span class="p">)</span>
            <span class="n">davidson_kwds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;PRECONDITIONER&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;PRECONDITIONER&quot;</span><span class="p">,</span> <span class="s2">&quot;FULL_ALL&quot;</span><span class="p">)}</span>
            <span class="n">davidson</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="s2">&quot;DAVIDSON&quot;</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="n">davidson_kwds</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">scf</span><span class="p">[</span><span class="s2">&quot;DIAGONALIZATION&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">davidson</span><span class="p">)</span>

        <span class="c1"># Create the multigrid for FFTs</span>
        <span class="n">mgrid</span> <span class="o">=</span> <span class="n">Mgrid</span><span class="p">(</span>
            <span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span>
            <span class="n">rel_cutoff</span><span class="o">=</span><span class="n">rel_cutoff</span><span class="p">,</span>
            <span class="n">ngrids</span><span class="o">=</span><span class="n">ngrids</span><span class="p">,</span>
            <span class="n">progression_factor</span><span class="o">=</span><span class="n">progression_factor</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Set the DFT calculation with global parameters</span>
        <span class="n">dft</span> <span class="o">=</span> <span class="n">Dft</span><span class="p">(</span>
            <span class="n">MULTIPLICITY</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">,</span>
            <span class="n">CHARGE</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
            <span class="n">basis_set_filenames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basis_set_file_names</span><span class="p">,</span>
            <span class="n">potential_filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_file_name</span><span class="p">,</span>
            <span class="n">subsections</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;QS&quot;</span><span class="p">:</span> <span class="n">qs</span><span class="p">,</span> <span class="s2">&quot;SCF&quot;</span><span class="p">:</span> <span class="n">scf</span><span class="p">,</span> <span class="s2">&quot;MGRID&quot;</span><span class="p">:</span> <span class="n">mgrid</span><span class="p">},</span>
            <span class="n">wfn_restart_file_name</span><span class="o">=</span><span class="n">wfn_restart_file_name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">kpoints</span><span class="p">:</span>
            <span class="n">dft</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Kpoints</span><span class="o">.</span><span class="n">from_kpoints</span><span class="p">(</span><span class="n">kpoints</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">smearing</span> <span class="ow">or</span> <span class="p">(</span><span class="n">band_gap</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">scf</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;ADDED_MOS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="n">scf</span><span class="p">[</span><span class="s2">&quot;ADDED_MOS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># TODO: how to grab the appropriate number?</span>
            <span class="n">scf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Smear</span><span class="p">())</span>

        <span class="c1"># Create subsections and insert into them</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">dft</span><span class="p">)</span>
        <span class="n">xc_functional</span> <span class="o">=</span> <span class="n">XC_FUNCTIONAL</span><span class="p">(</span><span class="n">functional</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;functional&quot;</span><span class="p">,</span> <span class="s2">&quot;PBE&quot;</span><span class="p">))</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="s2">&quot;XC&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;XC_FUNCTIONAL&quot;</span><span class="p">:</span> <span class="n">xc_functional</span><span class="p">})</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">xc</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;PRINT&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activate_nonperiodic</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;print_pdos&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_pdos</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;print_ldos&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_ldos</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;print_mo_cubes&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_mo_cubes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;print_hartree_potential&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_hartree_potential</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;print_e_density&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_e_density</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">override_default_params</span><span class="p">)</span>

<div class="viewcode-block" id="DftSet.print_pdos"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.print_pdos">[docs]</a>    <span class="k">def</span> <span class="nf">print_pdos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlumo</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activate creation of the PDOS file.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlumo (int): Number of virtual orbitals to be added to the MO set (-1=all).</span>
<span class="sd">                CAUTION: Setting this value to be higher than the number of states present may cause a Cholesky error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s2">&quot;FORCE_EVAL/DFT/PRINT/PDOS&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">PDOS</span><span class="p">(</span><span class="n">nlumo</span><span class="o">=</span><span class="n">nlumo</span><span class="p">))</span></div>

<div class="viewcode-block" id="DftSet.print_ldos"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.print_ldos">[docs]</a>    <span class="k">def</span> <span class="nf">print_ldos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlumo</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activate the printing of LDOS files, printing one for each atom kind by default</span>

<span class="sd">        Args:</span>
<span class="sd">            nlumo (int): Number of virtual orbitals to be added to the MO set (-1=all).</span>
<span class="sd">                CAUTION: Setting this value to be higher than the number of states present may cause a Cholesky error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s2">&quot;FORCE_EVAL/DFT/PRINT/PDOS&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">PDOS</span><span class="p">(</span><span class="n">nlumo</span><span class="o">=</span><span class="n">nlumo</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">num_sites</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">][</span><span class="s2">&quot;PDOS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">LDOS</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;LDOS </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span></div>

<div class="viewcode-block" id="DftSet.print_mo_cubes"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.print_mo_cubes">[docs]</a>    <span class="k">def</span> <span class="nf">print_mo_cubes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write_cube</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nlumo</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nhomo</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activate printing of molecular orbitals.</span>

<span class="sd">        Args:</span>
<span class="sd">            write_cube (bool): whether to write cube file for the MOs (setting false will just print levels in out file)</span>
<span class="sd">            nlumo (int): Controls the number of lumos that are printed and dumped as a cube (-1=all)</span>
<span class="sd">            nhomo (int): Controls the number of homos that are printed and dumped as a cube (-1=all)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s2">&quot;FORCE_EVAL/DFT/PRINT/MO_CUBES&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">MO_Cubes</span><span class="p">(</span><span class="n">write_cube</span><span class="o">=</span><span class="n">write_cube</span><span class="p">,</span> <span class="n">nlumo</span><span class="o">=</span><span class="n">nlumo</span><span class="p">,</span> <span class="n">nhomo</span><span class="o">=</span><span class="n">nhomo</span><span class="p">))</span></div>

<div class="viewcode-block" id="DftSet.print_mo"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.print_mo">[docs]</a>    <span class="k">def</span> <span class="nf">print_mo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print molecular orbitals when running non-OT diagonalization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="DftSet.print_hartree_potential"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.print_hartree_potential">[docs]</a>    <span class="k">def</span> <span class="nf">print_hartree_potential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Controls the printing of a cube file with eletrostatic potential generated by the total density</span>
<span class="sd">        (electrons+ions). It is valid only for QS with GPW formalism.</span>
<span class="sd">        Note that by convention the potential has opposite sign than the expected physical one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s2">&quot;FORCE_EVAL/DFT/PRINT/V_HARTREE_CUBE&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">V_Hartree_Cube</span><span class="p">(</span><span class="n">keywords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;STRIDE&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;STRIDE&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">stride</span><span class="p">)}))</span></div>

<div class="viewcode-block" id="DftSet.print_e_density"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.print_e_density">[docs]</a>    <span class="k">def</span> <span class="nf">print_e_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Controls the printing of cube files with the electronic density and, for LSD calculations, the spin density</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s2">&quot;FORCE_EVAL/DFT/PRINT/E_DENSITY_CUBE&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">][</span><span class="s2">&quot;PRINT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">E_Density_Cube</span><span class="p">())</span></div>

<div class="viewcode-block" id="DftSet.set_charge"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.set_charge">[docs]</a>    <span class="k">def</span> <span class="nf">set_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">charge</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the overall charge of the simulation cell</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">][</span><span class="s2">&quot;CHARGE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;CHARGE&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="p">)</span></div>

<div class="viewcode-block" id="DftSet.activate_hybrid"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.activate_hybrid">[docs]</a>    <span class="k">def</span> <span class="nf">activate_hybrid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hybrid_functional</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PBE0&quot;</span><span class="p">,</span>
        <span class="n">hf_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="n">gga_x_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">gga_c_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">max_memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="n">cutoff_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
        <span class="n">potential_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">omega</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="n">aux_basis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">admm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">eps_schwarz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
        <span class="n">eps_schwarz_forces</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
        <span class="n">screen_on_initial_p</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">screen_p_forces</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Basic set for activating hybrid DFT calculation using Auxiliary Density Matrix Method.</span>

<span class="sd">        Note 1: When running ADMM with cp2k, memory is very important. If the memory requirements exceed</span>
<span class="sd">        what is available (see max_memory), then CP2K will have to calculate the 4-electron integrals</span>
<span class="sd">        for HFX during each step of the SCF cycle. ADMM provides a huge speed up by making the memory</span>
<span class="sd">        requirements *feasible* to fit into RAM, which means you only need to calculate the integrals</span>
<span class="sd">        once each SCF cycle. But, this only works if it fits into memory. When setting up ADMM</span>
<span class="sd">        calculations, we recommend doing whatever is possible to fit all the 4EI into memory.</span>

<span class="sd">        Note 2: This set is designed for reliable high-throughput calculations, NOT for extreme</span>
<span class="sd">        accuracy. Please review the in-line comments in this method if you want more control.</span>

<span class="sd">        Args:</span>
<span class="sd">            hybrid_functional (str): Type of hybrid functional. This set supports HSE (screened) and PBE0</span>
<span class="sd">                (truncated). Default is PBE0, which converges easier in the GPW basis used by</span>
<span class="sd">                cp2k.</span>
<span class="sd">            hf_fraction (float): fraction of exact HF exchange energy to mix. Default: 0.25</span>
<span class="sd">            gga_x_fraction (float): fraction of gga exchange energy to retain. Default: 0.75</span>
<span class="sd">            gga_c_fraction (float): fraction of gga correlation energy to retain. Default: 1.0</span>
<span class="sd">            max_memory (int): Maximum memory available to each MPI process (in Mb) in the calculation.</span>
<span class="sd">                Most modern computing nodes will have ~2Gb per core, or 2048 Mb, but check for</span>
<span class="sd">                your specific system. This value should be as large as possible while still leaving</span>
<span class="sd">                some memory for the other parts of cp2k. Important: If this value is set larger</span>
<span class="sd">                than the memory limits, CP2K will likely seg-fault.</span>
<span class="sd">                Default: 2000</span>
<span class="sd">            cutoff_radius (float): for truncated hybrid functional (i.e. PBE0), this is the cutoff</span>
<span class="sd">                radius. The default is selected as that which generally gives convergence, but</span>
<span class="sd">                maybe too low (if you want very high accuracy) or too high (if you want a quick</span>
<span class="sd">                screening). Default: 8 angstroms</span>
<span class="sd">            potential_type (str): what interaction potential to use for HFX. Available in CP2K are</span>
<span class="sd">                COULOMB, GAUSSIAN, IDENTITY, LOGRANGE, MIX_CL, MIX_CL_TRUNC, MIX_LG, SHORTRANGE,</span>
<span class="sd">                and TRUNCATED. Default is None, and it will be set automatically depending on the</span>
<span class="sd">                named hybrid_functional that you use, but setting it to one of the acceptable</span>
<span class="sd">                values will constitute a user-override.</span>
<span class="sd">            omega (float): For HSE, this specifies the screening parameter. HSE06 sets this as</span>
<span class="sd">                0.2, which is the default.</span>
<span class="sd">            aux_basis (dict): If you want to specify the aux basis to use, specify it as a dict of</span>
<span class="sd">                the form {&#39;specie_1&#39;: &#39;AUX_BASIS_1&#39;, &#39;specie_2&#39;: &#39;AUX_BASIS_2&#39;}</span>
<span class="sd">            admm (bool): Whether or not to use the auxiliary density matrix method for the exact</span>
<span class="sd">                HF exchange contribution. Highly recommended. Speed ups between 10x and aaa1000x are</span>
<span class="sd">                possible when compared to non ADMM hybrid calculations. Default: True</span>
<span class="sd">            eps_schwarz (float): Screening threshold for HFX, in Ha. Contributions smaller than this</span>
<span class="sd">                will be screened. The smaller the value, the more accurate, but also the more</span>
<span class="sd">                costly. Default value is 1e-6, which is quite aggressive. Aggressive screening</span>
<span class="sd">                can also lead to convergence issues. 1e-7 should be a safe value if 1e-6 is too</span>
<span class="sd">                aggressive.</span>
<span class="sd">            eps_schwarz_forces (float): Same as for eps_schwarz, but for screening contributions to</span>
<span class="sd">                forces. Convergence is not as sensitive with respect to eps_schwarz forces as</span>
<span class="sd">                compared to eps_schwarz, and so 1e-6 should be good default.</span>
<span class="sd">            screen_on_initial_p (bool): If an initial density matrix is provided, in the form of a</span>
<span class="sd">                CP2K wfn restart file, then this initial density will be used for screening. This</span>
<span class="sd">                is generally very computationally efficient, but, as with eps_schwarz, can lead to</span>
<span class="sd">                instabilities if the initial density matrix is poor.</span>
<span class="sd">            screen_p_forces (bool): Same as screen_on_initial_p, but for screening of forces.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">admm</span><span class="p">:</span>
            <span class="n">aux_basis</span> <span class="o">=</span> <span class="n">aux_basis</span> <span class="k">if</span> <span class="n">aux_basis</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="n">aux_basis</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">aux_basis</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">aux_basis</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">symbol_set</span><span class="p">}</span>
            <span class="n">basis</span> <span class="o">=</span> <span class="n">get_aux_basis</span><span class="p">(</span><span class="n">basis_type</span><span class="o">=</span><span class="n">aux_basis</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">][</span><span class="s2">&quot;BASIS_SET_FILE_NAME&quot;</span><span class="p">],</span> <span class="n">KeywordList</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">][</span><span class="s2">&quot;BASIS_SET_FILE_NAME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;BASIS_SET_FILE_NAME&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;BASIS_ADMM&quot;</span><span class="p">,</span> <span class="s2">&quot;BASIS_ADMM_MOLOPT&quot;</span><span class="p">]],</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;SUBSYS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">subsections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;KIND&quot;</span><span class="p">:</span>
                    <span class="n">kind</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;ELEMENT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s2">&quot;BASIS_SET&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;BASIS_SET&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_FIT&quot;</span><span class="p">,</span> <span class="n">basis</span><span class="p">[</span><span class="n">kind</span><span class="p">])</span>

            <span class="c1"># Don&#39;t change unless you know what you&#39;re doing</span>
            <span class="c1"># Use NONE for accurate eigenvalues (static calcs)</span>
            <span class="n">aux_matrix_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;ADMM_PURIFICATION_METHOD&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;ADMM_PURIFICATION_METHOD&quot;</span><span class="p">,</span> <span class="s2">&quot;NONE&quot;</span><span class="p">),</span>
                <span class="s2">&quot;METHOD&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;METHOD&quot;</span><span class="p">,</span> <span class="s2">&quot;BASIS_PROJECTION&quot;</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">aux_matrix</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span>
                <span class="s2">&quot;AUXILIARY_DENSITY_MATRIX_METHOD&quot;</span><span class="p">,</span>
                <span class="n">keywords</span><span class="o">=</span><span class="n">aux_matrix_params</span><span class="p">,</span>
                <span class="n">subsections</span><span class="o">=</span><span class="p">{},</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subsections</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">aux_matrix</span><span class="p">)</span>

        <span class="c1"># Define the GGA functional as PBE</span>
        <span class="n">pbe</span> <span class="o">=</span> <span class="n">PBE</span><span class="p">(</span><span class="s2">&quot;ORIG&quot;</span><span class="p">,</span> <span class="n">scale_c</span><span class="o">=</span><span class="n">gga_c_fraction</span><span class="p">,</span> <span class="n">scale_x</span><span class="o">=</span><span class="n">gga_x_fraction</span><span class="p">)</span>
        <span class="n">xc_functional</span> <span class="o">=</span> <span class="n">XC_FUNCTIONAL</span><span class="p">(</span><span class="s2">&quot;PBE&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;PBE&quot;</span><span class="p">:</span> <span class="n">pbe</span><span class="p">})</span>

        <span class="n">screening</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span>
            <span class="s2">&quot;SCREENING&quot;</span><span class="p">,</span>
            <span class="n">subsections</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">keywords</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;EPS_SCHWARZ&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;EPS_SCHWARZ&quot;</span><span class="p">,</span> <span class="n">eps_schwarz</span><span class="p">),</span>
                <span class="s2">&quot;EPS_SCHWARZ_FORCES&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;EPS_SCHWARZ_FORCES&quot;</span><span class="p">,</span> <span class="n">eps_schwarz_forces</span><span class="p">),</span>
                <span class="s2">&quot;SCREEN_ON_INITIAL_P&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;SCREEN_ON_INITIAL_P&quot;</span><span class="p">,</span> <span class="n">screen_on_initial_p</span><span class="p">),</span>
                <span class="s2">&quot;SCREEN_P_FORCES&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;SCREEN_P_FORCES&quot;</span><span class="p">,</span> <span class="n">screen_p_forces</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>

        <span class="n">ip_keywords</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">hybrid_functional</span> <span class="o">==</span> <span class="s2">&quot;HSE06&quot;</span><span class="p">:</span>
            <span class="n">potential_type</span> <span class="o">=</span> <span class="n">potential_type</span> <span class="k">if</span> <span class="n">potential_type</span> <span class="k">else</span> <span class="s2">&quot;SHORTRANGE&quot;</span>
            <span class="n">xc_functional</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">Section</span><span class="p">(</span>
                    <span class="s2">&quot;XWPBE&quot;</span><span class="p">,</span>
                    <span class="n">subsections</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">keywords</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;SCALE_X0&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;SCALE_X0&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="s2">&quot;SCALE_X&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;SCALE_X&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">hf_fraction</span><span class="p">),</span>
                        <span class="s2">&quot;OMEGA&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;OMEGA&quot;</span><span class="p">,</span> <span class="n">omega</span><span class="p">),</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">ip_keywords</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;POTENTIAL_TYPE&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;POTENTIAL_TYPE&quot;</span><span class="p">,</span> <span class="n">potential_type</span><span class="p">),</span>
                    <span class="s2">&quot;OMEGA&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;OMEGA&quot;</span><span class="p">,</span> <span class="n">omega</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">hybrid_functional</span> <span class="o">==</span> <span class="s2">&quot;PBE0&quot;</span><span class="p">:</span>
            <span class="n">potential_type</span> <span class="o">=</span> <span class="n">potential_type</span> <span class="k">if</span> <span class="n">potential_type</span> <span class="k">else</span> <span class="s2">&quot;TRUNCATED&quot;</span>
            <span class="n">ip_keywords</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;POTENTIAL_TYPE&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;POTENTIAL_TYPE&quot;</span><span class="p">,</span> <span class="n">potential_type</span><span class="p">),</span>
                    <span class="s2">&quot;CUTOFF_RADIUS&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;CUTOFF_RADIUS&quot;</span><span class="p">,</span> <span class="n">cutoff_radius</span><span class="p">),</span>
                    <span class="s2">&quot;T_C_G_DATA&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;T_C_G_DATA&quot;</span><span class="p">,</span> <span class="s2">&quot;t_c_g.dat&quot;</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="n">interaction_potential</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="s2">&quot;INTERACTION_POTENTIAL&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{},</span> <span class="n">keywords</span><span class="o">=</span><span class="n">ip_keywords</span><span class="p">)</span>

        <span class="c1"># Unlikely for users to override</span>
        <span class="n">load_balance</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span>
            <span class="s2">&quot;LOAD_BALANCE&quot;</span><span class="p">,</span>
            <span class="n">keywords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;RANDOMIZE&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;RANDOMIZE&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)},</span>
            <span class="n">subsections</span><span class="o">=</span><span class="p">{},</span>
        <span class="p">)</span>

        <span class="c1"># EPS_STORAGE_SCALING squashes the integrals for efficient storage</span>
        <span class="c1"># Unlikely for users to override.</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span>
            <span class="s2">&quot;MEMORY&quot;</span><span class="p">,</span>
            <span class="n">subsections</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">keywords</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;EPS_STORAGE_SCALING&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;EPS_STORAGE_SCALING&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
                <span class="s2">&quot;MAX_MEMORY&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;MAX_MEMORY&quot;</span><span class="p">,</span> <span class="n">max_memory</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="n">hf</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span>
            <span class="s2">&quot;HF&quot;</span><span class="p">,</span>
            <span class="n">keywords</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;FRACTION&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;FRACTION&quot;</span><span class="p">,</span> <span class="n">hf_fraction</span><span class="p">)},</span>
            <span class="n">subsections</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;SCREENING&quot;</span><span class="p">:</span> <span class="n">screening</span><span class="p">,</span>
                <span class="s2">&quot;INTERACTION_POTENTIAL&quot;</span><span class="p">:</span> <span class="n">interaction_potential</span><span class="p">,</span>
                <span class="s2">&quot;LOAD_BALANCE&quot;</span><span class="p">:</span> <span class="n">load_balance</span><span class="p">,</span>
                <span class="s2">&quot;MEMORY&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="s2">&quot;XC&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;XC_FUNCTIONAL&quot;</span><span class="p">:</span> <span class="n">xc_functional</span><span class="p">,</span> <span class="s2">&quot;HF&quot;</span><span class="p">:</span> <span class="n">hf</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">subsections</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">xc</span><span class="p">)</span></div>

<div class="viewcode-block" id="DftSet.activate_fast_minimization"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.activate_fast_minimization">[docs]</a>    <span class="k">def</span> <span class="nf">activate_fast_minimization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to modify the set to use fast SCF minimization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">on</span><span class="p">:</span>
            <span class="n">ot</span> <span class="o">=</span> <span class="n">OrbitalTransformation</span><span class="p">(</span>
                <span class="n">minimizer</span><span class="o">=</span><span class="s2">&quot;DIIS&quot;</span><span class="p">,</span>
                <span class="n">preconditioner</span><span class="o">=</span><span class="s2">&quot;FULL_ALL&quot;</span><span class="p">,</span>
                <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;IRAC&quot;</span><span class="p">,</span>
                <span class="n">energy_gap</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                <span class="n">linesearch</span><span class="o">=</span><span class="s2">&quot;2PNT&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;DFT&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;SCF&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;OT&quot;</span><span class="p">:</span> <span class="n">ot</span><span class="p">}}}})</span></div>

<div class="viewcode-block" id="DftSet.activate_robust_minimization"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.activate_robust_minimization">[docs]</a>    <span class="k">def</span> <span class="nf">activate_robust_minimization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to modify the set to use more robust SCF minimization technique</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ot</span> <span class="o">=</span> <span class="n">OrbitalTransformation</span><span class="p">(</span>
            <span class="n">minimizer</span><span class="o">=</span><span class="s2">&quot;CG&quot;</span><span class="p">,</span>
            <span class="n">preconditioner</span><span class="o">=</span><span class="s2">&quot;FULL_ALL&quot;</span><span class="p">,</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;STRICT&quot;</span><span class="p">,</span>
            <span class="n">energy_gap</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">linesearch</span><span class="o">=</span><span class="s2">&quot;3PNT&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;DFT&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;SCF&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;OT&quot;</span><span class="p">:</span> <span class="n">ot</span><span class="p">}}}})</span></div>

<div class="viewcode-block" id="DftSet.activate_very_strict_minimization"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.activate_very_strict_minimization">[docs]</a>    <span class="k">def</span> <span class="nf">activate_very_strict_minimization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to modify the set to use very strict SCF minimization scheme</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ot</span> <span class="o">=</span> <span class="n">OrbitalTransformation</span><span class="p">(</span>
            <span class="n">minimizer</span><span class="o">=</span><span class="s2">&quot;CG&quot;</span><span class="p">,</span>
            <span class="n">preconditioner</span><span class="o">=</span><span class="s2">&quot;FULL_ALL&quot;</span><span class="p">,</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;STRICT&quot;</span><span class="p">,</span>
            <span class="n">energy_gap</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">linesearch</span><span class="o">=</span><span class="s2">&quot;GOLD&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;DFT&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;SCF&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;OT&quot;</span><span class="p">:</span> <span class="n">ot</span><span class="p">}}}})</span></div>

<div class="viewcode-block" id="DftSet.activate_nonperiodic"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.activate_nonperiodic">[docs]</a>    <span class="k">def</span> <span class="nf">activate_nonperiodic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activates a calculation with non-periodic calculations by turning of PBC and</span>
<span class="sd">        changing the poisson solver. Still requires a CELL to put the atoms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;POISSON_SOLVER&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;POISSON_SOLVER&quot;</span><span class="p">,</span> <span class="s2">&quot;MT&quot;</span><span class="p">),</span>
            <span class="s2">&quot;PERIODIC&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;PERIODIC&quot;</span><span class="p">,</span> <span class="s2">&quot;NONE&quot;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;DFT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;POISSON&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{},</span> <span class="n">keywords</span><span class="o">=</span><span class="n">kwds</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s2">&quot;FORCE_EVAL/SUBSYS/CELL&quot;</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
            <span class="n">z</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;SUBSYS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Cell</span><span class="p">(</span><span class="n">lattice</span><span class="o">=</span><span class="n">Lattice</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">]])))</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;FORCE_EVAL&quot;</span><span class="p">][</span><span class="s2">&quot;SUBSYS&quot;</span><span class="p">][</span><span class="s2">&quot;CELL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;PERIODIC&quot;</span><span class="p">,</span> <span class="s2">&quot;NONE&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="DftSet.modify_dft_print_iters"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.DftSet.modify_dft_print_iters">[docs]</a>    <span class="k">def</span> <span class="nf">modify_dft_print_iters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iters</span><span class="p">,</span> <span class="n">add_last</span><span class="o">=</span><span class="s2">&quot;no&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify all DFT print iterations at once. Common use is to set iters to the max</span>
<span class="sd">        number of iterations + 1 and then set add_last to numeric. This would have the</span>
<span class="sd">        effect of printing only the first and last iteration, which might be useful for</span>
<span class="sd">        speeding up/saving space on GEO_OPT or MD runs where you don&#39;t need the intermediate</span>
<span class="sd">        values.</span>

<span class="sd">        Args</span>
<span class="sd">            iters (int): print each &quot;iters&quot; iterations.</span>
<span class="sd">            add_last (str): Whether to explicitly include the last iteration, and how to mark it.</span>
<span class="sd">                numeric: mark last iteration with the iteration number</span>
<span class="sd">                symbolic: mark last iteration with the letter &quot;l&quot;</span>
<span class="sd">                no: do not explicitly include the last iteration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">add_last</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;numeric&quot;</span><span class="p">,</span> <span class="s2">&quot;symbolic&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s2">&quot;FORCE_EVAL/DFT/PRINT&quot;</span><span class="p">):</span>
            <span class="n">run_type</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;global&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;run_type&quot;</span><span class="p">,</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;run_type&quot;</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;force_eval&quot;</span><span class="p">][</span><span class="s2">&quot;dft&quot;</span><span class="p">][</span><span class="s2">&quot;print&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">subsections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s2">&quot;ACTIVE_SPACE&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;BAND_STRUCTURE&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GAPW&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;IMPLICIT_PSOLVER&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;SCCS&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;WFN_MIX&quot;</span><span class="p">,</span>
                <span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="n">v</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="n">Section</span><span class="p">(</span>
                        <span class="s2">&quot;EACH&quot;</span><span class="p">,</span>
                        <span class="n">subsections</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">keywords</span><span class="o">=</span><span class="p">{</span><span class="n">run_type</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="n">run_type</span><span class="p">,</span> <span class="n">iters</span><span class="p">)},</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">v</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s2">&quot;ADD_LAST&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;ADD_LAST&quot;</span><span class="p">,</span> <span class="n">add_last</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="StaticSet"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.StaticSet">[docs]</a><span class="k">class</span> <span class="nc">StaticSet</span><span class="p">(</span><span class="n">DftSet</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic static energy calculation. Turns on Quickstep module, sets the run_type in global,</span>
<span class="sd">    and uses structure object to build the subsystem.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">],</span>
        <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Static&quot;</span><span class="p">,</span>
        <span class="n">run_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ENERGY_FORCE&quot;</span><span class="p">,</span>
        <span class="n">override_default_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure: Pymatgen structure object</span>
<span class="sd">            project_name (str): What to name this cp2k project (controls naming of files printed out)</span>
<span class="sd">            run_type (str): Run type. As a static set it should be one of the static aliases, like &#39;ENERGY_FORCE&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">global_section</span> <span class="o">=</span> <span class="n">Global</span><span class="p">(</span><span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span> <span class="n">run_type</span><span class="o">=</span><span class="n">run_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_type</span> <span class="o">=</span> <span class="n">run_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">override_default_params</span> <span class="o">=</span> <span class="n">override_default_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">global_section</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">override_default_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span></div>


<div class="viewcode-block" id="RelaxSet"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.RelaxSet">[docs]</a><span class="k">class</span> <span class="nc">RelaxSet</span><span class="p">(</span><span class="n">DftSet</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CP2K input set containing the basic settings for performing geometry optimization. Values are all cp2k</span>
<span class="sd">    defaults, and should be good for most systems of interest.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">],</span>
        <span class="n">max_drift</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3e-3</span><span class="p">,</span>
        <span class="n">max_force</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">4.5e-3</span><span class="p">,</span>
        <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Relax&quot;</span><span class="p">,</span>
        <span class="n">optimizer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BFGS&quot;</span><span class="p">,</span>
        <span class="n">override_default_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure:</span>
<span class="sd">            max_drift: Convergence criterion for the maximum geometry change between the current and the</span>
<span class="sd">                last optimizer iteration. This keyword cannot be repeated and it expects precisely one real.</span>
<span class="sd">                Default value: 3.00000000E-003</span>
<span class="sd">                Default unit: [bohr]</span>
<span class="sd">            max_force (float): Convergence criterion for the maximum force component of the current configuration.</span>
<span class="sd">                This keyword cannot be repeated and it expects precisely one real.</span>
<span class="sd">                Default value: 4.50000000E-004</span>
<span class="sd">                Default unit: [bohr^-1*hartree]</span>
<span class="sd">            max_iter (int): Specifies the maximum number of geometry optimization steps.</span>
<span class="sd">                One step might imply several force evaluations for the CG and LBFGS optimizers.</span>
<span class="sd">                This keyword cannot be repeated and it expects precisely one integer.</span>
<span class="sd">                Default value: 200</span>
<span class="sd">            optimizer (str): Specify which method to use to perform a geometry optimization.</span>
<span class="sd">                This keyword cannot be repeated and it expects precisely one keyword. BFGS is a</span>
<span class="sd">                quasi-newtonian method, and will best for &quot;small&quot; systems near the minimum. LBFGS</span>
<span class="sd">                is a limited memory version that can be used for &quot;large&quot; (&gt;1000 atom) systems when</span>
<span class="sd">                efficiency outweights robustness. CG is more robust, especially when you are far from</span>
<span class="sd">                the minimum, but it slower.</span>
<span class="sd">                Default value: BFGS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_drift</span> <span class="o">=</span> <span class="n">max_drift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_force</span> <span class="o">=</span> <span class="n">max_force</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="n">max_iter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">override_default_params</span> <span class="o">=</span> <span class="n">override_default_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="n">global_section</span> <span class="o">=</span> <span class="n">Global</span><span class="p">(</span><span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span> <span class="n">run_type</span><span class="o">=</span><span class="s2">&quot;GEO_OPT&quot;</span><span class="p">)</span>

        <span class="n">geo_opt_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;TYPE&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;TYPE&quot;</span><span class="p">,</span> <span class="s2">&quot;MINIMIZATION&quot;</span><span class="p">),</span>
            <span class="s2">&quot;MAX_DR&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;MAX_DR&quot;</span><span class="p">,</span> <span class="n">max_drift</span><span class="p">),</span>
            <span class="s2">&quot;MAX_FORCE&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;MAX_FORCE&quot;</span><span class="p">,</span> <span class="n">max_force</span><span class="p">),</span>
            <span class="s2">&quot;RMS_DR&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;RMS_DR&quot;</span><span class="p">,</span> <span class="mf">1.5e-3</span><span class="p">),</span>
            <span class="s2">&quot;MAX_ITER&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;MAX_ITER&quot;</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">),</span>
            <span class="s2">&quot;OPTIMIZER&quot;</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="s2">&quot;OPTIMIZER&quot;</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">geo_opt</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="s2">&quot;GEO_OPT&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{},</span> <span class="n">keywords</span><span class="o">=</span><span class="n">geo_opt_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s2">&quot;MOTION&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;MOTION&quot;</span><span class="p">,</span> <span class="n">subsections</span><span class="o">=</span><span class="p">{}))</span>
        <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;MOTION&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">geo_opt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">global_section</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modify_dft_print_iters</span><span class="p">(</span><span class="n">max_iter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">add_last</span><span class="o">=</span><span class="s2">&quot;numeric&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">override_default_params</span><span class="p">)</span></div>


<div class="viewcode-block" id="CellOptSet"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.CellOptSet">[docs]</a><span class="k">class</span> <span class="nc">CellOptSet</span><span class="p">(</span><span class="n">DftSet</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CP2K input set containing the basic settings for performing geometry optimization. Values are all cp2k</span>
<span class="sd">    defaults, and should be good for most systems of interest.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">],</span>
        <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;CellOpt&quot;</span><span class="p">,</span>
        <span class="n">override_default_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure: Pymatgen structure object</span>
<span class="sd">            max_drift: Convergence criterion for the maximum geometry change between the current and the</span>
<span class="sd">                last optimizer iteration. This keyword cannot be repeated and it expects precisely one real.</span>
<span class="sd">                Default value: 3.00000000E-003</span>
<span class="sd">                Default unit: [bohr]</span>
<span class="sd">            max_force (float): Convergence criterion for the maximum force component of the current configuration.</span>
<span class="sd">                This keyword cannot be repeated and it expects precisely one real.</span>
<span class="sd">                Default value: 4.50000000E-004</span>
<span class="sd">                Default unit: [bohr^-1*hartree]</span>
<span class="sd">            max_iter (int): Specifies the maximum number of geometry optimization steps.</span>
<span class="sd">                One step might imply several force evaluations for the CG and LBFGS optimizers.</span>
<span class="sd">                This keyword cannot be repeated and it expects precisely one integer.</span>
<span class="sd">                Default value: 200</span>
<span class="sd">            optimizer (str): Specify which method to use to perform a geometry optimization.</span>
<span class="sd">                This keyword cannot be repeated and it expects precisely one keyword. BFGS is a</span>
<span class="sd">                quasi-newtonian method, and will best for &quot;small&quot; systems near the minimum. LBFGS</span>
<span class="sd">                is a limited memory version that can be used for &quot;large&quot; (&gt;1000 atom) systems when</span>
<span class="sd">                efficiency outweights robustness. CG is more robust, especially when you are far from</span>
<span class="sd">                the minimum, but it slower.</span>
<span class="sd">                Default value: BFGS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">override_default_params</span> <span class="o">=</span> <span class="n">override_default_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="n">global_section</span> <span class="o">=</span> <span class="n">Global</span><span class="p">(</span><span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span> <span class="n">run_type</span><span class="o">=</span><span class="s2">&quot;CELL_OPT&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">global_section</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modify_dft_print_iters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_iter&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">add_last</span><span class="o">=</span><span class="s2">&quot;numeric&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">override_default_params</span><span class="p">)</span></div>


<div class="viewcode-block" id="HybridStaticSet"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.HybridStaticSet">[docs]</a><span class="k">class</span> <span class="nc">HybridStaticSet</span><span class="p">(</span><span class="n">StaticSet</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Static calculation using hybrid DFT with the ADMM formalism in Cp2k.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">],</span>
        <span class="n">hybrid_functional</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PBE0&quot;</span><span class="p">,</span>
        <span class="n">hf_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Hybrid-Static&quot;</span><span class="p">,</span>
        <span class="n">gga_x_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">gga_c_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">override_default_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">max_memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="n">cutoff_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
        <span class="n">omega</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="n">aux_basis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">admm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">eps_schwarz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
        <span class="n">eps_schwarz_forces</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
        <span class="n">screen_on_initial_p</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">screen_p_forces</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure: pymatgen structure object</span>
<span class="sd">            method: hybrid dft method to use (currently select between HSE06 and PBE0)</span>
<span class="sd">            hf_fraction: percentage of exact HF to mix-in</span>
<span class="sd">            project_name: what to call this project</span>
<span class="sd">            gga_x_fraction: percentage of gga exchange to use</span>
<span class="sd">            gga_c_fraction: percentage of gga correlation to use</span>
<span class="sd">            override_default_params: override settings (see above).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hybrid_functional</span> <span class="o">=</span> <span class="n">hybrid_functional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hf_fraction</span> <span class="o">=</span> <span class="n">hf_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gga_x_fraction</span> <span class="o">=</span> <span class="n">gga_x_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gga_c_fraction</span> <span class="o">=</span> <span class="n">gga_c_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">override_default_params</span> <span class="o">=</span> <span class="n">override_default_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">max_memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_radius</span> <span class="o">=</span> <span class="n">cutoff_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_basis</span> <span class="o">=</span> <span class="n">aux_basis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">admm</span> <span class="o">=</span> <span class="n">admm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps_schwarz</span> <span class="o">=</span> <span class="n">eps_schwarz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps_schwarz_forces</span> <span class="o">=</span> <span class="n">eps_schwarz_forces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_on_initial_p</span> <span class="o">=</span> <span class="n">screen_on_initial_p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_p_forces</span> <span class="o">=</span> <span class="n">screen_p_forces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">activate_hybrid</span><span class="p">(</span>
            <span class="n">hybrid_functional</span><span class="o">=</span><span class="n">hybrid_functional</span><span class="p">,</span>
            <span class="n">hf_fraction</span><span class="o">=</span><span class="n">hf_fraction</span><span class="p">,</span>
            <span class="n">gga_x_fraction</span><span class="o">=</span><span class="n">gga_x_fraction</span><span class="p">,</span>
            <span class="n">gga_c_fraction</span><span class="o">=</span><span class="n">gga_c_fraction</span><span class="p">,</span>
            <span class="n">max_memory</span><span class="o">=</span><span class="n">max_memory</span><span class="p">,</span>
            <span class="n">cutoff_radius</span><span class="o">=</span><span class="n">cutoff_radius</span><span class="p">,</span>
            <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span>
            <span class="n">aux_basis</span><span class="o">=</span><span class="n">aux_basis</span><span class="p">,</span>
            <span class="n">admm</span><span class="o">=</span><span class="n">admm</span><span class="p">,</span>
            <span class="n">eps_schwarz</span><span class="o">=</span><span class="n">eps_schwarz</span><span class="p">,</span>
            <span class="n">eps_schwarz_forces</span><span class="o">=</span><span class="n">eps_schwarz_forces</span><span class="p">,</span>
            <span class="n">screen_on_initial_p</span><span class="o">=</span><span class="n">screen_on_initial_p</span><span class="p">,</span>
            <span class="n">screen_p_forces</span><span class="o">=</span><span class="n">screen_p_forces</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">override_default_params</span><span class="p">)</span></div>


<div class="viewcode-block" id="HybridRelaxSet"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.HybridRelaxSet">[docs]</a><span class="k">class</span> <span class="nc">HybridRelaxSet</span><span class="p">(</span><span class="n">RelaxSet</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Static calculation using hybrid DFT with the ADMM formalism in Cp2k.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">],</span>
        <span class="n">hybrid_functional</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PBE0&quot;</span><span class="p">,</span>
        <span class="n">hf_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Hybrid-Relax&quot;</span><span class="p">,</span>
        <span class="n">gga_x_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">gga_c_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">override_default_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">max_memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="n">cutoff_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
        <span class="n">omega</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="n">aux_basis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">admm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">eps_schwarz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
        <span class="n">eps_schwarz_forces</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
        <span class="n">screen_on_initial_p</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">screen_p_forces</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure: pymatgen structure object</span>
<span class="sd">            method: hybrid dft method to use (currently select between HSE06 and PBE0)</span>
<span class="sd">            hf_fraction: percentage of exact HF to mix-in</span>
<span class="sd">            project_name: what to call this project</span>
<span class="sd">            gga_x_fraction: percentage of gga exchange to use</span>
<span class="sd">            gga_c_fraction: percentage of gga correlation to use</span>
<span class="sd">            override_default_params: override settings (see above).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hybrid_functional</span> <span class="o">=</span> <span class="n">hybrid_functional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hf_fraction</span> <span class="o">=</span> <span class="n">hf_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gga_x_fraction</span> <span class="o">=</span> <span class="n">gga_x_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gga_c_fraction</span> <span class="o">=</span> <span class="n">gga_c_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">override_default_params</span> <span class="o">=</span> <span class="n">override_default_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">max_memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_radius</span> <span class="o">=</span> <span class="n">cutoff_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_basis</span> <span class="o">=</span> <span class="n">aux_basis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">admm</span> <span class="o">=</span> <span class="n">admm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps_schwarz</span> <span class="o">=</span> <span class="n">eps_schwarz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps_schwarz_forces</span> <span class="o">=</span> <span class="n">eps_schwarz_forces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_on_initial_p</span> <span class="o">=</span> <span class="n">screen_on_initial_p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_p_forces</span> <span class="o">=</span> <span class="n">screen_p_forces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">activate_hybrid</span><span class="p">(</span>
            <span class="n">hybrid_functional</span><span class="o">=</span><span class="n">hybrid_functional</span><span class="p">,</span>
            <span class="n">hf_fraction</span><span class="o">=</span><span class="n">hf_fraction</span><span class="p">,</span>
            <span class="n">gga_x_fraction</span><span class="o">=</span><span class="n">gga_x_fraction</span><span class="p">,</span>
            <span class="n">gga_c_fraction</span><span class="o">=</span><span class="n">gga_c_fraction</span><span class="p">,</span>
            <span class="n">max_memory</span><span class="o">=</span><span class="n">max_memory</span><span class="p">,</span>
            <span class="n">cutoff_radius</span><span class="o">=</span><span class="n">cutoff_radius</span><span class="p">,</span>
            <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span>
            <span class="n">aux_basis</span><span class="o">=</span><span class="n">aux_basis</span><span class="p">,</span>
            <span class="n">admm</span><span class="o">=</span><span class="n">admm</span><span class="p">,</span>
            <span class="n">eps_schwarz</span><span class="o">=</span><span class="n">eps_schwarz</span><span class="p">,</span>
            <span class="n">eps_schwarz_forces</span><span class="o">=</span><span class="n">eps_schwarz_forces</span><span class="p">,</span>
            <span class="n">screen_on_initial_p</span><span class="o">=</span><span class="n">screen_on_initial_p</span><span class="p">,</span>
            <span class="n">screen_p_forces</span><span class="o">=</span><span class="n">screen_p_forces</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">override_default_params</span><span class="p">)</span></div>


<div class="viewcode-block" id="HybridCellOptSet"><a class="viewcode-back" href="../../../../pymatgen.io.cp2k.sets.html#pymatgen.io.cp2k.sets.HybridCellOptSet">[docs]</a><span class="k">class</span> <span class="nc">HybridCellOptSet</span><span class="p">(</span><span class="n">CellOptSet</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Static calculation using hybrid DFT with the ADMM formalism in Cp2k.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">],</span>
        <span class="n">hybrid_functional</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PBE0&quot;</span><span class="p">,</span>
        <span class="n">hf_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Hybrid-CellOpt&quot;</span><span class="p">,</span>
        <span class="n">gga_x_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">gga_c_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">override_default_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">max_memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="n">cutoff_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span>
        <span class="n">omega</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="n">aux_basis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">admm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">eps_schwarz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
        <span class="n">eps_schwarz_forces</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
        <span class="n">screen_on_initial_p</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">screen_p_forces</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure: pymatgen structure object</span>
<span class="sd">            method: hybrid dft method to use (currently select between HSE06 and PBE0)</span>
<span class="sd">            hf_fraction: percentage of exact HF to mix-in</span>
<span class="sd">            project_name: what to call this project</span>
<span class="sd">            gga_x_fraction: percentage of gga exchange to use</span>
<span class="sd">            gga_c_fraction: percentage of gga correlation to use</span>
<span class="sd">            override_default_params: override settings (see above).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hybrid_functional</span> <span class="o">=</span> <span class="n">hybrid_functional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hf_fraction</span> <span class="o">=</span> <span class="n">hf_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gga_x_fraction</span> <span class="o">=</span> <span class="n">gga_x_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gga_c_fraction</span> <span class="o">=</span> <span class="n">gga_c_fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">override_default_params</span> <span class="o">=</span> <span class="n">override_default_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">max_memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff_radius</span> <span class="o">=</span> <span class="n">cutoff_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_basis</span> <span class="o">=</span> <span class="n">aux_basis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">admm</span> <span class="o">=</span> <span class="n">admm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps_schwarz</span> <span class="o">=</span> <span class="n">eps_schwarz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps_schwarz_forces</span> <span class="o">=</span> <span class="n">eps_schwarz_forces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_on_initial_p</span> <span class="o">=</span> <span class="n">screen_on_initial_p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_p_forces</span> <span class="o">=</span> <span class="n">screen_p_forces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">activate_hybrid</span><span class="p">(</span>
            <span class="n">hybrid_functional</span><span class="o">=</span><span class="n">hybrid_functional</span><span class="p">,</span>
            <span class="n">hf_fraction</span><span class="o">=</span><span class="n">hf_fraction</span><span class="p">,</span>
            <span class="n">gga_x_fraction</span><span class="o">=</span><span class="n">gga_x_fraction</span><span class="p">,</span>
            <span class="n">gga_c_fraction</span><span class="o">=</span><span class="n">gga_c_fraction</span><span class="p">,</span>
            <span class="n">max_memory</span><span class="o">=</span><span class="n">max_memory</span><span class="p">,</span>
            <span class="n">cutoff_radius</span><span class="o">=</span><span class="n">cutoff_radius</span><span class="p">,</span>
            <span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span>
            <span class="n">aux_basis</span><span class="o">=</span><span class="n">aux_basis</span><span class="p">,</span>
            <span class="n">admm</span><span class="o">=</span><span class="n">admm</span><span class="p">,</span>
            <span class="n">eps_schwarz</span><span class="o">=</span><span class="n">eps_schwarz</span><span class="p">,</span>
            <span class="n">eps_schwarz_forces</span><span class="o">=</span><span class="n">eps_schwarz_forces</span><span class="p">,</span>
            <span class="n">screen_on_initial_p</span><span class="o">=</span><span class="n">screen_on_initial_p</span><span class="p">,</span>
            <span class="n">screen_p_forces</span><span class="o">=</span><span class="n">screen_p_forces</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">override_default_params</span><span class="p">)</span></div>
</pre></div>

          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 2021.2.8.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>