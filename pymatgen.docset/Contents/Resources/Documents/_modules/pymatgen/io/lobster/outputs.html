<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymatgen.io.lobster.outputs &#8212; pymatgen 2025.1.24 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/basic.css?v=5c69cfe2" />
    <script src="../../../../_static/documentation_options.js?v=d2bc030c"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.io.lobster.outputs</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.io.lobster.outputs</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module for reading Lobster output files.</span>
<span class="sd">For more information on LOBSTER see www.cohp.de.</span>

<span class="sd">If you use this module, please cite:</span>
<span class="sd">J. George, G. Petretto, A. Naik, M. Esters, A. J. Jackson, R. Nelson, R. Dronskowski, G.-M. Rignanese, G. Hautier,</span>
<span class="sd">&quot;Automated Bonding Analysis with Crystal Orbital Hamilton Populations&quot;,</span>
<span class="sd">ChemPlusChem 2022, e202200123,</span>
<span class="sd">DOI: 10.1002/cplu.202200123.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">fnmatch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.dev</span><span class="w"> </span><span class="kn">import</span> <span class="n">deprecated</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">zopen</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.json</span><span class="w"> </span><span class="kn">import</span> <span class="n">MSONable</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.structure</span><span class="w"> </span><span class="kn">import</span> <span class="n">Structure</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.electronic_structure.bandstructure</span><span class="w"> </span><span class="kn">import</span> <span class="n">LobsterBandStructureSymmLine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.electronic_structure.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">Orbital</span><span class="p">,</span> <span class="n">Spin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.electronic_structure.dos</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dos</span><span class="p">,</span> <span class="n">LobsterCompleteDos</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.vasp.inputs</span><span class="w"> </span><span class="kn">import</span> <span class="n">Kpoints</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.vasp.outputs</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vasprun</span><span class="p">,</span> <span class="n">VolumetricData</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.due</span><span class="w"> </span><span class="kn">import</span> <span class="n">Doi</span><span class="p">,</span> <span class="n">due</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">PathLike</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Literal</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NDArray</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.structure</span><span class="w"> </span><span class="kn">import</span> <span class="n">IStructure</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.electronic_structure.cohp</span><span class="w"> </span><span class="kn">import</span> <span class="n">IcohpCollection</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple3Ints</span><span class="p">,</span> <span class="n">Vector3D</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Janine George, Marco Esters&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2017, The Materials Project&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.2&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Janine George &quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;janinegeorge.ulfen@gmail.com&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;Dec 13, 2017&quot;</span>


<span class="n">due</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span>
    <span class="n">Doi</span><span class="p">(</span><span class="s2">&quot;10.1002/cplu.202200123&quot;</span><span class="p">),</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Automated Bonding Analysis with Crystal Orbital Hamilton Populations&quot;</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="Cohpcar">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Cohpcar">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Cohpcar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read COXXCAR.lobster/COXXCAR.LCFO.lobster files generated by LOBSTER.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        cohp_data (dict[str, Dict[str, Any]]): The COHP data of the form:</span>
<span class="sd">            {bond: {&quot;COHP&quot;: {Spin.up: cohps, Spin.down:cohps},</span>
<span class="sd">                    &quot;ICOHP&quot;: {Spin.up: icohps, Spin.down: icohps},</span>
<span class="sd">                    &quot;length&quot;: bond length,</span>
<span class="sd">                    &quot;sites&quot;: sites corresponding to the bond}</span>
<span class="sd">            Also contains an entry for the average, which does not have a &quot;length&quot; key.</span>
<span class="sd">        efermi (float): The Fermi level in eV.</span>
<span class="sd">        energies (Sequence[float]): Sequence of energies in eV. Note that LOBSTER</span>
<span class="sd">            shifts the energies so that the Fermi level is at zero.</span>
<span class="sd">        is_spin_polarized (bool): True if the calculation is spin polarized.</span>
<span class="sd">        orb_res_cohp (dict[str, Dict[str, Dict[str, Any]]]): The orbital-resolved COHPs of the form:</span>
<span class="sd">            orb_res_cohp[label] = {bond_data[&quot;orb_label&quot;]: {</span>
<span class="sd">                &quot;COHP&quot;: {Spin.up: cohps, Spin.down:cohps},</span>
<span class="sd">                &quot;ICOHP&quot;: {Spin.up: icohps, Spin.down: icohps},</span>
<span class="sd">                &quot;orbitals&quot;: orbitals,</span>
<span class="sd">                &quot;length&quot;: bond lengths,</span>
<span class="sd">                &quot;sites&quot;: sites corresponding to the bond},</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">are_coops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_multi_center_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">is_lcfo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            are_coops (bool): Whether the file includes COOPs (True) or COHPs (False).</span>
<span class="sd">                Default is False.</span>
<span class="sd">            are_cobis (bool): Whether the file is COBIs (True) or COHPs (False).</span>
<span class="sd">                Default is False.</span>
<span class="sd">            are_multi_center_cobis (bool): Whether the file include multi-center COBIs (True)</span>
<span class="sd">                or two-center COBIs (False). Default is False.</span>
<span class="sd">            is_lcfo (bool): Whether the COXXCAR file is from LCFO analysis.</span>
<span class="sd">            filename (PathLike): The COHPCAR file. If it is None, the default</span>
<span class="sd">                file name will be chosen, depending on the value of are_coops.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">are_coops</span> <span class="ow">and</span> <span class="n">are_cobis</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">are_coops</span> <span class="ow">and</span> <span class="n">are_multi_center_cobis</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">are_cobis</span> <span class="ow">and</span> <span class="n">are_multi_center_cobis</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot have info about COOPs, COBIs and/or multi-center COBIS in the same file.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">are_coops</span> <span class="o">=</span> <span class="n">are_coops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">are_cobis</span> <span class="o">=</span> <span class="n">are_cobis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">are_multi_center_cobis</span> <span class="o">=</span> <span class="n">are_multi_center_cobis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span> <span class="o">=</span> <span class="n">is_lcfo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">are_coops</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="s2">&quot;COOPCAR.lobster&quot;</span>
            <span class="k">elif</span> <span class="n">are_cobis</span> <span class="ow">or</span> <span class="n">are_multi_center_cobis</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="s2">&quot;COBICAR.lobster&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="s2">&quot;COHPCAR.lobster&quot;</span>

        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># The parameters line is the second line in a COHPCAR file.</span>
        <span class="c1"># It contains all parameters that are needed to map the file.</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c1"># Subtract 1 to skip the average</span>
        <span class="n">num_bonds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_multi_center_cobis</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span>
        <span class="n">cohp_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_multi_center_cobis</span><span class="p">:</span>
            <span class="c1"># The COHP data start in line num_bonds + 3</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">num_bonds</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">:]])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">cohp_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_bonds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">spin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spins</span><span class="p">)},</span>
                    <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_bonds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">spin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spins</span><span class="p">)},</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The COBI data start in line num_bonds + 3 if multi-center cobis exist</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">num_bonds</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">:]])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">energies</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">orb_cohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Present for LOBSTER versions older than 2.2.0</span>
        <span class="n">very_old</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># The label has to be changed: there are more than one COHP for each atom combination</span>
        <span class="c1"># this is done to make the labeling consistent with ICOHPLIST.lobster</span>
        <span class="n">bond_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bond_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bonds</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_multi_center_cobis</span><span class="p">:</span>
                <span class="n">bond_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bond_data</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">bond</span><span class="p">],</span> <span class="n">is_lcfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">)</span>
                <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bond_num</span><span class="p">)</span>
                <span class="n">orbs</span> <span class="o">=</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;orbitals&quot;</span><span class="p">]</span>
                <span class="n">cohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">bond</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_bonds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">spin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spins</span><span class="p">)}</span>
                <span class="n">icohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">bond</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_bonds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">spin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spins</span><span class="p">)}</span>
                <span class="k">if</span> <span class="n">orbs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">bond_num</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bond_num</span><span class="p">)</span>
                    <span class="n">cohp_data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="n">cohp</span><span class="p">,</span>
                        <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="n">icohp</span><span class="p">,</span>
                        <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;cells&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="p">}</span>

                <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">orb_cohp</span><span class="p">:</span>
                    <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">|=</span> <span class="p">{</span>
                        <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;orb_label&quot;</span><span class="p">]:</span> <span class="p">{</span>
                            <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="n">cohp</span><span class="p">,</span>
                            <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="n">icohp</span><span class="p">,</span>
                            <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="n">orbs</span><span class="p">,</span>
                            <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;cells&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">],</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Present for LOBSTER versions older than 2.2.0</span>
                    <span class="k">if</span> <span class="n">bond_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">very_old</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">very_old</span><span class="p">:</span>
                        <span class="n">bond_num</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bond_num</span><span class="p">)</span>

                    <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;orb_label&quot;</span><span class="p">]:</span> <span class="p">{</span>
                            <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="n">cohp</span><span class="p">,</span>
                            <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="n">icohp</span><span class="p">,</span>
                            <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="n">orbs</span><span class="p">,</span>
                            <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;cells&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">],</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">bond_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bond_data</span><span class="p">(</span>
                    <span class="n">lines</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">bond</span><span class="p">],</span>
                    <span class="n">is_lcfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">,</span>
                    <span class="n">are_multi_center_cobis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">are_multi_center_cobis</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bond_num</span><span class="p">)</span>
                <span class="n">orbs</span> <span class="o">=</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;orbitals&quot;</span><span class="p">]</span>

                <span class="n">cohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">bond</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_bonds</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">spin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spins</span><span class="p">)}</span>
                <span class="n">icohp</span> <span class="o">=</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">bond</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_bonds</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">spin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spins</span><span class="p">)}</span>

                <span class="k">if</span> <span class="n">orbs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">bond_num</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bond_num</span><span class="p">)</span>
                    <span class="n">cohp_data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="n">cohp</span><span class="p">,</span>
                        <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="n">icohp</span><span class="p">,</span>
                        <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;cells&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">],</span>
                    <span class="p">}</span>

                <span class="k">elif</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">orb_cohp</span><span class="p">:</span>
                    <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">|=</span> <span class="p">{</span>
                        <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;orb_label&quot;</span><span class="p">]:</span> <span class="p">{</span>
                            <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="n">cohp</span><span class="p">,</span>
                            <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="n">icohp</span><span class="p">,</span>
                            <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="n">orbs</span><span class="p">,</span>
                            <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">],</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Present for LOBSTER versions older than 2.2.0</span>
                    <span class="k">if</span> <span class="n">bond_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">very_old</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">very_old</span><span class="p">:</span>
                        <span class="n">bond_num</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bond_num</span><span class="p">)</span>

                    <span class="n">orb_cohp</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;orb_label&quot;</span><span class="p">]:</span> <span class="p">{</span>
                            <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="n">cohp</span><span class="p">,</span>
                            <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="n">icohp</span><span class="p">,</span>
                            <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="n">orbs</span><span class="p">,</span>
                            <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">],</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

        <span class="c1"># Present for LOBSTER older than 2.2.0</span>
        <span class="k">if</span> <span class="n">very_old</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bond_str</span> <span class="ow">in</span> <span class="n">orb_cohp</span><span class="p">:</span>
                <span class="n">cohp_data</span><span class="p">[</span><span class="n">bond_str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;COHP&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;ICOHP&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="n">bond_data</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">],</span>
                <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orb_res_cohp</span> <span class="o">=</span> <span class="n">orb_cohp</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cohp_data</span> <span class="o">=</span> <span class="n">cohp_data</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_bond_data</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">is_lcfo</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">are_multi_center_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract bond label, site indices, and length from</span>
<span class="sd">        a LOBSTER header line. The site indices are zero-based, so they</span>
<span class="sd">        can be easily used with a Structure object.</span>

<span class="sd">        Example header line:</span>
<span class="sd">            No.4:Fe1-&gt;Fe9(2.4524893531900283)</span>
<span class="sd">        Example header line for orbital-resolved COHP:</span>
<span class="sd">            No.1:Fe1[3p_x]-&gt;Fe2[3d_x^2-y^2](2.456180552772262)</span>

<span class="sd">        Args:</span>
<span class="sd">            line: line in the COHPCAR header describing the bond.</span>
<span class="sd">            is_lcfo: indicates whether the COXXCAR file is from LCFO analysis.</span>
<span class="sd">            are_multi_center_cobis: indicates multi-center COBIs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict with the bond label, the bond length, a tuple of the site</span>
<span class="sd">                indices, a tuple containing the orbitals (if orbital-resolved),</span>
<span class="sd">                and a label for the orbitals (if orbital-resolved).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">are_multi_center_cobis</span><span class="p">:</span>
            <span class="n">line_new</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">sites</span> <span class="o">=</span> <span class="n">line_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">site_indices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\D+&quot;</span><span class="p">,</span> <span class="n">site</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">)</span>
            <span class="c1"># TODO: get cells here as well</span>

            <span class="k">if</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_lcfo</span><span class="p">:</span>
                <span class="n">orbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[(.*)\]&quot;</span><span class="p">,</span> <span class="n">site</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">]</span>
                <span class="n">orb_label</span><span class="p">,</span> <span class="n">orbitals</span> <span class="o">=</span> <span class="n">get_orb_from_str</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">is_lcfo</span><span class="p">:</span>
                <span class="n">orbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[(\d+[a-zA-Z]+\d*)&quot;</span><span class="p">,</span> <span class="n">site</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">]</span>
                <span class="n">orb_label</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span>
                <span class="n">orbitals</span> <span class="o">=</span> <span class="n">orbs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">orbitals</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">orb_label</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">length</span><span class="p">,</span>
                <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="n">site_indices</span><span class="p">,</span>
                <span class="s2">&quot;cells&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="n">orbitals</span><span class="p">,</span>
                <span class="s2">&quot;orb_label&quot;</span><span class="p">:</span> <span class="n">orb_label</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">line_new</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">sites</span> <span class="o">=</span> <span class="n">line_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">site_indices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\D+&quot;</span><span class="p">,</span> <span class="n">site</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">)</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[(.*?)\]&quot;</span><span class="p">,</span> <span class="n">site</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">orbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\]\[(.*)\]&quot;</span><span class="p">,</span> <span class="n">site</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">]</span>
            <span class="n">orb_label</span><span class="p">,</span> <span class="n">orbitals</span> <span class="o">=</span> <span class="n">get_orb_from_str</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orbitals</span> <span class="o">=</span> <span class="n">orb_label</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="n">site_indices</span><span class="p">,</span>
            <span class="s2">&quot;cells&quot;</span><span class="p">:</span> <span class="n">cells</span><span class="p">,</span>
            <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="n">orbitals</span><span class="p">,</span>
            <span class="s2">&quot;orb_label&quot;</span><span class="p">:</span> <span class="n">orb_label</span><span class="p">,</span>
        <span class="p">}</span></div>



<div class="viewcode-block" id="Icohplist">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Icohplist">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Icohplist</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read ICOXXLIST/ICOXXLIST.LCFO.lobster files generated by LOBSTER.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        are_coops (bool): Whether the file includes COOPs (True) or COHPs (False).</span>
<span class="sd">        is_lcfo (bool): Whether the ICOXXLIST file is from LCFO analysis.</span>
<span class="sd">        is_spin_polarized (bool): Whether the calculation is spin polarized.</span>
<span class="sd">        Icohplist (dict[str, Dict[str, Union[float, int, Dict[Spin, float]]]]):</span>
<span class="sd">            The listfile data of the form: {</span>
<span class="sd">                bond: {</span>
<span class="sd">                    &quot;length&quot;: Bond length,</span>
<span class="sd">                    &quot;number_of_bonds&quot;: Number of bonds,</span>
<span class="sd">                    &quot;icohp&quot;: {Spin.up: ICOHP(Ef)_up, Spin.down: ...},</span>
<span class="sd">                    }</span>
<span class="sd">            }</span>
<span class="sd">        IcohpCollection (IcohpCollection): IcohpCollection Object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">is_lcfo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_coops</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">are_cobis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">is_spin_polarized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">orbitalwise</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">icohpcollection</span><span class="p">:</span> <span class="n">IcohpCollection</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            is_lcfo (bool): Whether the ICOHPLIST file is from LCFO analysis.</span>
<span class="sd">            are_coops (bool): Whether the file includes COOPs (True) or COHPs (False).</span>
<span class="sd">                Default is False.</span>
<span class="sd">            are_cobis (bool): Whether the file is COBIs (True) or COHPs (False).</span>
<span class="sd">                Default is False.</span>
<span class="sd">            filename (PathLike): The ICOHPLIST file. If it is None, the default</span>
<span class="sd">                file name will be chosen, depending on the value of are_coops</span>
<span class="sd">            is_spin_polarized (bool): Whether the calculation is spin polarized.</span>
<span class="sd">            orbitalwise (bool): Whether the calculation is orbitalwise.</span>
<span class="sd">            icohpcollection (IcohpCollection): IcohpCollection Object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Avoid circular import</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.electronic_structure.cohp</span><span class="w"> </span><span class="kn">import</span> <span class="n">IcohpCollection</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span> <span class="o">=</span> <span class="n">is_lcfo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="o">=</span> <span class="n">is_spin_polarized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orbitalwise</span> <span class="o">=</span> <span class="n">orbitalwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_icohpcollection</span> <span class="o">=</span> <span class="n">icohpcollection</span>
        <span class="k">if</span> <span class="n">are_coops</span> <span class="ow">and</span> <span class="n">are_cobis</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot have info about COOPs and COBIs in the same file.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">are_coops</span> <span class="o">=</span> <span class="n">are_coops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">are_cobis</span> <span class="o">=</span> <span class="n">are_cobis</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">are_coops</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="s2">&quot;ICOOPLIST.lobster&quot;</span>
            <span class="k">elif</span> <span class="n">are_cobis</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="s2">&quot;ICOBILIST.lobster&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="s2">&quot;ICOHPLIST.lobster&quot;</span>

        <span class="c1"># LOBSTER list files have an extra trailing blank line</span>
        <span class="c1"># and we don&#39;t need the header.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohpcollection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">all_lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">all_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;spin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="n">all_lines</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;ICOHPLIST file contains no data.&quot;</span><span class="p">)</span>

            <span class="c1"># Determine LOBSTER version</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">and</span> <span class="s2">&quot;spin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;3.1.1&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;spin&quot;</span> <span class="ow">in</span> <span class="n">all_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;5.1.0&quot;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;2.2.1&quot;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Please consider using a newer LOBSTER version. See www.cohp.de.&quot;</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported LOBSTER version.&quot;</span><span class="p">)</span>

            <span class="c1"># If the calculation is spin polarized, the line in the middle</span>
            <span class="c1"># of the file will be another header line.</span>
            <span class="c1"># TODO: adapt this for orbital-wise stuff</span>
            <span class="k">if</span> <span class="n">version</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;3.1.1&quot;</span><span class="p">,</span> <span class="s2">&quot;2.2.1&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="o">=</span> <span class="s2">&quot;distance&quot;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># if version == &quot;5.1.0&quot;:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">9</span>

            <span class="c1"># Check if is orbital-wise ICOHPLIST</span>
            <span class="c1"># TODO: include case where there is only one ICOHP</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">:</span>  <span class="c1">#  data consists of atomic orbital interactions</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orbitalwise</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1">#  data consists of molecule or fragment orbital interactions</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orbitalwise</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span>

            <span class="n">data_orbitals</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orbitalwise</span><span class="p">:</span>
                <span class="n">data_without_orbitals</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">data_orbitals</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="p">(</span><span class="s2">&quot;_&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">!=</span> <span class="s2">&quot;5.1.0&quot;</span><span class="p">)</span>
                        <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;_&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;5.1.0&quot;</span><span class="p">)</span>
                        <span class="ow">or</span> <span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;5.1.0&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">data_without_orbitals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;5.1.0&quot;</span><span class="p">:</span>
                        <span class="n">data_orbitals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data_orbitals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_without_orbitals</span> <span class="o">=</span> <span class="n">lines</span>

            <span class="k">if</span> <span class="s2">&quot;distance&quot;</span> <span class="ow">in</span> <span class="n">data_without_orbitals</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">data_without_orbitals</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="c1"># TODO: adapt this for orbital-wise stuff</span>
                <span class="n">n_bonds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_without_orbitals</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">n_bonds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;ICOHPLIST file contains no data.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n_bonds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_without_orbitals</span><span class="p">)</span>

            <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">atom1_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">atom2_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">lens</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">translations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tuple3Ints</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">nums</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">icohps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bonds</span><span class="p">):</span>
                <span class="n">line_parts</span> <span class="o">=</span> <span class="n">data_without_orbitals</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">icohp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">label</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">atom1</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">atom2</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;5.1.0&quot;</span><span class="p">:</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">translation</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span>
                    <span class="p">)</span>
                    <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span><span class="p">:</span>
                        <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;3.1.1&quot;</span><span class="p">:</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">translation</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span>
                    <span class="p">)</span>
                    <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span><span class="p">:</span>
                        <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_without_orbitals</span><span class="p">[</span><span class="n">bond</span> <span class="o">+</span> <span class="n">n_bonds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>  <span class="c1"># if version == &quot;2.2.1&quot;:</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                    <span class="n">translation</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span><span class="p">:</span>
                        <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_without_orbitals</span><span class="p">[</span><span class="n">bond</span> <span class="o">+</span> <span class="n">n_bonds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>

                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="n">atom1_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom1</span><span class="p">)</span>
                <span class="n">atom2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom2</span><span class="p">)</span>
                <span class="n">lens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
                <span class="n">translations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">translation</span><span class="p">)</span>
                <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
                <span class="n">icohps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">icohp</span><span class="p">)</span>

            <span class="n">list_orb_icohp</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orbitalwise</span><span class="p">:</span>
                <span class="n">list_orb_icohp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">version</span> <span class="o">!=</span> <span class="s2">&quot;5.1.0&quot;</span><span class="p">:</span>
                    <span class="n">n_orbs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_orbitals</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_orbitals</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">n_orbs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_orbitals</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i_orb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_orbs</span><span class="p">):</span>
                    <span class="n">data_orb</span> <span class="o">=</span> <span class="n">data_orbitals</span><span class="p">[</span><span class="n">i_orb</span><span class="p">]</span>
                    <span class="n">icohp</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">line_parts</span> <span class="o">=</span> <span class="n">data_orb</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">:</span>  <span class="c1">#  data consists of atomic orbital interactions</span>
                        <span class="n">orbs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_(.*?)(?=\s)&quot;</span><span class="p">,</span> <span class="n">data_orb</span><span class="p">)</span>
                        <span class="n">orb_label</span><span class="p">,</span> <span class="n">orbitals</span> <span class="o">=</span> <span class="n">get_orb_from_str</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span>
                        <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1">#  data consists of molecule or fragment orbital interactions</span>
                        <span class="n">orbs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_(\d+[a-zA-Z]+\d*)&quot;</span><span class="p">,</span> <span class="n">data_orb</span><span class="p">)</span>
                        <span class="n">orb_label</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">orbs</span><span class="p">)</span>
                        <span class="n">orbitals</span> <span class="o">=</span> <span class="n">orbs</span>
                        <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">!=</span> <span class="s2">&quot;5.1.0&quot;</span><span class="p">:</span>
                        <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_orbitals</span><span class="p">[</span><span class="n">n_orbs</span> <span class="o">+</span> <span class="n">i_orb</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;5.1.0&quot;</span><span class="p">:</span>
                        <span class="n">icohp</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_orbitals</span><span class="p">[</span><span class="n">i_orb</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">8</span><span class="p">])</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_orb_icohp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
                        <span class="n">list_orb_icohp</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">orb_label</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;icohp&quot;</span><span class="p">:</span> <span class="n">icohp</span><span class="p">,</span> <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="n">orbitals</span><span class="p">}})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">list_orb_icohp</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">orb_label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;icohp&quot;</span><span class="p">:</span> <span class="n">icohp</span><span class="p">,</span>
                            <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="n">orbitals</span><span class="p">,</span>
                        <span class="p">}</span>

            <span class="c1"># Avoid circular import</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.electronic_structure.cohp</span><span class="w"> </span><span class="kn">import</span> <span class="n">IcohpCollection</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_icohpcollection</span> <span class="o">=</span> <span class="n">IcohpCollection</span><span class="p">(</span>
                <span class="n">are_coops</span><span class="o">=</span><span class="n">are_coops</span><span class="p">,</span>
                <span class="n">are_cobis</span><span class="o">=</span><span class="n">are_cobis</span><span class="p">,</span>
                <span class="n">list_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">list_atom1</span><span class="o">=</span><span class="n">atom1_list</span><span class="p">,</span>
                <span class="n">list_atom2</span><span class="o">=</span><span class="n">atom2_list</span><span class="p">,</span>
                <span class="n">list_length</span><span class="o">=</span><span class="n">lens</span><span class="p">,</span>
                <span class="n">list_translation</span><span class="o">=</span><span class="n">translations</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
                <span class="n">list_num</span><span class="o">=</span><span class="n">nums</span><span class="p">,</span>
                <span class="n">list_icohp</span><span class="o">=</span><span class="n">icohps</span><span class="p">,</span>
                <span class="n">is_spin_polarized</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span><span class="p">,</span>
                <span class="n">list_orb_icohp</span><span class="o">=</span><span class="n">list_orb_icohp</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">icohplist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The ICOHP list compatible with older version of this class.&quot;&quot;&quot;</span>
        <span class="n">icohp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohpcollection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_icohpcollection</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohpcollection</span><span class="o">.</span><span class="n">_icohplist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">icohp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">_length</span><span class="p">,</span>
                <span class="s2">&quot;number_of_bonds&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">_num</span><span class="p">,</span>
                <span class="s2">&quot;icohp&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">_icohp</span><span class="p">,</span>
                <span class="s2">&quot;translation&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">_translation</span><span class="p">,</span>
                <span class="s2">&quot;orbitals&quot;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">_orbitals</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">icohp_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">icohpcollection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IcohpCollection</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The IcohpCollection object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icohpcollection</span></div>



<div class="viewcode-block" id="NciCobiList">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.NciCobiList">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NciCobiList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read NcICOBILIST (multi-center ICOBI) files generated by LOBSTER.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        is_spin_polarized (bool): Whether the calculation is spin polarized.</span>
<span class="sd">        NciCobiList (dict): The listfile data of the form:</span>
<span class="sd">            {</span>
<span class="sd">                bond: {</span>
<span class="sd">                    &quot;number_of_atoms&quot;: Number of atoms involved in the multi-center interaction,</span>
<span class="sd">                    &quot;ncicobi&quot;: {Spin.up: Nc-ICOBI(Ef)_up, Spin.down: ...},</span>
<span class="sd">                    &quot;interaction_type&quot;: Type of the multi-center interaction,</span>
<span class="sd">                    }</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;NcICOBILIST.lobster&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        LOBSTER &lt; 4.1.0: no COBI/ICOBI/NcICOBI</span>

<span class="sd">        Args:</span>
<span class="sd">            filename: Name of the NcICOBILIST file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># LOBSTER list files have an extra trailing blank line</span>
        <span class="c1"># and we don&#39;t need the header</span>
        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NcICOBILIST file contains no data.&quot;</span><span class="p">)</span>

        <span class="c1"># If the calculation is spin-polarized, the line in the middle</span>
        <span class="c1"># of the file will be another header line.</span>
        <span class="c1"># TODO: adapt this for orbitalwise case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span> <span class="o">=</span> <span class="s2">&quot;spin&quot;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Check if orbitalwise NcICOBILIST</span>
        <span class="c1"># include case when there is only one NcICOBI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orbital_wise</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># set as default</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>  <span class="c1"># NcICOBIs orbitalwise and non-orbitalwise can be mixed</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="s2">&quot;s]&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">:]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orbital_wise</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;This is an orbitalwise NcICOBILIST.lobster file. &quot;</span>
                    <span class="s2">&quot;Currently, the orbitalwise information is not read!&quot;</span><span class="p">,</span>
                    <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">break</span>  <span class="c1"># condition has only to be met once</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orbital_wise</span><span class="p">:</span>
            <span class="n">data_without_orbitals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">:])</span> <span class="ow">and</span> <span class="s2">&quot;s]&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">:]):</span>
                    <span class="n">data_without_orbitals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_without_orbitals</span> <span class="o">=</span> <span class="n">lines</span>

        <span class="k">if</span> <span class="s2">&quot;spin&quot;</span> <span class="ow">in</span> <span class="n">data_without_orbitals</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">data_without_orbitals</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="c1"># TODO: adapt this for orbitalwise case</span>
            <span class="n">n_bonds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_without_orbitals</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">n_bonds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NcICOBILIST file contains no data.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_bonds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_without_orbitals</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">list_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_n_atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_ncicobi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_interaction_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_num</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bonds</span><span class="p">):</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">data_without_orbitals</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">ncicobi</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">label</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">n_atoms</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ncicobi</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">interaction_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spin_polarized</span><span class="p">:</span>
                <span class="n">ncicobi</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_without_orbitals</span><span class="p">[</span><span class="n">bond</span> <span class="o">+</span> <span class="n">n_bonds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">list_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_n_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_ncicobi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncicobi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_interaction_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interaction_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

        <span class="c1"># TODO: add functions to get orbital resolved NcICOBIs</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ncicobi_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: ncicobilist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ncicobi_list</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_labels</span><span class="p">)):</span>
            <span class="n">ncicobi_list</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;number_of_atoms&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_n_atoms</span><span class="p">[</span><span class="n">idx</span><span class="p">]),</span>
                <span class="s2">&quot;ncicobi&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_ncicobi</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                <span class="s2">&quot;interaction_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_interaction_type</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">ncicobi_list</span></div>



<div class="viewcode-block" id="Doscar">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Doscar">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Doscar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Store LOBSTER&#39;s projected DOS and local projected DOS.</span>
<span class="sd">    The beforehand quantum-chemical calculation was performed with VASP.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        completedos (LobsterCompleteDos): LobsterCompleteDos Object.</span>
<span class="sd">        pdos (list): List of Dict including NumPy arrays with pdos. Access as</span>
<span class="sd">            pdos[atomindex][&#39;orbitalstring&#39;][&#39;Spin.up/Spin.down&#39;].</span>
<span class="sd">        tdos (Dos): Dos Object of the total density of states.</span>
<span class="sd">        energies (NDArray): Numpy array of the energies at which the DOS was calculated</span>
<span class="sd">            (in eV, relative to Efermi).</span>
<span class="sd">        tdensities (dict): tdensities[Spin.up]: NumPy array of the total density of states for</span>
<span class="sd">            the Spin.up contribution at each of the energies. tdensities[Spin.down]: NumPy array</span>
<span class="sd">            of the total density of states for the Spin.down contribution at each of the energies.</span>
<span class="sd">            If is_spin_polarized=False, tdensities[Spin.up]: NumPy array of the total density of states.</span>
<span class="sd">        itdensities (dict): itdensities[Spin.up]: NumPy array of the total density of states for</span>
<span class="sd">            the Spin.up contribution at each of the energies. itdensities[Spin.down]: NumPy array</span>
<span class="sd">            of the total density of states for the Spin.down contribution at each of the energies.</span>
<span class="sd">            If is_spin_polarized=False, itdensities[Spin.up]: NumPy array of the total density of states.</span>
<span class="sd">        is_spin_polarized (bool): Whether the system is spin polarized.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">doscar</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;DOSCAR.lobster&quot;</span><span class="p">,</span>
        <span class="n">is_lcfo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">structure_file</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">IStructure</span> <span class="o">|</span> <span class="n">Structure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            doscar (PathLike): The DOSCAR file, typically &quot;DOSCAR.lobster&quot;.</span>
<span class="sd">            is_lcfo (bool): Whether the DOSCAR file is from LCFO analysis.</span>
<span class="sd">            structure_file (PathLike): For VASP, this is typically &quot;POSCAR&quot;.</span>
<span class="sd">            structure (Structure): Instead of a structure file (preferred),</span>
<span class="sd">                the Structure can be given directly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_doscar</span> <span class="o">=</span> <span class="n">doscar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_lcfo</span> <span class="o">=</span> <span class="n">is_lcfo</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_final_structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">structure_file</span><span class="p">)</span> <span class="k">if</span> <span class="n">structure_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">structure</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_doscar</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_doscar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">doscar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_doscar</span>

        <span class="n">tdensities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">itdensities</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">doscar</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>  <span class="c1"># Skip the first line</span>
            <span class="n">efermi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">([</span><span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)][</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">17</span><span class="p">])</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">orbitals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>  <span class="c1"># Read the next line containing dos data</span>
            <span class="k">while</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                    <span class="n">ndos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">orbitals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

                    <span class="n">line</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">cdos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ndos</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)))</span>
                    <span class="n">cdos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">idx_dos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndos</span><span class="p">):</span>
                        <span class="n">line_parts</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">cdos</span><span class="p">[</span><span class="n">idx_dos</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line_parts</span><span class="p">)</span>
                    <span class="n">dos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cdos</span><span class="p">)</span>

                <span class="n">line</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>  <span class="c1"># Read the next line to continue the loop</span>

        <span class="n">doshere</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doshere</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">doshere</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There is something wrong with the DOSCAR. Can&#39;t extract spin polarization.&quot;</span><span class="p">)</span>

        <span class="n">energies</span> <span class="o">=</span> <span class="n">doshere</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span><span class="p">:</span>
            <span class="n">tdensities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">doshere</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">itdensities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">doshere</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">pdoss</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dos</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">pdos</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">dos</span><span class="p">[</span><span class="n">atom</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>

                <span class="k">for</span> <span class="n">orb_num</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncol</span><span class="p">)):</span>
                    <span class="n">orb</span> <span class="o">=</span> <span class="n">orbitals</span><span class="p">[</span><span class="n">atom</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">orb_num</span><span class="p">]</span>
                    <span class="n">pdos</span><span class="p">[</span><span class="n">orb</span><span class="p">][</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span>
                <span class="n">pdoss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tdensities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">doshere</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">tdensities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">doshere</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">itdensities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">doshere</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="n">itdensities</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">doshere</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
            <span class="n">pdoss</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dos</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">pdos</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">dos</span><span class="p">[</span><span class="n">atom</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
                <span class="n">orb_num</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncol</span><span class="p">):</span>
                    <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span> <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span>
                    <span class="n">orb</span> <span class="o">=</span> <span class="n">orbitals</span><span class="p">[</span><span class="n">atom</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">orb_num</span><span class="p">]</span>
                    <span class="n">pdos</span><span class="p">[</span><span class="n">orb</span><span class="p">][</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">orb_num</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">pdoss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdos</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_efermi</span> <span class="o">=</span> <span class="n">efermi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pdos</span> <span class="o">=</span> <span class="n">pdoss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tdos</span> <span class="o">=</span> <span class="n">Dos</span><span class="p">(</span><span class="n">efermi</span><span class="p">,</span> <span class="n">energies</span><span class="p">,</span> <span class="n">tdensities</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_energies</span> <span class="o">=</span> <span class="n">energies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tdensities</span> <span class="o">=</span> <span class="n">tdensities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_itdensities</span> <span class="o">=</span> <span class="n">itdensities</span>
        <span class="n">final_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_final_structure</span>

        <span class="c1"># for DOCAR.LCFO.lobster, pdos is different than for non-LCFO DOSCAR so we need to handle it differently</span>
        <span class="c1"># for now we just set pdos_dict to be empty if LCFO is in the filename</span>
        <span class="c1"># Todo: handle LCFO pdos properly in future when we have complete set of orbitals</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_lcfo</span><span class="p">:</span>
            <span class="n">pdoss_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">final_struct</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">pdos</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pdos</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pdos</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pdoss_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">final_struct</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pdos</span><span class="p">)}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_completedos</span> <span class="o">=</span> <span class="n">LobsterCompleteDos</span><span class="p">(</span><span class="n">final_struct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tdos</span><span class="p">,</span> <span class="n">pdoss_dict</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">completedos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LobsterCompleteDos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LobsterCompleteDos.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_completedos</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pdos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Projected DOS (PDOS).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pdos</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tdos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Total DOS (TDOS).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tdos</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">energies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Energies.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_energies</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tdensities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Total DOS as a np.array.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tdensities</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">itdensities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Integrated total DOS as a np.array.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itdensities</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_spin_polarized</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether run is spin polarized.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_spin_polarized</span></div>



<div class="viewcode-block" id="Charge">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Charge">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Charge</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read CHARGE.lobster/ CHARGE.LCFO.lobster files generated by LOBSTER.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        atomlist (list[str]): List of atoms in CHARGE.lobster.</span>
<span class="sd">        is_lcfo (bool): Whether the CHARGE file is from LCFO analysis. Default is False.</span>
<span class="sd">        types (list[str]): List of types of atoms in CHARGE.lobster.</span>
<span class="sd">        mulliken (list[float]): List of Mulliken charges of atoms in CHARGE.lobster.</span>
<span class="sd">        loewdin (list[float]): List of Loewdin charges of atoms in CHARGE.Loewdin.</span>
<span class="sd">        num_atoms (int): Number of atoms in CHARGE.lobster.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;CHARGE.lobster&quot;</span><span class="p">,</span>
        <span class="n">is_lcfo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_atoms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">atomlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mulliken</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">loewdin</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The CHARGE file, typically &quot;CHARGE.lobster&quot;.</span>
<span class="sd">            is_lcfo (bool): Whether the CHARGE file is from LCFO analysis. Default is False.</span>
<span class="sd">            num_atoms (int): Number of atoms in the structure.</span>
<span class="sd">            atomlist (list[str]): Atoms in the structure.</span>
<span class="sd">            types (list[str]): Unique species in the structure.</span>
<span class="sd">            mulliken (list[float]): Mulliken charges.</span>
<span class="sd">            loewdin (list[float]): Loewdin charges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span> <span class="o">=</span> <span class="n">is_lcfo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">=</span> <span class="n">num_atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">types</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomlist</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">atomlist</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">atomlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mulliken</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">mulliken</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mulliken</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loewdin</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">loewdin</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">loewdin</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;CHARGES file contains no data.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">atom_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span><span class="p">):</span>
                <span class="n">line_parts</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">atom_idx</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mulliken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loewdin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loewdin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

<div class="viewcode-block" id="Charge.get_structure_with_charges">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Charge.get_structure_with_charges">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_structure_with_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_filename</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a Structure with Mulliken and Loewdin charges as site properties</span>

<span class="sd">        Args:</span>
<span class="sd">            structure_filename (PathLike): The POSCAR file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Structure Object with Mulliken and Loewdin charges as site properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">structure_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">:</span>
            <span class="n">mulliken</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mulliken</span>
            <span class="n">loewdin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loewdin</span>
            <span class="n">site_properties</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Mulliken Charges&quot;</span><span class="p">:</span> <span class="n">mulliken</span><span class="p">,</span> <span class="s2">&quot;Loewdin Charges&quot;</span><span class="p">:</span> <span class="n">loewdin</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">site_properties</span><span class="o">=</span><span class="n">site_properties</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;CHARGE.LCFO.lobster charges are not sorted site wise. Thus, the site properties cannot be added.&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `mulliken` instead.&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Mulliken</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mulliken</span>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `loewdin` instead.&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Loewdin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loewdin</span></div>



<div class="viewcode-block" id="Lobsterout">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Lobsterout">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Lobsterout</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read the lobsterout and evaluate the spilling, save the basis, save warnings, save info.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        basis_functions (list[str]): Basis functions that were used in lobster run as strings.</span>
<span class="sd">        basis_type (list[str]): Basis types that were used in lobster run as strings.</span>
<span class="sd">        charge_spilling (list[float]): Charge spilling (first entry: result for spin 1,</span>
<span class="sd">            second entry: result for spin 2 or not present).</span>
<span class="sd">        dft_program (str): The DFT program used for the calculation of the wave function.</span>
<span class="sd">        elements (list[str]): Elements that were present in LOBSTER calculation.</span>
<span class="sd">        has_charge (bool): Whether CHARGE.lobster is present.</span>
<span class="sd">        has_cohpcar (bool): Whether COHPCAR.lobster and ICOHPLIST.lobster are present.</span>
<span class="sd">        has_madelung (bool): Whether SitePotentials.lobster and MadelungEnergies.lobster are present.</span>
<span class="sd">        has_coopcar (bool): Whether COOPCAR.lobster and ICOOPLIST.lobster are present.</span>
<span class="sd">        has_cobicar (bool): Whether COBICAR.lobster and ICOBILIST.lobster are present.</span>
<span class="sd">        has_doscar (bool): Whether DOSCAR.lobster is present.</span>
<span class="sd">        has_doscar_lso (bool): Whether DOSCAR.LSO.lobster is present.</span>
<span class="sd">        has_projection (bool): Whether projectionData.lobster is present.</span>
<span class="sd">        has_bandoverlaps (bool): Whether bandOverlaps.lobster is present.</span>
<span class="sd">        has_density_of_energies (bool): Whether DensityOfEnergy.lobster is present.</span>
<span class="sd">        has_fatbands (bool): Whether fatband calculation was performed.</span>
<span class="sd">        has_grosspopulation (bool): Whether GROSSPOP.lobster is present.</span>
<span class="sd">        has_polarization (bool): Whether POLARIZATION.lobster is present.</span>
<span class="sd">        info_lines (str): Additional information on the run.</span>
<span class="sd">        info_orthonormalization (str): Information on orthonormalization.</span>
<span class="sd">        is_restart_from_projection (bool): Whether that calculation was restarted</span>
<span class="sd">            from an existing projection file.</span>
<span class="sd">        lobster_version (str): The LOBSTER version.</span>
<span class="sd">        number_of_spins (int): The number of spins.</span>
<span class="sd">        number_of_threads (int): How many threads were used.</span>
<span class="sd">        timing (dict[str, float]): Dict with infos on timing.</span>
<span class="sd">        total_spilling (list[float]): The total spilling for spin channel 1 (and spin channel 2).</span>
<span class="sd">        warning_lines (str): String with all warnings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Valid Lobsterout attributes</span>
    <span class="n">_ATTRIBUTES</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;filename&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_restart_from_projection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lobster_version&quot;</span><span class="p">,</span>
        <span class="s2">&quot;number_of_threads&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dft_program&quot;</span><span class="p">,</span>
        <span class="s2">&quot;number_of_spins&quot;</span><span class="p">,</span>
        <span class="s2">&quot;charge_spilling&quot;</span><span class="p">,</span>
        <span class="s2">&quot;total_spilling&quot;</span><span class="p">,</span>
        <span class="s2">&quot;elements&quot;</span><span class="p">,</span>
        <span class="s2">&quot;basis_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;basis_functions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;timing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;warning_lines&quot;</span><span class="p">,</span>
        <span class="s2">&quot;info_orthonormalization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;info_lines&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_doscar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_doscar_lso&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_doscar_lcfo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_cohpcar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_cohpcar_lcfo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_coopcar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_coopcar_lcfo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_cobicar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_cobicar_lcfo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_charge&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_madelung&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_mofecar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_projection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_bandoverlaps&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_fatbands&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_grosspopulation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_polarization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_density_of_energies&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># TODO: add tests for skipping COBI and Madelung</span>
    <span class="c1"># TODO: add tests for including COBI and Madelung</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The lobsterout file.</span>
<span class="sd">            **kwargs: dict to initialize Lobsterout instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ATTRIBUTES</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2"> is not a valid attribute for Lobsterout&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;lobsterout does not contain any data&quot;</span><span class="p">)</span>

            <span class="c1"># Check if LOBSTER starts from a projection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_restart_from_projection</span> <span class="o">=</span> <span class="s2">&quot;loading projection from projectionData.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lobster_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lobster_version</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_threads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_threads</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dft_program</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dft_program</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_spins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_number_of_spins</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">chargespilling</span><span class="p">,</span> <span class="n">totalspilling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_spillings</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">number_of_spins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_spins</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge_spilling</span> <span class="o">=</span> <span class="n">chargespilling</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_spilling</span> <span class="o">=</span> <span class="n">totalspilling</span>

            <span class="n">elements</span><span class="p">,</span> <span class="n">basistype</span><span class="p">,</span> <span class="n">basisfunctions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_elements_basistype_basisfunctions</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basis_type</span> <span class="o">=</span> <span class="n">basistype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basis_functions</span> <span class="o">=</span> <span class="n">basisfunctions</span>

            <span class="n">wall_time</span><span class="p">,</span> <span class="n">user_time</span><span class="p">,</span> <span class="n">sys_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_timing</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;wall_time&quot;</span><span class="p">:</span> <span class="n">wall_time</span><span class="p">,</span>
                <span class="s2">&quot;user_time&quot;</span><span class="p">:</span> <span class="n">user_time</span><span class="p">,</span>
                <span class="s2">&quot;sys_time&quot;</span><span class="p">:</span> <span class="n">sys_time</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">warninglines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_warning_lines</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning_lines</span> <span class="o">=</span> <span class="n">warninglines</span>

            <span class="n">orthowarning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_warning_orthonormalization</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_orthonormalization</span> <span class="o">=</span> <span class="n">orthowarning</span>

            <span class="n">infos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_info_lines</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_lines</span> <span class="o">=</span> <span class="n">infos</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">has_doscar</span> <span class="o">=</span> <span class="s2">&quot;writing DOSCAR.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span> <span class="ow">and</span> <span class="s2">&quot;SKIPPING writing DOSCAR.lobster...&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_doscar_lso</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;writing DOSCAR.LSO.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span> <span class="ow">and</span> <span class="s2">&quot;SKIPPING writing DOSCAR.LSO.lobster...&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">version_number</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lobster_version</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">version_number</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">version_number</span> <span class="o">&lt;</span> <span class="mf">5.1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_cohpcar</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;writing COOPCAR.lobster and ICOOPLIST.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
                    <span class="ow">and</span> <span class="s2">&quot;SKIPPING writing COOPCAR.lobster and ICOOPLIST.lobster...&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_coopcar</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;writing COHPCAR.lobster and ICOHPLIST.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
                    <span class="ow">and</span> <span class="s2">&quot;SKIPPING writing COHPCAR.lobster and ICOHPLIST.lobster...&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_cobicar</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;writing COBICAR.lobster and ICOBILIST.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
                    <span class="ow">and</span> <span class="s2">&quot;SKIPPING writing COBICAR.lobster and ICOBILIST.lobster...&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_cohpcar</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;writing COOPCAR.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span> <span class="ow">and</span> <span class="s2">&quot;SKIPPING writing COOPCAR.lobster...&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_coopcar</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;writing COHPCAR.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span> <span class="ow">and</span> <span class="s2">&quot;SKIPPING writing COHPCAR.lobster...&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_cobicar</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;writing COBICAR.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span> <span class="ow">and</span> <span class="s2">&quot;SKIPPING writing COBICAR.lobster...&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">has_cobicar_lcfo</span> <span class="o">=</span> <span class="s2">&quot;writing COBICAR.LCFO.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_cohpcar_lcfo</span> <span class="o">=</span> <span class="s2">&quot;writing COHPCAR.LCFO.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_coopcar_lcfo</span> <span class="o">=</span> <span class="s2">&quot;writing COOPCAR.LCFO.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_doscar_lcfo</span> <span class="o">=</span> <span class="s2">&quot;writing DOSCAR.LCFO.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_polarization</span> <span class="o">=</span> <span class="s2">&quot;writing polarization to POLARIZATION.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_charge</span> <span class="o">=</span> <span class="s2">&quot;SKIPPING writing CHARGE.lobster...&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_projection</span> <span class="o">=</span> <span class="s2">&quot;saving projection to projectionData.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_bandoverlaps</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;WARNING: I dumped the band overlap matrices to the file bandOverlaps.lobster.&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_fatbands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_fatband</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">lines</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_grosspopulation</span> <span class="o">=</span> <span class="s2">&quot;writing CHARGE.lobster and GROSSPOP.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_density_of_energies</span> <span class="o">=</span> <span class="s2">&quot;writing DensityOfEnergy.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_madelung</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;writing SitePotentials.lobster and MadelungEnergies.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
                <span class="ow">and</span> <span class="s2">&quot;skipping writing SitePotentials.lobster and MadelungEnergies.lobster...&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_mofecar</span> <span class="o">=</span> <span class="s2">&quot;Writing MOFECAR.lobster and IMOFELIST.lobster...&quot;</span> <span class="ow">in</span> <span class="n">lines</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must provide either filename or kwargs to initialize Lobsterout&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Lobsterout.get_doc">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Lobsterout.get_doc">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a dict with all information stored in lobsterout.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="c1"># Check if LOBSTER starts from a projection</span>
            <span class="s2">&quot;restart_from_projection&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_restart_from_projection</span><span class="p">,</span>
            <span class="s2">&quot;lobster_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lobster_version</span><span class="p">,</span>
            <span class="s2">&quot;threads&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_threads</span><span class="p">,</span>
            <span class="s2">&quot;dft_program&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dft_program</span><span class="p">,</span>
            <span class="s2">&quot;charge_spilling&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_spilling</span><span class="p">,</span>
            <span class="s2">&quot;total_spilling&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_spilling</span><span class="p">,</span>
            <span class="s2">&quot;elements&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span>
            <span class="s2">&quot;basis_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis_type</span><span class="p">,</span>
            <span class="s2">&quot;basis_functions&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis_functions</span><span class="p">,</span>
            <span class="s2">&quot;timing&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing</span><span class="p">,</span>
            <span class="s2">&quot;warning_lines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning_lines</span><span class="p">,</span>
            <span class="s2">&quot;info_orthonormalization&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_orthonormalization</span><span class="p">,</span>
            <span class="s2">&quot;info_lines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_lines</span><span class="p">,</span>
            <span class="s2">&quot;has_doscar&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_doscar</span><span class="p">,</span>
            <span class="s2">&quot;has_doscar_lso&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_doscar_lso</span><span class="p">,</span>
            <span class="s2">&quot;has_doscar_lcfo&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_doscar_lcfo</span><span class="p">,</span>
            <span class="s2">&quot;has_cohpcar&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_cohpcar</span><span class="p">,</span>
            <span class="s2">&quot;has_cohpcar_lcfo&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_cohpcar_lcfo</span><span class="p">,</span>
            <span class="s2">&quot;has_coopcar&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_coopcar</span><span class="p">,</span>
            <span class="s2">&quot;has_coopcar_lcfo&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_coopcar_lcfo</span><span class="p">,</span>
            <span class="s2">&quot;has_cobicar&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_cobicar</span><span class="p">,</span>
            <span class="s2">&quot;has_cobicar_lcfo&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_cobicar_lcfo</span><span class="p">,</span>
            <span class="s2">&quot;has_charge&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_charge</span><span class="p">,</span>
            <span class="s2">&quot;has_madelung&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_madelung</span><span class="p">,</span>
            <span class="s2">&quot;has_mofecar&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_mofecar</span><span class="p">,</span>
            <span class="s2">&quot;has_projection&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_projection</span><span class="p">,</span>
            <span class="s2">&quot;has_bandoverlaps&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_bandoverlaps</span><span class="p">,</span>
            <span class="s2">&quot;has_fatbands&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_fatbands</span><span class="p">,</span>
            <span class="s2">&quot;has_grosspopulation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_grosspopulation</span><span class="p">,</span>
            <span class="s2">&quot;has_polarization&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_polarization</span><span class="p">,</span>
            <span class="s2">&quot;has_density_of_energies&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_density_of_energies</span><span class="p">,</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="Lobsterout.as_dict">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Lobsterout.as_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;MSONable dict.&quot;&quot;&quot;</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;@module&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;@class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="k">return</span> <span class="n">dct</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_lobster_version</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get LOBSTER version.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;LOBSTER&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Version not found.&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_has_fatband</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether calculation has hatband data.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;FatBand&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_dft_program</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the DFT program used for calculation.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;program...&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_number_of_spins</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get index of spin channel.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="k">if</span> <span class="s2">&quot;spillings for spin channel 2&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_threads</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get number of CPU threads.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">11</span> <span class="ow">and</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;threads&quot;</span><span class="p">,</span> <span class="s2">&quot;thread&quot;</span><span class="p">}:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Threads not found.&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_spillings</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">number_of_spins</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get charge spillings and total spillings.&quot;&quot;&quot;</span>
        <span class="n">charge_spillings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_spillings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;spilling:&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;charge&quot;</span><span class="p">:</span>
                    <span class="n">charge_spillings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span>
                    <span class="n">total_spillings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">charge_spillings</span><span class="p">)</span> <span class="o">==</span> <span class="n">number_of_spins</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">total_spillings</span><span class="p">)</span> <span class="o">==</span> <span class="n">number_of_spins</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">charge_spillings</span><span class="p">,</span> <span class="n">total_spillings</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_elements_basistype_basisfunctions</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get elements, basis types and basis functions.&quot;&quot;&quot;</span>
        <span class="n">begin</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">end</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">basistypes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">basisfunctions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">begin</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">end</span><span class="p">:</span>
                <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span>
                    <span class="s2">&quot;INFO:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;WARNING:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;setting&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;calculating&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;post-processing&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;saving&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;spillings&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;writing&quot;</span><span class="p">,</span>
                <span class="p">}:</span>
                    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">basistypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="c1"># Last sign is &#39;&#39;</span>
                    <span class="n">basisfunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="s2">&quot;setting up local basis functions...&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">begin</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">elements</span><span class="p">,</span> <span class="n">basistypes</span><span class="p">,</span> <span class="n">basisfunctions</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_timing</span><span class="p">(</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get wall time, user time and system time.&quot;&quot;&quot;</span>
        <span class="n">begin</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">user_times</span><span class="p">,</span> <span class="n">wall_times</span><span class="p">,</span> <span class="n">sys_times</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;finished&quot;</span> <span class="ow">in</span> <span class="n">line_parts</span><span class="p">:</span>
                <span class="n">begin</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">begin</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;wall&quot;</span> <span class="ow">in</span> <span class="n">line_parts</span><span class="p">:</span>
                    <span class="n">wall_times</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;user&quot;</span> <span class="ow">in</span> <span class="n">line_parts</span><span class="p">:</span>
                    <span class="n">user_times</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;sys&quot;</span> <span class="ow">in</span> <span class="n">line_parts</span><span class="p">:</span>
                    <span class="n">sys_times</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>

        <span class="n">wall_time_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="n">wall_times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">wall_times</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="n">wall_times</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
            <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="n">wall_times</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">user_time_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="n">user_times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">user_times</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="n">user_times</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
            <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="n">user_times</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">sys_time_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="n">sys_times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">sys_times</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="n">sys_times</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
            <span class="s2">&quot;ms&quot;</span><span class="p">:</span> <span class="n">sys_times</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">wall_time_dict</span><span class="p">,</span> <span class="n">user_time_dict</span><span class="p">,</span> <span class="n">sys_time_dict</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_warning_orthonormalization</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get orthonormalization warnings.&quot;&quot;&quot;</span>
        <span class="n">orthowarnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;orthonormalized&quot;</span> <span class="ow">in</span> <span class="n">line_parts</span><span class="p">:</span>
                <span class="n">orthowarnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="k">return</span> <span class="n">orthowarnings</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_all_warning_lines</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all WARNING lines.&quot;&quot;&quot;</span>
        <span class="n">warnings_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;WARNING:&quot;</span><span class="p">:</span>
                <span class="n">warnings_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="k">return</span> <span class="n">warnings_</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_all_info_lines</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all INFO lines.&quot;&quot;&quot;</span>
        <span class="n">infos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;INFO:&quot;</span><span class="p">:</span>
                <span class="n">infos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="k">return</span> <span class="n">infos</span></div>



<div class="viewcode-block" id="Fatband">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Fatband">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Fatband</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read FATBAND_x_y.lobster files.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        efermi (float): Fermi level read from vasprun.xml.</span>
<span class="sd">        eigenvals (dict[Spin, NDArray]): Eigenvalues as a dictionary of NumPy arrays of shape (nbands, nkpoints).</span>
<span class="sd">            The first index of the array refers to the band and the second to the index of the kpoint.</span>
<span class="sd">            The kpoints are ordered according to the order of the kpoints_array attribute.</span>
<span class="sd">            If the band structure is not spin polarized, we only store one data set under Spin.up.</span>
<span class="sd">        is_spin_polarized (bool): Whether this was a spin-polarized calculation.</span>
<span class="sd">        kpoints_array (list[NDArray]): List of kpoints as NumPy arrays, in frac_coords of the given</span>
<span class="sd">            lattice by default.</span>
<span class="sd">        label_dict (dict[str, Union[str, NDArray]]): Dictionary that links a kpoint (in frac coords or Cartesian</span>
<span class="sd">            coordinates depending on the coords attribute) to a label.</span>
<span class="sd">        lattice (Lattice): Lattice object of reciprocal lattice as read from vasprun.xml.</span>
<span class="sd">        nbands (int): Number of bands used in the calculation.</span>
<span class="sd">        p_eigenvals (dict[Spin, NDArray]): Dictionary of orbital projections as {spin: array of dict}.</span>
<span class="sd">            The indices of the array are [band_index, kpoint_index].</span>
<span class="sd">            The dict is then built the following way: {&quot;string of element&quot;: &quot;string of orbital as read in</span>
<span class="sd">            from FATBAND file&quot;}. If the band structure is not spin polarized, we only store one data set under Spin.up.</span>
<span class="sd">        structure (Structure): Structure object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filenames</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">PathLike</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">kpoints_file</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;KPOINTS&quot;</span><span class="p">,</span>
        <span class="n">vasprun_file</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span> <span class="o">|</span> <span class="n">IStructure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">efermi</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            filenames (PathLike | list[PathLike]): File names or path to a</span>
<span class="sd">                folder from which all &quot;FATBAND_*&quot; files will be read.</span>
<span class="sd">            kpoints_file (PathLike): KPOINTS file for bandstructure calculation, typically &quot;KPOINTS&quot;.</span>
<span class="sd">            vasprun_file (PathLike): Corresponding vasprun.xml file. Instead, the</span>
<span class="sd">                Fermi level from the DFT run can be provided. Then, this should be set to None.</span>
<span class="sd">            structure (Structure): Structure object.</span>
<span class="sd">            efermi (float): Fermi level in eV.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Make sure all relevant FATBAND files were generated and read in!&quot;</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Use Lobster 3.2.0 or newer for fatband calculations!&quot;</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A structure object has to be provided&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="k">if</span> <span class="n">vasprun_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">efermi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vasprun_file or efermi have to be provided&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">reciprocal_lattice</span>
        <span class="k">if</span> <span class="n">vasprun_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">vasprun_file</span><span class="p">,</span>
                <span class="n">ionic_step_skip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">ionic_step_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">parse_dos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">parse_eigen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">parse_projected_eigen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">parse_potcar_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">occu_tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
                <span class="n">exception_on_bad_xml</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">efermi</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="n">efermi</span>
        <span class="n">kpoints_object</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">kpoints_file</span><span class="p">)</span>

        <span class="c1"># atom_type = []</span>
        <span class="n">atom_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">orbital_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filenames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filenames_new</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">filenames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filenames</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;FATBAND_*.lobster&quot;</span><span class="p">):</span>
                    <span class="n">filenames_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="n">filenames_new</span>  <span class="c1"># type: ignore[assignment]</span>

        <span class="n">filenames</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">PathLike</span><span class="p">],</span> <span class="n">filenames</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No FATBAND files in folder or given&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">atom_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c1"># atom_type.append(re.split(r&quot;[0-9]+&quot;, parameters[3])[0].capitalize())</span>
            <span class="n">orbital_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

        <span class="c1"># Get atomtype orbital dict</span>
        <span class="n">atom_orbital_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atom_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">atom</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">atom_orbital_dict</span><span class="p">:</span>
                <span class="n">atom_orbital_dict</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">atom_orbital_dict</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orbital_names</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

        <span class="c1"># Test if there are the same orbitals twice or if two different</span>
        <span class="c1"># formats were used or if all necessary orbitals are there</span>
        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">atom_orbital_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">items</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The are two FATBAND files for the same atom and orbital. The program will stop.&quot;</span><span class="p">)</span>
            <span class="n">split</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">split</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">split</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">}:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Make sure all relevant orbitals were generated and that no duplicates (2p and 2p_x) are &quot;</span>
                        <span class="s2">&quot;present&quot;</span>
                    <span class="p">)</span>

        <span class="n">kpoints_array</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">eigenvals</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">p_eigenvals</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ifilename</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ifilename</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nbands</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_kpts</span> <span class="o">=</span> <span class="n">kpoints_object</span><span class="o">.</span><span class="n">num_kpts</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbands</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_spinpolarized</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbands</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_spinpolarized</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linenumbers</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">iline</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbands</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
                        <span class="n">linenumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">ifilename</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_spinpolarized</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linenumbers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

            <span class="k">if</span> <span class="n">ifilename</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">eigenvals</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">eigenvals</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_kpts</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbands</span><span class="p">)]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spinpolarized</span><span class="p">:</span>
                    <span class="n">eigenvals</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">[</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_kpts</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbands</span><span class="p">)</span>
                    <span class="p">]</span>

                <span class="n">p_eigenvals</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">p_eigenvals</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">orb</span><span class="p">):</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">atom_orbital_dict</span><span class="p">[</span><span class="n">elem</span><span class="p">]}</span>
                            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">atom_names</span>
                        <span class="p">}</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_kpts</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbands</span><span class="p">)</span>
                <span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spinpolarized</span><span class="p">:</span>
                    <span class="n">p_eigenvals</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="nb">str</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">orb</span><span class="p">):</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">atom_orbital_dict</span><span class="p">[</span><span class="n">elem</span><span class="p">]}</span>
                                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">atom_names</span>
                            <span class="p">}</span>
                            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_kpts</span><span class="p">)</span>
                        <span class="p">]</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbands</span><span class="p">)</span>
                    <span class="p">]</span>

            <span class="n">idx_kpt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">linenumber</span> <span class="o">=</span> <span class="n">iband</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
                    <span class="n">KPOINT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">]),</span>
                            <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">]),</span>
                            <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">]),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">ifilename</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">kpoints_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">KPOINT</span><span class="p">)</span>

                    <span class="n">linenumber</span> <span class="o">=</span> <span class="n">iband</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">idx_kpt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">linenumber</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbands</span><span class="p">:</span>
                    <span class="n">iband</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">linenumber</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbands</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ifilename</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">eigenvals</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">][</span><span class="n">iband</span><span class="p">][</span><span class="n">idx_kpt</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span>

                        <span class="n">p_eigenvals</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">][</span><span class="n">iband</span><span class="p">][</span><span class="n">idx_kpt</span><span class="p">][</span><span class="n">atom_names</span><span class="p">[</span><span class="n">ifilename</span><span class="p">]][</span><span class="n">orbital_names</span><span class="p">[</span><span class="n">ifilename</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">linenumber</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbands</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spinpolarized</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ifilename</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">eigenvals</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">][</span><span class="n">iband</span><span class="p">][</span><span class="n">idx_kpt</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">efermi</span>
                        <span class="n">p_eigenvals</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">][</span><span class="n">iband</span><span class="p">][</span><span class="n">idx_kpt</span><span class="p">][</span><span class="n">atom_names</span><span class="p">[</span><span class="n">ifilename</span><span class="p">]][</span><span class="n">orbital_names</span><span class="p">[</span><span class="n">ifilename</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                            <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="p">)</span>

                    <span class="n">linenumber</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">iband</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints_array</span> <span class="o">=</span> <span class="n">kpoints_array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eigenvals</span> <span class="o">=</span> <span class="n">eigenvals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_eigenvals</span> <span class="o">=</span> <span class="n">p_eigenvals</span>

        <span class="n">label_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">kpoints_object</span><span class="o">.</span><span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kpoints_object</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">number_kpts</span> <span class="p">:],</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">label_dict</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">kpoints_array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_dict</span> <span class="o">=</span> <span class="n">label_dict</span>

<div class="viewcode-block" id="Fatband.get_bandstructure">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Fatband.get_bandstructure">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_bandstructure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LobsterBandStructureSymmLine</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a LobsterBandStructureSymmLine object which can be plotted with a normal BSPlotter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LobsterBandStructureSymmLine</span><span class="p">(</span>
            <span class="n">kpoints</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kpoints_array</span><span class="p">,</span>
            <span class="n">eigenvals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvals</span><span class="p">,</span>
            <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lattice</span><span class="p">,</span>
            <span class="n">efermi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">efermi</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
            <span class="n">labels_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_dict</span><span class="p">,</span>
            <span class="n">structure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span>
            <span class="n">projections</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p_eigenvals</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Bandoverlaps">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Bandoverlaps">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Bandoverlaps</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read bandOverlaps.lobster files, which are not created during every LOBSTER run.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        band_overlaps_dict (dict[Spin, Dict[str, Dict[str, Union[float, NDArray]]]]): A dictionary</span>
<span class="sd">            containing the band overlap data of the form: {spin: {&quot;kpoint as string&quot;: {&quot;maxDeviation&quot;:</span>
<span class="sd">            float that describes the max deviation, &quot;matrix&quot;: 2D array of the size number of bands</span>
<span class="sd">            times number of bands including the overlap matrices with}}}.</span>
<span class="sd">        max_deviation (list[float]): The maximal deviation for each problematic kpoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;bandOverlaps.lobster&quot;</span><span class="p">,</span>
        <span class="n">band_overlaps_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_deviation</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The &quot;bandOverlaps.lobster&quot; file.</span>
<span class="sd">            band_overlaps_dict: The band overlap data of the form:</span>
<span class="sd">                {</span>
<span class="sd">                    spin: {</span>
<span class="sd">                        &quot;k_points&quot; : list of k-point array,</span>
<span class="sd">                        &quot;max_deviations&quot;: list of max deviations associated with each k-point,</span>
<span class="sd">                        &quot;matrices&quot;: list of the overlap matrices associated with each k-point,</span>
<span class="sd">                    }</span>
<span class="sd">                }.</span>
<span class="sd">            max_deviation (list[float]): The maximal deviations for each problematic k-point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">band_overlaps_dict</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">band_overlaps_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_deviation</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">max_deviation</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_deviation</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">spin_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="k">else</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">spin_numbers</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">spin_numbers</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read all lines of the file.</span>

<span class="sd">        Args:</span>
<span class="sd">            lines (list[str]): Lines of the file.</span>
<span class="sd">            spin_numbers (list[int]): Spin numbers depending on LOBSTER version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spin</span><span class="p">:</span> <span class="n">Spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span>
        <span class="n">kpoint_array</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">overlaps</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># This has to be done like this because there can be different numbers</span>
        <span class="c1"># of problematic k-points per spin</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;Overlap Matrix (abs) of the orthonormalized projected bands for spin </span><span class="si">{</span><span class="n">spin_numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span>

            <span class="k">elif</span> <span class="sa">f</span><span class="s2">&quot;Overlap Matrix (abs) of the orthonormalized projected bands for spin </span><span class="si">{</span><span class="n">spin_numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span>

            <span class="k">elif</span> <span class="s2">&quot;k-point&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">kpoint</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">kpoint_array</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">kpointel</span> <span class="ow">in</span> <span class="n">kpoint</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kpointel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;at&quot;</span><span class="p">,</span> <span class="s2">&quot;k-point&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">}:</span>
                        <span class="n">kpoint_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kpointel</span><span class="p">))</span>

            <span class="k">elif</span> <span class="s2">&quot;maxDeviation&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">spin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="s2">&quot;k_points&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">][</span><span class="s2">&quot;k_points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s2">&quot;max_deviations&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">][</span><span class="s2">&quot;max_deviations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s2">&quot;matrices&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">][</span><span class="s2">&quot;matrices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">maxdev</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">][</span><span class="s2">&quot;max_deviations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">maxdev</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">][</span><span class="s2">&quot;k_points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpoint_array</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_deviation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">maxdev</span><span class="p">))</span>
                <span class="n">overlaps</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">_lines</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">el</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">el</span><span class="p">))</span>
                <span class="n">overlaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_lines</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">overlaps</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">_lines</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">][</span><span class="s2">&quot;matrices&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">overlaps</span><span class="p">))</span>

<div class="viewcode-block" id="Bandoverlaps.has_good_quality_maxDeviation">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Bandoverlaps.has_good_quality_maxDeviation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_good_quality_maxDeviation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit_maxDeviation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the maxDeviation from the ideal bandoverlap is smaller</span>
<span class="sd">        or equal to a limit.</span>

<span class="sd">        Args:</span>
<span class="sd">            limit_maxDeviation (float): Upper Limit of the maxDeviation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Whether the ideal bandoverlap is smaller or equal to the limit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">deviation</span> <span class="o">&lt;=</span> <span class="n">limit_maxDeviation</span> <span class="k">for</span> <span class="n">deviation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deviation</span><span class="p">)</span></div>


<div class="viewcode-block" id="Bandoverlaps.has_good_quality_check_occupied_bands">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Bandoverlaps.has_good_quality_check_occupied_bands">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_good_quality_check_occupied_bands</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">number_occ_bands_spin_up</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">number_occ_bands_spin_down</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">spin_polarized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">limit_deviation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the deviation from the ideal bandoverlap of all occupied bands</span>
<span class="sd">        is smaller or equal to limit_deviation.</span>

<span class="sd">        Args:</span>
<span class="sd">            number_occ_bands_spin_up (int): Number of occupied bands of spin up.</span>
<span class="sd">            number_occ_bands_spin_down (int): Number of occupied bands of spin down.</span>
<span class="sd">            spin_polarized (bool): Whether this is a spin polarized calculation.</span>
<span class="sd">            limit_deviation (float): Upper limit of the maxDeviation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the quality of the projection is good.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">spin_polarized</span> <span class="ow">and</span> <span class="n">number_occ_bands_spin_down</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;number_occ_bands_spin_down has to be specified&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">,</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">)</span> <span class="k">if</span> <span class="n">spin_polarized</span> <span class="k">else</span> <span class="p">(</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">,):</span>
            <span class="n">num_occ_bands</span> <span class="o">=</span> <span class="n">number_occ_bands_spin_up</span> <span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span> <span class="k">else</span> <span class="n">number_occ_bands_spin_down</span>

            <span class="k">for</span> <span class="n">overlap_matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span><span class="p">[</span><span class="n">spin</span><span class="p">][</span><span class="s2">&quot;matrices&quot;</span><span class="p">]:</span>
                <span class="n">sub_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">overlap_matrix</span><span class="p">)[:</span><span class="n">num_occ_bands</span><span class="p">,</span> <span class="p">:</span><span class="n">num_occ_bands</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">sub_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">num_occ_bands</span><span class="p">),</span> <span class="n">atol</span><span class="o">=</span><span class="n">limit_deviation</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>


    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `band_overlaps_dict` instead.&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bandoverlapsdict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_overlaps_dict</span></div>



<div class="viewcode-block" id="Grosspop">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Grosspop">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Grosspop</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read GROSSPOP.lobster/ GROSSPOP.LCFO.lobster files.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        list_dict_grosspop (list[dict[str, str| dict[str, str]]]): List of dictionaries</span>
<span class="sd">            including all information about the grosspopulations. Each dictionary contains the following keys:</span>
<span class="sd">            - &#39;element&#39;: The element symbol of the atom.</span>
<span class="sd">            - &#39;Mulliken GP&#39;: A dictionary of Mulliken gross populations, where the keys are the orbital labels and the</span>
<span class="sd">                values are the corresponding gross populations as strings.</span>
<span class="sd">            - &#39;Loewdin GP&#39;: A dictionary of Loewdin gross populations, where the keys are the orbital labels and the</span>
<span class="sd">                values are the corresponding gross populations as strings.</span>
<span class="sd">            The 0th entry of the list refers to the first atom in GROSSPOP.lobster and so on.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;GROSSPOP.lobster&quot;</span><span class="p">,</span>
        <span class="n">is_lcfo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">list_dict_grosspop</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The &quot;GROSSPOP.lobster&quot; file.</span>
<span class="sd">            is_lcfo (bool): Whether the GROSSPOP file is in LCFO format.</span>
<span class="sd">            list_dict_grosspop (list[dict]): All information about the gross populations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span> <span class="o">=</span> <span class="n">is_lcfo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_dict_grosspop</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">list_dict_grosspop</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">list_dict_grosspop</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_dict_grosspop</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Read file to list of dict</span>
            <span class="n">small_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
                <span class="n">cleanlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">:</span>
                    <span class="n">small_dict</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;Mulliken GP&quot;</span><span class="p">:</span> <span class="p">{},</span>
                        <span class="s2">&quot;Loewdin GP&quot;</span><span class="p">:</span> <span class="p">{},</span>
                        <span class="s2">&quot;element&quot;</span><span class="p">:</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">}</span>
                    <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Mulliken GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">:</span>
                    <span class="n">small_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;mol&quot;</span><span class="p">:</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
                    <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">:</span>
                    <span class="n">small_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;mol&quot;</span><span class="p">:</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
                    <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                    <span class="p">}</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Mulliken GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                    <span class="p">}</span>
                    <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="s2">&quot;total&quot;</span> <span class="ow">in</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">list_dict_grosspop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">small_dict</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">and</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="n">small_dict</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;Mulliken GP&quot;</span><span class="p">:</span> <span class="p">{},</span>
                        <span class="s2">&quot;Loewdin GP&quot;</span><span class="p">:</span> <span class="p">{},</span>
                        <span class="s2">&quot;element&quot;</span><span class="p">:</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">}</span>
                    <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Mulliken GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                    <span class="p">}</span>
                    <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                        <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span>
                    <span class="p">}</span>

                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;spin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                        <span class="p">}</span>
                    <span class="k">if</span> <span class="s2">&quot;total&quot;</span> <span class="ow">in</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">list_dict_grosspop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">small_dict</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s2">&quot;spin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Mulliken GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">small_dict</span><span class="p">[</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">][</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">if</span> <span class="s2">&quot;total&quot;</span> <span class="ow">in</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">list_dict_grosspop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">small_dict</span><span class="p">)</span>

<div class="viewcode-block" id="Grosspop.get_structure_with_total_grosspop">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Grosspop.get_structure_with_total_grosspop">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_structure_with_total_grosspop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_filename</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a Structure with Mulliken and Loewdin total grosspopulations as site properties.</span>

<span class="sd">        Args:</span>
<span class="sd">            structure_filename (PathLike): The POSCAR file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Structure Object with Mulliken and Loewdin total grosspopulations as site properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">structure_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_lcfo</span><span class="p">:</span>
            <span class="n">mulliken_gps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">loewdin_gps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">grosspop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_dict_grosspop</span><span class="p">:</span>
                <span class="n">mulliken_gps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grosspop</span><span class="p">[</span><span class="s2">&quot;Mulliken GP&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">])</span>
                <span class="n">loewdin_gps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grosspop</span><span class="p">[</span><span class="s2">&quot;Loewdin GP&quot;</span><span class="p">][</span><span class="s2">&quot;total&quot;</span><span class="p">])</span>

            <span class="n">site_properties</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Total Mulliken GP&quot;</span><span class="p">:</span> <span class="n">mulliken_gps</span><span class="p">,</span>
                <span class="s2">&quot;Total Loewdin GP&quot;</span><span class="p">:</span> <span class="n">loewdin_gps</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">site_properties</span><span class="o">=</span><span class="n">site_properties</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The GROSSPOP.LCFO.lobster data is not site wise. Thus, the site properties cannot be added.&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Wavefunction">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Wavefunction">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Wavefunction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read wave function files from LOBSTER and create an VolumetricData object.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        grid (tuple[int, int, int]): Grid for the wave function [Nx+1, Ny+1, Nz+1].</span>
<span class="sd">        points (list[Tuple[float, float, float]]): Points.</span>
<span class="sd">        real (list[float]): Real parts of wave function.</span>
<span class="sd">        imaginary (list[float]): Imaginary parts of wave function.</span>
<span class="sd">        distance (list[float]): Distances to the first point in wave function file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The wavecar file from LOBSTER.</span>
<span class="sd">            structure (Structure): The Structure object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaginary</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">Wavefunction</span><span class="o">.</span><span class="n">_parse_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_file</span><span class="p">(</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tuple3Ints</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Vector3D</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse wave function file.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The file to parse.</span>

<span class="sd">        Returns:</span>
<span class="sd">            grid (tuple[int, int, int]): Grid for the wave function [Nx+1, Ny+1, Nz+1].</span>
<span class="sd">            points (list[Tuple[float, float, float]]): Points.</span>
<span class="sd">            real (list[float]): Real parts of wave function.</span>
<span class="sd">            imaginary (list[float]): Imaginary parts of wave function.</span>
<span class="sd">            distance (list[float]): Distances to the first point in wave function file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">imaginaries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_parts</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">grid</span><span class="p">:</span> <span class="n">Tuple3Ints</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">8</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
                <span class="n">distances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">reals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                <span class="n">imaginaries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reals</span><span class="p">)</span> <span class="o">!=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">imaginaries</span><span class="p">)</span> <span class="o">!=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Something went wrong while reading the file&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">grid</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">reals</span><span class="p">,</span> <span class="n">imaginaries</span><span class="p">,</span> <span class="n">distances</span>

<div class="viewcode-block" id="Wavefunction.set_volumetric_data">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Wavefunction.set_volumetric_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_volumetric_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">Tuple3Ints</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the VolumetricData instances.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid (tuple[int, int, int]): Grid on which wavefunction was calculated, e.g. (1, 2, 2).</span>
<span class="sd">            structure (Structure): The Structure object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">Ny</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">Nz</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">new_x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_z</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_real</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_imaginary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_density</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">runner</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))):</span>
            <span class="n">x_here</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Ny</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Nz</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_here</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Ny</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Nz</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">z_here</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Ny</span><span class="p">)</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Nz</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">Nx</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">!=</span> <span class="n">Ny</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">!=</span> <span class="n">Nz</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">runner</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_here</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">runner</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_here</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">runner</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">z_here</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;The provided wavefunction from Lobster does not contain all relevant&quot;</span>
                        <span class="s2">&quot; points. &quot;</span>
                        <span class="s2">&quot;Please use a line similar to: printLCAORealSpaceWavefunction kpoint 1 &quot;</span>
                        <span class="s2">&quot;coordinates 0.0 0.0 0.0 coordinates 1.0 1.0 1.0 box bandlist 1 &quot;</span>
                    <span class="p">)</span>

                <span class="n">new_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_here</span><span class="p">)</span>
                <span class="n">new_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_here</span><span class="p">)</span>
                <span class="n">new_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_here</span><span class="p">)</span>

                <span class="n">new_real</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">runner</span><span class="p">])</span>
                <span class="n">new_imaginary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imaginary</span><span class="p">[</span><span class="n">runner</span><span class="p">])</span>
                <span class="n">new_density</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">runner</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">imaginary</span><span class="p">[</span><span class="n">runner</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">final_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">new_real</span><span class="p">,</span> <span class="p">[</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_imaginary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">new_imaginary</span><span class="p">,</span> <span class="p">[</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">new_density</span><span class="p">,</span> <span class="p">[</span><span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">Nz</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">volumetricdata_real</span> <span class="o">=</span> <span class="n">VolumetricData</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_real</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumetricdata_imaginary</span> <span class="o">=</span> <span class="n">VolumetricData</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_imaginary</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volumetricdata_density</span> <span class="o">=</span> <span class="n">VolumetricData</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_density</span><span class="p">})</span></div>


<div class="viewcode-block" id="Wavefunction.get_volumetricdata_real">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Wavefunction.get_volumetricdata_real">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_volumetricdata_real</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VolumetricData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a VolumetricData object including the real part of the wave function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            VolumetricData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;volumetricdata_real&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_volumetric_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumetricdata_real</span></div>


<div class="viewcode-block" id="Wavefunction.get_volumetricdata_imaginary">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Wavefunction.get_volumetricdata_imaginary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_volumetricdata_imaginary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VolumetricData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a VolumetricData object including the imaginary part of the wave function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            VolumetricData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;volumetricdata_imaginary&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_volumetric_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumetricdata_imaginary</span></div>


<div class="viewcode-block" id="Wavefunction.get_volumetricdata_density">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Wavefunction.get_volumetricdata_density">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_volumetricdata_density</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VolumetricData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a VolumetricData object including the density part of the wave function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            VolumetricData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;volumetricdata_density&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_volumetric_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">volumetricdata_density</span></div>


<div class="viewcode-block" id="Wavefunction.write_file">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Wavefunction.write_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;WAVECAR.vasp&quot;</span><span class="p">,</span>
        <span class="n">part</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;imaginary&quot;</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the wave function in a file that can be read by VESTA.</span>

<span class="sd">        This will only work if the wavefunction from lobster is constructed with:</span>
<span class="sd">            &quot;printLCAORealSpaceWavefunction kpoint 1 coordinates 0.0 0.0 0.0</span>
<span class="sd">            coordinates 1.0 1.0 1.0 box bandlist 1 2 3 4 5 6 &quot;</span>
<span class="sd">            or similar (the whole unit cell has to be covered!).</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The output file, e.g. &quot;WAVECAR.vasp&quot;.</span>
<span class="sd">            part (&quot;real&quot; | &quot;imaginary&quot; | &quot;density&quot;]): Part of the wavefunction to save.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;volumetricdata_real&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;volumetricdata_imaginary&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;volumetricdata_density&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_volumetric_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">part</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volumetricdata_real</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">part</span> <span class="o">==</span> <span class="s2">&quot;imaginary&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volumetricdata_imaginary</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">part</span> <span class="o">==</span> <span class="s2">&quot;density&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volumetricdata_density</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;part can be only &quot;real&quot; or &quot;imaginary&quot; or &quot;density&quot;&#39;</span><span class="p">)</span></div>
</div>



<span class="c1"># Madelung and site potential classes</span>
<div class="viewcode-block" id="MadelungEnergies">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.MadelungEnergies">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MadelungEnergies</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read MadelungEnergies.lobster files generated by LOBSTER.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        madelungenergies_mulliken (float): The Madelung energy based on the Mulliken approach.</span>
<span class="sd">        madelungenergies_loewdin (float): The Madelung energy based on the Loewdin approach.</span>
<span class="sd">        ewald_splitting (float): The Ewald splitting parameter to compute SitePotentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;MadelungEnergies.lobster&quot;</span><span class="p">,</span>
        <span class="n">ewald_splitting</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">madelungenergies_mulliken</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">madelungenergies_loewdin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The &quot;MadelungEnergies.lobster&quot; file.</span>
<span class="sd">            ewald_splitting (float): The Ewald splitting parameter to compute SitePotentials.</span>
<span class="sd">            madelungenergies_mulliken (float): The Madelung energy based on the Mulliken approach.</span>
<span class="sd">            madelungenergies_loewdin (float): The Madelung energy based on the Loewdin approach.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ewald_splitting</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">ewald_splitting</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ewald_splitting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_loewdin</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">madelungenergies_loewdin</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">madelungenergies_loewdin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_mulliken</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">madelungenergies_mulliken</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">madelungenergies_mulliken</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ewald_splitting</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;MadelungEnergies file contains no data.&quot;</span><span class="p">)</span>

            <span class="n">line_parts</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ewald_splitting</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_mulliken</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_loewdin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `madelungenergies_loewdin` instead.&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">madelungenergies_Loewdin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_loewdin</span>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `madelungenergies_mulliken` instead.&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">madelungenergies_Mulliken</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_mulliken</span></div>



<div class="viewcode-block" id="SitePotential">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.SitePotential">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SitePotential</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read SitePotentials.lobster files generated by LOBSTER.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        atomlist (list[str]): Atoms in SitePotentials.lobster.</span>
<span class="sd">        types (list[str]): Types of atoms in SitePotentials.lobster.</span>
<span class="sd">        num_atoms (int): Number of atoms in SitePotentials.lobster.</span>
<span class="sd">        sitepotentials_mulliken (list[float]): Mulliken potentials of sites in SitePotentials.lobster.</span>
<span class="sd">        sitepotentials_loewdin (list[float]): Loewdin potentials of sites in SitePotentials.lobster.</span>
<span class="sd">        madelungenergies_mulliken (float): The Madelung energy based on the Mulliken approach.</span>
<span class="sd">        madelungenergies_loewdin (float): The Madelung energy based on the Loewdin approach.</span>
<span class="sd">        ewald_splitting (float): The Ewald Splitting parameter to compute SitePotentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;SitePotentials.lobster&quot;</span><span class="p">,</span>
        <span class="n">ewald_splitting</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_atoms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">atomlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sitepotentials_loewdin</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sitepotentials_mulliken</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">madelungenergies_mulliken</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">madelungenergies_loewdin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The SitePotentials file, typically &quot;SitePotentials.lobster&quot;.</span>
<span class="sd">            ewald_splitting (float): Ewald splitting parameter used for computing Madelung energies.</span>
<span class="sd">            num_atoms (int): Number of atoms in the structure.</span>
<span class="sd">            atomlist (list[str]): Atoms in the structure.</span>
<span class="sd">            types (list[str]): Unique atom types in the structure.</span>
<span class="sd">            sitepotentials_loewdin (list[float]): Loewdin site potentials.</span>
<span class="sd">            sitepotentials_mulliken (list[float]): Mulliken site potentials.</span>
<span class="sd">            madelungenergies_mulliken (float): Madelung energy based on the Mulliken approach.</span>
<span class="sd">            madelungenergies_loewdin (float): Madelung energy based on the Loewdin approach.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ewald_splitting</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">ewald_splitting</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">num_atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">atomlist</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sitepotentials_loewdin</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitepotentials_loewdin</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sitepotentials_mulliken</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitepotentials_mulliken</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_loewdin</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">madelungenergies_loewdin</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_mulliken</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">madelungenergies_mulliken</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;SitePotentials file contains no data.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ewald_splitting</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">9</span><span class="p">])</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span><span class="p">):</span>
                <span class="n">line_parts</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atomlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sitepotentials_mulliken</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sitepotentials_loewdin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_mulliken</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_loewdin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>

<div class="viewcode-block" id="SitePotential.get_structure_with_site_potentials">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.SitePotential.get_structure_with_site_potentials">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_structure_with_site_potentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure_filename</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Structure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a Structure with Mulliken and Loewdin charges as site properties.</span>

<span class="sd">        Args:</span>
<span class="sd">            structure_filename (PathLike): The POSCAR file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Structure Object with Mulliken and Loewdin charges as site properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">structure_filename</span><span class="p">)</span>
        <span class="n">mulliken</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitepotentials_mulliken</span>
        <span class="n">loewdin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitepotentials_loewdin</span>
        <span class="n">site_properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Mulliken Site Potentials (eV)&quot;</span><span class="p">:</span> <span class="n">mulliken</span><span class="p">,</span>
            <span class="s2">&quot;Loewdin Site Potentials (eV)&quot;</span><span class="p">:</span> <span class="n">loewdin</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">site_properties</span><span class="o">=</span><span class="n">site_properties</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `sitepotentials_mulliken` instead.&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sitepotentials_Mulliken</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitepotentials_mulliken</span>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `sitepotentials_loewdin` instead.&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sitepotentials_Loewdin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sitepotentials_loewdin</span>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `madelungenergies_mulliken` instead.&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">madelungenergies_Mulliken</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_mulliken</span>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `madelungenergies_loewdin` instead.&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">madelungenergies_Loewdin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">madelungenergies_loewdin</span></div>



<div class="viewcode-block" id="get_orb_from_str">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.get_orb_from_str">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_orb_from_str</span><span class="p">(</span><span class="n">orbs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Orbital</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Orbitals from string representations.</span>

<span class="sd">    Args:</span>
<span class="sd">        orbs (list[str]): Orbitals, e.g. [&quot;2p_x&quot;, &quot;3s&quot;].</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[str, list[tuple[int, Orbital]]]: Orbital label, orbitals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: also use for plotting of DOS</span>
    <span class="n">orb_labs</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="s2">&quot;p_y&quot;</span><span class="p">,</span>
        <span class="s2">&quot;p_z&quot;</span><span class="p">,</span>
        <span class="s2">&quot;p_x&quot;</span><span class="p">,</span>
        <span class="s2">&quot;d_xy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;d_yz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;d_z^2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;d_xz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;d_x^2-y^2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;f_y(3x^2-y^2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;f_xyz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;f_yz^2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;f_z^3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;f_xz^2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;f_z(x^2-y^2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;f_x(x^2-3y^2)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">orbitals</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">orb</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">Orbital</span><span class="p">(</span><span class="n">orb_labs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">orb</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span> <span class="k">for</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">orbs</span><span class="p">]</span>

    <span class="n">orb_label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">iorb</span><span class="p">,</span> <span class="n">orbital</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orbitals</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">iorb</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">orb_label</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orbital</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}{</span><span class="n">orbital</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orb_label</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;-</span><span class="si">{</span><span class="n">orbital</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}{</span><span class="n">orbital</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">orb_label</span><span class="p">,</span> <span class="n">orbitals</span></div>



<div class="viewcode-block" id="LobsterMatrices">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.LobsterMatrices">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LobsterMatrices</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read Matrices file generated by LOBSTER (e.g. hamiltonMatrices.lobster).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        If filename == &quot;hamiltonMatrices.lobster&quot;:</span>
<span class="sd">            onsite_energies (list[NDArray]): Real parts of onsite energies from the</span>
<span class="sd">                matrices each k-point.</span>
<span class="sd">            average_onsite_energies (dict): Average onsite elements energies for</span>
<span class="sd">                all k-points with keys as basis used in the LOBSTER computation</span>
<span class="sd">                (uses only real part of matrix).</span>
<span class="sd">            hamilton_matrices (dict[Spin, NDArray]): The complex Hamilton matrix at each</span>
<span class="sd">                k-point with k-point and spin as keys.</span>

<span class="sd">        If filename == &quot;coefficientMatrices.lobster&quot;:</span>
<span class="sd">            onsite_coefficients (list[NDArray]): Real parts of onsite coefficients</span>
<span class="sd">                from the matrices each k-point.</span>
<span class="sd">            average_onsite_coefficient (dict): Average onsite elements coefficients</span>
<span class="sd">                for all k-points with keys as basis used in the LOBSTER computation</span>
<span class="sd">                (uses only real part of matrix).</span>
<span class="sd">            coefficient_matrices (dict[Spin, NDArray]): The coefficients matrix</span>
<span class="sd">                at each k-point with k-point and spin as keys.</span>

<span class="sd">        If filename == &quot;transferMatrices.lobster&quot;:</span>
<span class="sd">            onsite_transfer (list[NDArray]): Real parts of onsite transfer</span>
<span class="sd">                coefficients from the matrices at each k-point.</span>
<span class="sd">            average_onsite_transfer (dict): Average onsite elements transfer</span>
<span class="sd">                coefficients for all k-points with keys as basis used in the</span>
<span class="sd">                LOBSTER computation (uses only real part of matrix).</span>
<span class="sd">            transfer_matrices (dict[Spin, NDArray]): The coefficients matrix at</span>
<span class="sd">                each k-point with k-point and spin as keys.</span>

<span class="sd">        If filename == &quot;overlapMatrices.lobster&quot;:</span>
<span class="sd">            onsite_overlaps (list[NDArray]): Real parts of onsite overlaps</span>
<span class="sd">                from the matrices each k-point.</span>
<span class="sd">            average_onsite_overlaps (dict): Average onsite elements overlaps</span>
<span class="sd">                for all k-points with keys as basis used in the LOBSTER</span>
<span class="sd">                computation (uses only real part of matrix).</span>
<span class="sd">            overlap_matrices (dict[NDArray]): The overlap matrix at</span>
<span class="sd">                each k-point with k-point as keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">e_fermi</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;hamiltonMatrices.lobster&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            e_fermi (float): Fermi level in eV for the structure only.</span>
<span class="sd">                Relevant if input file contains Hamilton matrices data.</span>
<span class="sd">            filename (PathLike): The hamiltonMatrices file, typically &quot;hamiltonMatrices.lobster&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Please check provided input file, it seems to be empty&quot;</span><span class="p">)</span>

        <span class="n">pattern_coeff_hamil_trans</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(\d+)\s+kpoint\s+(\d+)&quot;</span>  <span class="c1"># regex pattern to extract spin and k-point number</span>
        <span class="n">pattern_overlap</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;kpoint\s+(\d+)&quot;</span>  <span class="c1"># regex pattern to extract k-point number</span>

        <span class="k">if</span> <span class="s2">&quot;hamilton&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e_fermi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please provide the fermi energy in eV &quot;</span><span class="p">)</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onsite_energies</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">average_onsite_energies</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hamilton_matrices</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_matrix</span><span class="p">(</span><span class="n">file_data</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">pattern_coeff_hamil_trans</span><span class="p">,</span> <span class="n">e_fermi</span><span class="o">=</span><span class="n">e_fermi</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;coefficient&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onsite_coefficients</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">average_onsite_coefficient</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coefficient_matrices</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_matrix</span><span class="p">(</span><span class="n">file_data</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">pattern_coeff_hamil_trans</span><span class="p">,</span> <span class="n">e_fermi</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;transfer&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onsite_transfer</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">average_onsite_transfer</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transfer_matrices</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_matrix</span><span class="p">(</span><span class="n">file_data</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">pattern_coeff_hamil_trans</span><span class="p">,</span> <span class="n">e_fermi</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;overlap&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">onsite_overlaps</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">average_onsite_overlaps</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">overlap_matrices</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_matrix</span><span class="p">(</span><span class="n">file_data</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">pattern_overlap</span><span class="p">,</span> <span class="n">e_fermi</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_matrix</span><span class="p">(</span>
        <span class="n">file_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">e_fermi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
        <span class="n">complex_matrices</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">matrix_diagonal_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start_inxs_real</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">end_inxs_real</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start_inxs_imag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">end_inxs_imag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Get indices of real and imaginary part of matrix for each k point</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_data</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;Real parts&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">start_inxs_real</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># ignore the first occurrence as files start with real matrices</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">end_inxs_imag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

                <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">file_data</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">matches</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">complex_matrices</span><span class="p">[</span><span class="n">matches</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="s2">&quot;Imag parts&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">end_inxs_real</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">start_inxs_imag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Explicitly add the last line as files end with imaginary matrix</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">end_inxs_imag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_data</span><span class="p">))</span>

        <span class="c1"># Extract matrix data and store diagonal elements</span>
        <span class="n">matrix_real</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">matrix_imag</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">start_inx_real</span><span class="p">,</span> <span class="n">end_inx_real</span><span class="p">,</span> <span class="n">start_inx_imag</span><span class="p">,</span> <span class="n">end_inx_imag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">start_inxs_real</span><span class="p">,</span> <span class="n">end_inxs_real</span><span class="p">,</span> <span class="n">start_inxs_imag</span><span class="p">,</span> <span class="n">end_inxs_imag</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">):</span>
            <span class="c1"># Matrix with text headers</span>
            <span class="n">matrix_real</span> <span class="o">=</span> <span class="n">file_data</span><span class="p">[</span><span class="n">start_inx_real</span><span class="p">:</span><span class="n">end_inx_real</span><span class="p">]</span>
            <span class="n">matrix_imag</span> <span class="o">=</span> <span class="n">file_data</span><span class="p">[</span><span class="n">start_inx_imag</span><span class="p">:</span><span class="n">end_inx_imag</span><span class="p">]</span>

            <span class="c1"># Extract only numerical data and convert to NumPy arrays</span>
            <span class="n">matrix_array_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">matrix_real</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">matrix_array_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">matrix_imag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="c1"># Combine real and imaginary parts to create a complex matrix</span>
            <span class="n">comp_matrix</span> <span class="o">=</span> <span class="n">matrix_array_real</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">matrix_array_imag</span>

            <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">file_data</span><span class="p">[</span><span class="n">start_inx_real</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">matches</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">spin</span> <span class="o">=</span> <span class="n">Spin</span><span class="o">.</span><span class="n">up</span> <span class="k">if</span> <span class="n">matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span> <span class="k">else</span> <span class="n">Spin</span><span class="o">.</span><span class="n">down</span>
                <span class="n">k_point</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">complex_matrices</span><span class="p">[</span><span class="n">k_point</span><span class="p">]</span> <span class="o">|=</span> <span class="p">{</span><span class="n">spin</span><span class="p">:</span> <span class="n">comp_matrix</span><span class="p">}</span>
            <span class="k">elif</span> <span class="n">matches</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">k_point</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">complex_matrices</span> <span class="o">|=</span> <span class="p">{</span><span class="n">k_point</span><span class="p">:</span> <span class="n">comp_matrix</span><span class="p">}</span>
            <span class="n">matrix_diagonal_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp_matrix</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span> <span class="o">-</span> <span class="n">e_fermi</span><span class="p">)</span>

        <span class="c1"># Extract elements basis functions as list</span>
        <span class="n">elements_basis_functions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">matrix_real</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;basisfunction&quot;</span>
        <span class="p">]</span>

        <span class="c1"># Get average row-wise</span>
        <span class="n">average_matrix_diagonal_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">matrix_diagonal_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Get a dict with basis functions as keys and average values as values</span>
        <span class="n">average_average_matrix_diag_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">elements_basis_functions</span><span class="p">,</span> <span class="n">average_matrix_diagonal_values</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">matrix_diagonal_values</span><span class="p">,</span>
            <span class="n">average_average_matrix_diag_dict</span><span class="p">,</span>
            <span class="n">complex_matrices</span><span class="p">,</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Polarization">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Polarization">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Polarization</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read POLARIZATION.lobster file generated by LOBSTER.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        rel_mulliken_pol_vector (dict[str, float]): Relative Mulliken polarization vector.</span>
<span class="sd">        rel_loewdin_pol_vector (dict[str, float]): Relative Mulliken polarization vector.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;POLARIZATION.lobster&quot;</span><span class="p">,</span>
        <span class="n">rel_mulliken_pol_vector</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rel_loewdin_pol_vector</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The &quot;POLARIZATION.lobster&quot; file.</span>
<span class="sd">            rel_mulliken_pol_vector (dict[str, Union[float, str]]): Relative Mulliken polarization vector.</span>
<span class="sd">            rel_loewdin_pol_vector (dict[str, Union[float, str]]): Relative Loewdin polarization vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_mulliken_pol_vector</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">rel_mulliken_pol_vector</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rel_mulliken_pol_vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_loewdin_pol_vector</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">rel_loewdin_pol_vector</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rel_loewdin_pol_vector</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_loewdin_pol_vector</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_mulliken_pol_vector</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Polarization file contains no data.&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">4</span><span class="p">:]:</span>
                <span class="n">cleanlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">cleanlines</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rel_mulliken_pol_vector</span><span class="p">[</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rel_loewdin_pol_vector</span><span class="p">[</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">cleanlines</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cleanlines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rel_mulliken_pol_vector</span><span class="p">[</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u03bc</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rel_loewdin_pol_vector</span><span class="p">[</span><span class="n">cleanlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cleanlines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\u03bc</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Bwdf">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.outputs.Bwdf">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Bwdf</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read BWDF.lobster/BWDFCOHP.lobster file generated by LOBSTER.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        centers (NDArray): Bond length centers for the distribution.</span>
<span class="sd">        bwdf (dict[Spin, NDArray]): Bond weighted distribution function.</span>
<span class="sd">        bin_width (float): Bin width used for computing the distribution by LOBSTER.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;BWDF.lobster&quot;</span><span class="p">,</span>
        <span class="n">centers</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bwdf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Spin</span><span class="p">,</span> <span class="n">NDArray</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bin_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            filename (PathLike): The &quot;BWDF.lobster&quot; file. Can also read BWDFCOHP.lobster.</span>
<span class="sd">            centers (NDArray): Bond length centers for the distribution.</span>
<span class="sd">            bwdf (dict[Spin, NDArray]): Bond weighted distribution function.</span>
<span class="sd">            bin_width (float): Bin width used for computing the distribution by LOBSTER.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">if</span> <span class="n">centers</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">centers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">bwdf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">bwdf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_width</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="k">if</span> <span class="n">bin_width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">bin_width</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;BWDF file contains no data.&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">clean_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centers</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">clean_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clean_line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">clean_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">clean_line</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">clean_line</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># remove down spin key if not spin polarized calculation</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">bwdf</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">bin_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centers</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.io.lobster.outputs</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>