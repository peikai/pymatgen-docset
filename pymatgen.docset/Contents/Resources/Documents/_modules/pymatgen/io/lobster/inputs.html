<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymatgen.io.lobster.inputs &#8212; pymatgen 2025.1.24 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/basic.css?v=5c69cfe2" />
    <script src="../../../../_static/documentation_options.js?v=d2bc030c"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.io.lobster.inputs</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.io.lobster.inputs</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module for reading LOBSTER input files.</span>
<span class="sd">For more information on LOBSTER see www.cohp.de.</span>

<span class="sd">If you use this module, please cite:</span>
<span class="sd">J. George, G. Petretto, A. Naik, M. Esters, A. J. Jackson, R. Nelson, R. Dronskowski, G.-M. Rignanese, G. Hautier,</span>
<span class="sd">&quot;Automated Bonding Analysis with Crystal Orbital Hamilton Populations&quot;,</span>
<span class="sd">ChemPlusChem 2022, e202200123,</span>
<span class="sd">DOI: 10.1002/cplu.202200123.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">spglib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">zopen</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.json</span><span class="w"> </span><span class="kn">import</span> <span class="n">MSONable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.serialization</span><span class="w"> </span><span class="kn">import</span> <span class="n">loadfn</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.structure</span><span class="w"> </span><span class="kn">import</span> <span class="n">Structure</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.vasp</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vasprun</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.io.vasp.inputs</span><span class="w"> </span><span class="kn">import</span> <span class="n">Incar</span><span class="p">,</span> <span class="n">Kpoints</span><span class="p">,</span> <span class="n">Potcar</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.symmetry.bandstructure</span><span class="w"> </span><span class="kn">import</span> <span class="n">HighSymmKpath</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.due</span><span class="w"> </span><span class="kn">import</span> <span class="n">Doi</span><span class="p">,</span> <span class="n">due</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Literal</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Self</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.composition</span><span class="w"> </span><span class="kn">import</span> <span class="n">Composition</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">PathLike</span><span class="p">,</span> <span class="n">Tuple3Ints</span>

<span class="n">MODULE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Janine George, Marco Esters&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2017, The Materials Project&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.2&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Janine George&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;janinegeorge.ulfen@gmail.com&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;Dec 13, 2017&quot;</span>


<span class="n">due</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span>
    <span class="n">Doi</span><span class="p">(</span><span class="s2">&quot;10.1002/cplu.202200123&quot;</span><span class="p">),</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Automated Bonding Analysis with Crystal Orbital Hamilton Populations&quot;</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="Lobsterin">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Lobsterin</span><span class="p">(</span><span class="n">UserDict</span><span class="p">,</span> <span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle and generate lobsterin files.</span>
<span class="sd">    Furthermore, it can also modify INCAR files for LOBSTER, generate KPOINTS files for fatband calculations in LOBSTER,</span>
<span class="sd">    and generate the standard primitive cells in a POSCAR file that are needed for the fatband calculations.</span>
<span class="sd">    There are also several standard lobsterin files that can be easily generated.</span>

<span class="sd">    Reminder: lobsterin keywords are not case sensitive.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># These keywords need an additional float suffix</span>
    <span class="n">_FLOAT_KEYWORDS</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;COHPstartEnergy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;COHPendEnergy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gaussianSmearingWidth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;useDecimalPlaces&quot;</span><span class="p">,</span>
        <span class="s2">&quot;COHPSteps&quot;</span><span class="p">,</span>
        <span class="s2">&quot;basisRotation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gridDensityForPrinting&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gridBufferForPrinting&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># These keywords need an additional string suffix</span>
    <span class="n">_STRING_KEYWORDS</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;basisSet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cohpGenerator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;realspaceHamiltonian&quot;</span><span class="p">,</span>
        <span class="s2">&quot;realspaceOverlap&quot;</span><span class="p">,</span>
        <span class="s2">&quot;printPAWRealSpaceWavefunction&quot;</span><span class="p">,</span>
        <span class="s2">&quot;printLCAORealSpaceWavefunction&quot;</span><span class="p">,</span>
        <span class="s2">&quot;kSpaceCOHP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EwaldSum&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># The keywords themselves (without suffix) can trigger additional functionalities</span>
    <span class="n">_BOOLEAN_KEYWORDS</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;saveProjectionToFile&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipCar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipdos&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipcohp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipcoop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipcobi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipMOFE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipMolecularOrbitals&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipMadelungEnergy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loadProjectionFromFile&quot;</span><span class="p">,</span>
        <span class="s2">&quot;printTotalSpilling&quot;</span><span class="p">,</span>
        <span class="s2">&quot;forceEnergyRange&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DensityOfEnergy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BWDF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BWDFCOHP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipPopulationAnalysis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipGrossPopulation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;userecommendedbasisfunctions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipProjection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;printLmosOnAtoms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;printMofeAtomWise&quot;</span><span class="p">,</span>
        <span class="s2">&quot;printMofeMoleculeWise&quot;</span><span class="p">,</span>
        <span class="s2">&quot;writeAtomicOrbitals&quot;</span><span class="p">,</span>
        <span class="s2">&quot;writeBasisFunctions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;writeMatricesToFile&quot;</span><span class="p">,</span>
        <span class="s2">&quot;noFFTforVisualization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RMSp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;onlyReadVasprun.xml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;noMemoryMappedFiles&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipPAWOrthonormalityTest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;doNotIgnoreExcessiveBands&quot;</span><span class="p">,</span>
        <span class="s2">&quot;doNotUseAbsoluteSpilling&quot;</span><span class="p">,</span>
        <span class="s2">&quot;skipReOrthonormalization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;forceV1HMatrix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;useOriginalTetrahedronMethod&quot;</span><span class="p">,</span>
        <span class="s2">&quot;forceEnergyRange&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bandwiseSpilling&quot;</span><span class="p">,</span>
        <span class="s2">&quot;kpointwiseSpilling&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LSODOS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;autoRotate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;doNotOrthogonalizeBasis&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># These keywords need additional string suffixes.</span>
    <span class="c1"># They could be used multiple times within one lobsterin.</span>
    <span class="n">_LIST_KEYWORDS</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;basisfunctions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cohpbetween&quot;</span><span class="p">,</span>
        <span class="s2">&quot;createFatband&quot;</span><span class="p">,</span>
        <span class="s2">&quot;customSTOforAtom&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cobiBetween&quot;</span><span class="p">,</span>
        <span class="s2">&quot;printLmosOnAtomswriteAtomicDensities&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Generate {lowered: original} mappings</span>
    <span class="n">FLOAT_KEYWORDS</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_FLOAT_KEYWORDS</span><span class="p">}</span>
    <span class="n">STRING_KEYWORDS</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_STRING_KEYWORDS</span><span class="p">}</span>
    <span class="n">BOOLEAN_KEYWORDS</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_BOOLEAN_KEYWORDS</span><span class="p">}</span>
    <span class="n">LIST_KEYWORDS</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_LIST_KEYWORDS</span><span class="p">}</span>

    <span class="c1"># All known keywords</span>
    <span class="n">AVAILABLE_KEYWORDS</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="n">FLOAT_KEYWORDS</span><span class="p">,</span>
        <span class="o">**</span><span class="n">STRING_KEYWORDS</span><span class="p">,</span>
        <span class="o">**</span><span class="n">BOOLEAN_KEYWORDS</span><span class="p">,</span>
        <span class="o">**</span><span class="n">LIST_KEYWORDS</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settingsdict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            settingsdict: dict to initialize Lobsterin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># Check for duplicates from case sensitivity</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">settingsdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">keys</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;There are duplicates for the keywords!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settingsdict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Necessary due to the missing case sensitivity of lobsterin</span>
<span class="sd">        keywords. Also clean the keys and values by stripping white spaces.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: if keyword is not available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">AVAILABLE_KEYWORDS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is currently not available&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To avoid cases sensitivity problems.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">=}</span><span class="s2"> is not available&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To avoid cases sensitivity problems.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To avoid cases sensitivity problems.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

<div class="viewcode-block" id="Lobsterin.diff">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.diff">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare two Lobsterin and find which parameters are the same.</span>
<span class="sd">        Similar to the diff method of Incar.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (Lobsterin): Lobsterin object to compare to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: {&quot;Same&quot;: same_params, &quot;Different&quot;: diff_params}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">same_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">diff_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Check self</span>
        <span class="k">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">v1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
                <span class="n">diff_params</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lobsterin1&quot;</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="s2">&quot;lobsterin2&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

            <span class="c1"># String keywords</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">v1</span> <span class="o">!=</span> <span class="n">other</span><span class="p">[</span><span class="n">k1</span><span class="p">]:</span>
                    <span class="n">diff_params</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lobsterin1&quot;</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="s2">&quot;lobsterin2&quot;</span><span class="p">:</span> <span class="n">other</span><span class="p">[</span><span class="n">k1</span><span class="p">]}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">same_params</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span>

            <span class="c1"># List keywords</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">new_set1</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">v1</span><span class="p">}</span>
                <span class="n">new_set2</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">other</span><span class="p">[</span><span class="n">k1</span><span class="p">]}</span>
                <span class="k">if</span> <span class="n">new_set1</span> <span class="o">!=</span> <span class="n">new_set2</span><span class="p">:</span>
                    <span class="n">diff_params</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lobsterin1&quot;</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="s2">&quot;lobsterin2&quot;</span><span class="p">:</span> <span class="n">other</span><span class="p">[</span><span class="n">k1</span><span class="p">]}</span>

            <span class="c1"># Float/boolean keywords</span>
            <span class="k">elif</span> <span class="n">v1</span> <span class="o">!=</span> <span class="n">other</span><span class="p">[</span><span class="n">k1</span><span class="p">]:</span>
                <span class="n">diff_params</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lobsterin1&quot;</span><span class="p">:</span> <span class="n">v1</span><span class="p">,</span> <span class="s2">&quot;lobsterin2&quot;</span><span class="p">:</span> <span class="n">other</span><span class="p">[</span><span class="n">k1</span><span class="p">]}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">same_params</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span>

        <span class="c1"># Check other</span>
        <span class="k">for</span> <span class="n">k2</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">k2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">diff_params</span><span class="p">:</span>
                <span class="n">diff_params</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lobsterin1&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;lobsterin2&quot;</span><span class="p">:</span> <span class="n">v2</span><span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Same&quot;</span><span class="p">:</span> <span class="n">same_params</span><span class="p">,</span> <span class="s2">&quot;Different&quot;</span><span class="p">:</span> <span class="n">diff_params</span><span class="p">}</span></div>


<div class="viewcode-block" id="Lobsterin.write_lobsterin">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.write_lobsterin">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_lobsterin</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;lobsterin&quot;</span><span class="p">,</span>
        <span class="n">overwritedict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a lobsterin file, and recover keys to Camel case.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): filename of the output lobsterin file</span>
<span class="sd">            overwritedict (dict): dict that can be used to update lobsterin, e.g. {&quot;skipdos&quot;: True}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update previous entries</span>
        <span class="k">if</span> <span class="n">overwritedict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">overwritedict</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">FLOAT_KEYWORDS</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">STRING_KEYWORDS</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">AVAILABLE_KEYWORDS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">BOOLEAN_KEYWORDS</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">BOOLEAN_KEYWORDS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">LIST_KEYWORDS</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>  <span class="c1"># type: ignore[union-attr]</span>
                        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">LIST_KEYWORDS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Lobsterin.as_dict">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.as_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;MSONable dict.&quot;&quot;&quot;</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;@module&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span>
        <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;@class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="n">dct</span></div>


<div class="viewcode-block" id="Lobsterin.from_dict">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            dct (dict): Dict representation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Lobsterin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;@module&quot;</span><span class="p">,</span> <span class="s2">&quot;@class&quot;</span><span class="p">}})</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_get_nbands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get number of bands.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basisfunctions&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No basis functions are provided. The program cannot calculate nbands.&quot;</span><span class="p">)</span>

        <span class="n">basis_functions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">string_basis</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;basisfunctions&quot;</span><span class="p">]:</span>
            <span class="n">string_basis_raw</span> <span class="o">=</span> <span class="n">string_basis</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">string_basis_raw</span><span class="p">:</span>
                <span class="n">string_basis_raw</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">element_composition</span><span class="p">[</span><span class="n">string_basis_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">]])):</span>
                <span class="n">basis_functions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">string_basis_raw</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="n">num_basis_functions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">basis_functions</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;s&quot;</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                <span class="n">num_basis_functions</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="s2">&quot;p&quot;</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                <span class="n">num_basis_functions</span> <span class="o">+=</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="s2">&quot;d&quot;</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                <span class="n">num_basis_functions</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="k">elif</span> <span class="s2">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                <span class="n">num_basis_functions</span> <span class="o">+=</span> <span class="mi">7</span>

        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_basis_functions</span><span class="p">)</span>

<div class="viewcode-block" id="Lobsterin.write_INCAR">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.write_INCAR">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_INCAR</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">incar_input</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;INCAR&quot;</span><span class="p">,</span>
        <span class="n">incar_output</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;INCAR.lobster&quot;</span><span class="p">,</span>
        <span class="n">poscar_input</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">,</span>
        <span class="n">isym</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">further_settings</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write INCAR file. Will only make the run static, insert NBANDS,</span>
<span class="sd">        set ISYM=0, LWAVE=True and you have to check for the rest.</span>

<span class="sd">        Args:</span>
<span class="sd">            incar_input (PathLike): path to input INCAR</span>
<span class="sd">            incar_output (PathLike): path to output INCAR</span>
<span class="sd">            poscar_input (PathLike): path to input POSCAR</span>
<span class="sd">            isym (-1 | 0): ISYM value.</span>
<span class="sd">            further_settings (dict): A dict can be used to include further settings, e.g. {&quot;ISMEAR&quot;:-5}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Read INCAR from file, which will be modified</span>
        <span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">incar_input</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Please check your incar_input before using it. This method only changes three settings!&quot;</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">isym</span> <span class="ow">in</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">}:</span>
            <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">isym</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="n">isym</span><span class="si">=}</span><span class="s2">, must be -1 or 0&quot;</span><span class="p">)</span>

        <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NSW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LWAVE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Get NBANDS from _get_nbands (use basis set that is inserted)</span>
        <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NBANDS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_nbands</span><span class="p">(</span><span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">poscar_input</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">further_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">further_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">incar</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">incar</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">incar_output</span><span class="p">)</span></div>


<div class="viewcode-block" id="Lobsterin.get_basis">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.get_basis">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_basis</span><span class="p">(</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
        <span class="n">potcar_symbols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">address_basis_file</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the basis functions from given potcar_symbols, e.g., [&quot;Fe_pv&quot;, &quot;Si&quot;].</span>

<span class="sd">        Args:</span>
<span class="sd">            structure (Structure): Structure object</span>
<span class="sd">            potcar_symbols: list of potcar symbols</span>
<span class="sd">            address_basis_file (PathLike): path to the basis file</span>

<span class="sd">        Returns:</span>
<span class="sd">            basis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">address_basis_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">address_basis_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MODULE_DIR</span><span class="si">}</span><span class="s2">/lobster_basis/BASIS_PBE_54_standard.yaml&quot;</span>

        <span class="n">atom_types_potcar</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">potcar_symbols</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">structure</span><span class="o">.</span><span class="n">symbol_set</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">atom_types_potcar</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Your POSCAR does not correspond to your POTCAR!&quot;</span><span class="p">)</span>

        <span class="n">basis</span> <span class="o">=</span> <span class="n">loadfn</span><span class="p">(</span><span class="n">address_basis_file</span><span class="p">)[</span><span class="s2">&quot;BASIS&quot;</span><span class="p">]</span>

        <span class="n">basis_functions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_forin</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">potcar_symbols</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Missing basis information for POTCAR symbol: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. Please provide the basis manually.&quot;</span>
                <span class="p">)</span>
            <span class="n">basis_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basis</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="n">list_forin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">atom_types_potcar</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">basis</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">list_forin</span></div>


<div class="viewcode-block" id="Lobsterin.get_all_possible_basis_functions">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.get_all_possible_basis_functions">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_possible_basis_functions</span><span class="p">(</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
        <span class="n">potcar_symbols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">address_basis_file_min</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">address_basis_file_max</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure: Structure object</span>
<span class="sd">            potcar_symbols: list of the potcar symbols</span>
<span class="sd">            address_basis_file_min: path to file with the minimum required basis by the POTCAR</span>
<span class="sd">            address_basis_file_max: path to file with the largest possible basis of the POTCAR.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict]: Can be used to create new Lobsterin objects in</span>
<span class="sd">                standard_calculations_from_vasp_files as dict_for_basis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_basis</span> <span class="o">=</span> <span class="n">Lobsterin</span><span class="o">.</span><span class="n">get_basis</span><span class="p">(</span>
            <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
            <span class="n">potcar_symbols</span><span class="o">=</span><span class="n">potcar_symbols</span><span class="p">,</span>
            <span class="n">address_basis_file</span><span class="o">=</span><span class="n">address_basis_file_max</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MODULE_DIR</span><span class="si">}</span><span class="s2">/lobster_basis/BASIS_PBE_54_max.yaml&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">min_basis</span> <span class="o">=</span> <span class="n">Lobsterin</span><span class="o">.</span><span class="n">get_basis</span><span class="p">(</span>
            <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
            <span class="n">potcar_symbols</span><span class="o">=</span><span class="n">potcar_symbols</span><span class="p">,</span>
            <span class="n">address_basis_file</span><span class="o">=</span><span class="n">address_basis_file_min</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MODULE_DIR</span><span class="si">}</span><span class="s2">/lobster_basis/BASIS_PBE_54_min.yaml&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">all_basis</span> <span class="o">=</span> <span class="n">get_all_possible_basis_combinations</span><span class="p">(</span><span class="n">min_basis</span><span class="o">=</span><span class="n">min_basis</span><span class="p">,</span> <span class="n">max_basis</span><span class="o">=</span><span class="n">max_basis</span><span class="p">)</span>
        <span class="n">list_basis_dict</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">all_basis</span><span class="p">:</span>
            <span class="n">basis_dict</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">elba</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                <span class="n">basplit</span> <span class="o">=</span> <span class="n">elba</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">basis_dict</span><span class="p">[</span><span class="n">basplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basplit</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">list_basis_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basis_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">list_basis_dict</span></div>


<div class="viewcode-block" id="Lobsterin.write_POSCAR_with_standard_primitive">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.write_POSCAR_with_standard_primitive">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_POSCAR_with_standard_primitive</span><span class="p">(</span>
        <span class="n">POSCAR_input</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">,</span>
        <span class="n">POSCAR_output</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;POSCAR.lobster&quot;</span><span class="p">,</span>
        <span class="n">symprec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a POSCAR with the standard primitive cell.</span>
<span class="sd">        This is needed to arrive at the correct kpath.</span>

<span class="sd">        Args:</span>
<span class="sd">            POSCAR_input (PathLike): Input POSCAR file</span>
<span class="sd">            POSCAR_output (PathLike): Output POSCAR file</span>
<span class="sd">            symprec (float): precision to find symmetry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">POSCAR_input</span><span class="p">)</span>
        <span class="n">kpath</span> <span class="o">=</span> <span class="n">HighSymmKpath</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">symprec</span><span class="o">=</span><span class="n">symprec</span><span class="p">)</span>
        <span class="n">new_structure</span> <span class="o">=</span> <span class="n">kpath</span><span class="o">.</span><span class="n">prim</span>
        <span class="n">new_structure</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;POSCAR&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">POSCAR_output</span><span class="p">)</span></div>


<div class="viewcode-block" id="Lobsterin.write_KPOINTS">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.write_KPOINTS">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_KPOINTS</span><span class="p">(</span>
        <span class="n">POSCAR_input</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">,</span>
        <span class="n">KPOINTS_output</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;KPOINTS.lobster&quot;</span><span class="p">,</span>
        <span class="n">reciprocal_density</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">isym</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">from_grid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">input_grid</span><span class="p">:</span> <span class="n">Tuple3Ints</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="n">line_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">kpoints_line_density</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">symprec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a gamma-centered KPOINTS file for LOBSTER.</span>

<span class="sd">        Args:</span>
<span class="sd">            POSCAR_input (PathLike): path to POSCAR</span>
<span class="sd">            KPOINTS_output (PathLike): path to output KPOINTS</span>
<span class="sd">            reciprocal_density (int): Grid density</span>
<span class="sd">            isym (-1 | 0): ISYM value.</span>
<span class="sd">            from_grid (bool): If True KPOINTS will be generated with the help of a grid given in input_grid.</span>
<span class="sd">                Otherwise, they will be generated from the reciprocal_density</span>
<span class="sd">            input_grid (tuple): grid to generate the KPOINTS file</span>
<span class="sd">            line_mode (bool): If True, band structure will be generated</span>
<span class="sd">            kpoints_line_density (int): density of the lines in the band structure</span>
<span class="sd">            symprec (float): precision to determine symmetry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">POSCAR_input</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_grid</span><span class="p">:</span>
            <span class="n">kpoint_grid</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="o">.</span><span class="n">automatic_density_by_vol</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">reciprocal_density</span><span class="p">)</span><span class="o">.</span><span class="n">kpts</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">kpoint_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mesh</span> <span class="o">=</span> <span class="n">input_grid</span>

        <span class="c1"># The following code is taken from SpacegroupAnalyzer</span>
        <span class="c1"># We need to switch off symmetry here</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">frac_coords</span>
        <span class="n">unique_species</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Composition</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">magmoms</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">species</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">unique_species</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">unique_species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
                <span class="n">zs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">group</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unique_species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
                <span class="n">zs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_species</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">group</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="s2">&quot;magmom&quot;</span><span class="p">):</span>
                <span class="n">magmoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">magmom</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">site</span><span class="o">.</span><span class="n">is_ordered</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">,</span> <span class="s2">&quot;spin&quot;</span><span class="p">):</span>
                <span class="n">magmoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">magmoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># For now, we are setting MAGMOM to zero. (Taken from INCAR class)</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">magmoms</span>
        <span class="c1"># TODO: what about this shift?</span>
        <span class="n">mapping</span><span class="p">,</span> <span class="n">grid</span> <span class="o">=</span> <span class="n">spglib</span><span class="o">.</span><span class="n">get_ir_reciprocal_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">is_shift</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Get the KPOINTS for the grid</span>
        <span class="k">if</span> <span class="n">isym</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">kpts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">gp</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">:</span>
                <span class="n">kpts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="n">mesh</span><span class="p">)</span>
                <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">all_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Time reversal symmetry: k and -k are equivalent</span>
        <span class="k">elif</span> <span class="n">isym</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kpts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">newlist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span> <span class="k">for</span> <span class="n">gp</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">grid</span><span class="p">)]</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">gp</span> <span class="ow">in</span> <span class="n">newlist</span><span class="p">:</span>
                <span class="n">minus_gp</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gp</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">minus_gp</span> <span class="ow">in</span> <span class="n">newlist</span> <span class="ow">and</span> <span class="n">minus_gp</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>
                    <span class="n">mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newlist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">minus_gp</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newlist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">gp</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">igp</span><span class="p">,</span> <span class="n">gp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">newlist</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mapping</span><span class="p">[</span><span class="n">igp</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">igp</span><span class="p">:</span>
                    <span class="n">kpts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="n">mesh</span><span class="p">)</span>
                    <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    <span class="n">all_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mapping</span><span class="p">[</span><span class="n">igp</span><span class="p">]</span> <span class="o">==</span> <span class="n">igp</span><span class="p">:</span>
                    <span class="n">kpts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="n">mesh</span><span class="p">)</span>
                    <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">all_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="n">isym</span><span class="si">=}</span><span class="s2">, must be -1 or 0&quot;</span><span class="p">)</span>

        <span class="c1"># Line mode</span>
        <span class="k">if</span> <span class="n">line_mode</span><span class="p">:</span>
            <span class="n">kpath</span> <span class="o">=</span> <span class="n">HighSymmKpath</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">symprec</span><span class="o">=</span><span class="n">symprec</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">kpath</span><span class="o">.</span><span class="n">prim</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span> <span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">matrix</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;You are not using the standard primitive cell. The k-path is not correct. Please generate a &quot;</span>
                    <span class="s2">&quot;standard primitive cell first.&quot;</span>
                <span class="p">)</span>

            <span class="n">frac_k_points</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">kpath</span><span class="o">.</span><span class="n">get_kpoints</span><span class="p">(</span><span class="n">line_density</span><span class="o">=</span><span class="n">kpoints_line_density</span><span class="p">,</span> <span class="n">coords_are_cartesian</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frac_k_points</span><span class="p">):</span>
                <span class="n">kpts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">all_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">isym</span><span class="si">=}</span><span class="s2">, grid: </span><span class="si">{</span><span class="n">mesh</span><span class="si">}</span><span class="s2"> plus kpoint path&quot;</span> <span class="k">if</span> <span class="n">line_mode</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">isym</span><span class="si">=}</span><span class="s2">, grid: </span><span class="si">{</span><span class="n">mesh</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">kpoints_instance</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="p">(</span>
            <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">Kpoints</span><span class="o">.</span><span class="n">supported_modes</span><span class="o">.</span><span class="n">Reciprocal</span><span class="p">,</span>
            <span class="n">num_kpts</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">kpts</span><span class="p">),</span>
            <span class="n">kpts</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">kpts</span><span class="p">),</span>
            <span class="n">kpts_weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">all_labels</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">kpoints_instance</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">KPOINTS_output</span><span class="p">)</span></div>


<div class="viewcode-block" id="Lobsterin.from_file">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.from_file">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">lobsterin</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create Lobsterin from lobsterin file.</span>

<span class="sd">        Args:</span>
<span class="sd">            lobsterin (PathLike): path to lobsterin.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Lobsterin object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">lobsterin</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;lobsterin file contains no data.&quot;</span><span class="p">)</span>

        <span class="n">lobsterin_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="c1"># Remove comment lines and in-line comments</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[!#//]&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="c1"># Extract keywords</span>
                <span class="n">line_parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line_parts</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">line_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Avoid duplicates for float/string keywords</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">FLOAT_KEYWORDS</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">STRING_KEYWORDS</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">lobsterin_dict</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Same keyword </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> twice!&quot;</span><span class="p">)</span>

                <span class="c1"># Parse by keyword type</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">BOOLEAN_KEYWORDS</span><span class="p">:</span>
                    <span class="n">lobsterin_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">FLOAT_KEYWORDS</span><span class="p">:</span>
                    <span class="n">lobsterin_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">STRING_KEYWORDS</span><span class="p">:</span>
                    <span class="n">lobsterin_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">LIST_KEYWORDS</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">lobsterin_dict</span><span class="p">:</span>
                        <span class="n">lobsterin_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lobsterin_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid </span><span class="si">{</span><span class="n">key</span><span class="si">=}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">lobsterin_dict</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_potcar_symbols</span><span class="p">(</span><span class="n">POTCAR_input</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the name of the species in the POTCAR.</span>

<span class="sd">        Args:</span>
<span class="sd">            POTCAR_input (PathLike): path to potcar file</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: names of the species</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">potcar</span> <span class="o">=</span> <span class="n">Potcar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">POTCAR_input</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pot</span> <span class="ow">in</span> <span class="n">potcar</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pot</span><span class="o">.</span><span class="n">potential_type</span> <span class="o">!=</span> <span class="s2">&quot;PAW&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lobster only works with PAW! Use different POTCARs&quot;</span><span class="p">)</span>

        <span class="c1"># Warning about a bug in LOBSTER-4.1.0</span>
        <span class="k">with</span> <span class="n">zopen</span><span class="p">(</span><span class="n">POTCAR_input</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;SHA256&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="s2">&quot;COPYR&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;These POTCARs are not compatible with &quot;</span>
                <span class="s2">&quot;Lobster up to version 4.1.0.&quot;</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> The keywords SHA256 and COPYR &quot;</span>
                <span class="s2">&quot;cannot be handled by Lobster&quot;</span>
                <span class="s2">&quot; </span><span class="se">\n</span><span class="s2"> and will lead to wrong results.&quot;</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">potcar</span><span class="o">.</span><span class="n">functional</span> <span class="o">!=</span> <span class="s2">&quot;PBE&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;We only have BASIS options for PBE so far&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="s2">&quot;symbol&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">potcar</span><span class="o">.</span><span class="n">spec</span><span class="p">]</span>

<div class="viewcode-block" id="Lobsterin.standard_calculations_from_vasp_files">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.Lobsterin.standard_calculations_from_vasp_files">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">standard_calculations_from_vasp_files</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">POSCAR_input</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">,</span>
        <span class="n">INCAR_input</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;INCAR&quot;</span><span class="p">,</span>
        <span class="n">POTCAR_input</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">Vasprun_output</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">=</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">,</span>
        <span class="n">dict_for_basis</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">option</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;standard&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate lobsterin with standard settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            POSCAR_input (PathLike): path to POSCAR</span>
<span class="sd">            INCAR_input (PathLike): path to INCAR</span>
<span class="sd">            POTCAR_input (PathLike): path to POTCAR</span>
<span class="sd">            Vasprun_output (PathLike): path to vasprun.xml</span>
<span class="sd">            dict_for_basis (dict): can be provided: it should look the following:</span>
<span class="sd">                dict_for_basis={&quot;Fe&quot;:&#39;3p 3d 4s 4f&#39;, &quot;C&quot;: &#39;2s 2p&#39;} and will overwrite all settings from POTCAR_input</span>
<span class="sd">            option (str): &#39;standard&#39; will start a normal LOBSTER run where COHPs, COOPs, DOS, CHARGE etc. will be</span>
<span class="sd">                calculated</span>
<span class="sd">                &#39;standard_with_energy_range_from_vasprun&#39; will start a normal LOBSTER run for entire energy range</span>
<span class="sd">                of VASP static run. vasprun.xml file needs to be in current directory.</span>
<span class="sd">                &#39;standard_from_projection&#39; will start a normal LOBSTER run from a projection</span>
<span class="sd">                &#39;standard_with_fatband&#39; will do a fatband calculation, run over all orbitals</span>
<span class="sd">                &#39;onlyprojection&#39; will only do a projection</span>
<span class="sd">                &#39;onlydos&#39; will only calculate a projected dos</span>
<span class="sd">                &#39;onlycohp&#39; will only calculate cohp</span>
<span class="sd">                &#39;onlycoop&#39; will only calculate coop</span>
<span class="sd">                &#39;onlycohpcoop&#39; will only calculate cohp and coop</span>

<span class="sd">        Returns:</span>
<span class="sd">            Lobsterin with standard settings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Always check and test the provided basis functions. The spilling of your Lobster calculation might help&quot;</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">option</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="s2">&quot;standard&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_from_projection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_with_fatband&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_with_energy_range_from_vasprun&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlyprojection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlydos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlycohp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlycoop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlycobi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlycohpcoop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlycohpcoopcobi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlymadelung&quot;</span><span class="p">,</span>
        <span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The option is not valid!&quot;</span><span class="p">)</span>

        <span class="n">lobsterin_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># This basis set covers elements up to Lr (Z = 103)</span>
            <span class="s2">&quot;basisSet&quot;</span><span class="p">:</span> <span class="s2">&quot;pbeVaspFit2015&quot;</span><span class="p">,</span>
            <span class="c1"># Energies around e-fermi</span>
            <span class="s2">&quot;COHPstartEnergy&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">35.0</span><span class="p">,</span>
            <span class="s2">&quot;COHPendEnergy&quot;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">option</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="s2">&quot;standard&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_with_energy_range_from_vasprun&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlycohp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlycoop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlycobi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlycohpcoop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;onlycohpcoopcobi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;standard_with_fatband&quot;</span><span class="p">,</span>
        <span class="p">}:</span>
            <span class="c1"># Every interaction with a distance of 6.0 Å is checked</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;cohpGenerator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;from 0.1 to 6.0 orbitalwise&quot;</span>
            <span class="c1"># Save the projection</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;saveProjectionToFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;standard_from_projection&quot;</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;cohpGenerator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;from 0.1 to 6.0 orbitalwise&quot;</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;loadProjectionFromFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;standard_with_energy_range_from_vasprun&quot;</span><span class="p">:</span>
            <span class="n">vasp_run</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span><span class="n">Vasprun_output</span><span class="p">)</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;COHPstartEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">vasp_run</span><span class="o">.</span><span class="n">complete_dos</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">vasp_run</span><span class="o">.</span><span class="n">complete_dos</span><span class="o">.</span><span class="n">efermi</span><span class="p">),</span> <span class="mi">4</span>
            <span class="p">)</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;COHPendEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
                <span class="nb">max</span><span class="p">(</span><span class="n">vasp_run</span><span class="o">.</span><span class="n">complete_dos</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span> <span class="n">vasp_run</span><span class="o">.</span><span class="n">complete_dos</span><span class="o">.</span><span class="n">efermi</span><span class="p">),</span> <span class="mi">4</span>
            <span class="p">)</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;COHPSteps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vasp_run</span><span class="o">.</span><span class="n">complete_dos</span><span class="o">.</span><span class="n">energies</span><span class="p">)</span>

        <span class="c1"># TODO: add COBI here! might be relevant LOBSTER version</span>
        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;onlycohp&quot;</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipdos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcoop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipPopulationAnalysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipGrossPopulation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># LOBSTER-4.1.0</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcobi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipMadelungEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;onlycoop&quot;</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipdos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcohp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipPopulationAnalysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipGrossPopulation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># LOBSTER-4.1.0</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcobi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipMadelungEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;onlycohpcoop&quot;</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipdos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipPopulationAnalysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipGrossPopulation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># LOBSTER-4.1.0</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcobi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipMadelungEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;onlycohpcoopcobi&quot;</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipdos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipPopulationAnalysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipGrossPopulation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipMadelungEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;onlydos&quot;</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcohp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcoop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipPopulationAnalysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipGrossPopulation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># LOBSTER-4.1.0</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcobi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipMadelungEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;onlyprojection&quot;</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipdos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcohp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcoop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipPopulationAnalysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipGrossPopulation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;saveProjectionToFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># LOBSTER-4.1.0</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcobi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipMadelungEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;onlycobi&quot;</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipdos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcohp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipPopulationAnalysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipGrossPopulation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># LOBSTER-4.1.0</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcobi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipMadelungEnergy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;onlymadelung&quot;</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipdos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcohp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcoop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipPopulationAnalysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipGrossPopulation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;saveProjectionToFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># LOBSTER-4.1.0</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;skipcobi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">INCAR_input</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;gaussianSmearingWidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;SIGMA&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;standard_with_fatband&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ISMEAR has to be 0 for a fatband calculation with Lobster&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dict_for_basis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># dict_for_basis = {&quot;Fe&quot;:&quot;3p 3d 4s 4f&quot;, &quot;C&quot;: &quot;2s 2p&quot;}</span>
            <span class="c1"># Will just insert this basis and not check with poscar</span>
            <span class="n">basis</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dict_for_basis</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">elif</span> <span class="n">POTCAR_input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Get basis functions from POTCAR</span>
            <span class="n">potcar_names</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_potcar_symbols</span><span class="p">(</span><span class="n">POTCAR_input</span><span class="o">=</span><span class="n">POTCAR_input</span><span class="p">)</span>

            <span class="n">basis</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_basis</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">POSCAR_input</span><span class="p">),</span> <span class="n">potcar_symbols</span><span class="o">=</span><span class="n">potcar_names</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;basis cannot be generated&quot;</span><span class="p">)</span>

        <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;basisfunctions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">basis</span>

        <span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s2">&quot;standard_with_fatband&quot;</span><span class="p">:</span>
            <span class="n">lobsterin_dict</span><span class="p">[</span><span class="s2">&quot;createFatband&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">basis</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">lobsterin_dict</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="get_all_possible_basis_combinations">
<a class="viewcode-back" href="../../../../pymatgen.io.lobster.html#pymatgen.io.lobster.inputs.get_all_possible_basis_combinations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_all_possible_basis_combinations</span><span class="p">(</span><span class="n">min_basis</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">max_basis</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all possible basis combinations.</span>

<span class="sd">    Args:</span>
<span class="sd">        min_basis: list of basis entries: e.g., [&quot;Si 3p 3s&quot;]</span>
<span class="sd">        max_basis: list of basis entries: e.g., [&quot;Si 3p 3s&quot;].</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[list[str]]: all possible combinations of basis functions, e.g. [[&quot;Si 3p 3s&quot;]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_basis_lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">max_basis</span><span class="p">]</span>
    <span class="n">min_basis_lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">min_basis</span><span class="p">]</span>

    <span class="c1"># Get all possible basis functions</span>
    <span class="n">basis_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">iel</span><span class="p">,</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">max_basis_lists</span><span class="p">):</span>
        <span class="n">basis_dict</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fixed&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;combinations&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">for</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">min_basis_lists</span><span class="p">[</span><span class="n">iel</span><span class="p">]:</span>
                <span class="n">basis_dict</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;fixed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">basis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">min_basis_lists</span><span class="p">[</span><span class="n">iel</span><span class="p">]:</span>
                <span class="n">basis_dict</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">basis_dict</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;variable&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">basis_dict</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;variable&quot;</span><span class="p">],</span> <span class="n">L</span><span class="p">):</span>
                <span class="n">basis_dict</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;combinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">basis_dict</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;fixed&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset</span><span class="p">)))</span>

    <span class="n">list_basis</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;combinations&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">basis_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

    <span class="c1"># Get all combinations</span>
    <span class="n">start_basis</span> <span class="o">=</span> <span class="n">list_basis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_basis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">list_basis</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">new_start_basis</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">elbasis</span> <span class="ow">in</span> <span class="n">start_basis</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">elbasis2</span> <span class="ow">in</span> <span class="n">el</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elbasis</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">new_start_basis</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">elbasis</span><span class="p">,</span> <span class="n">elbasis2</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_start_basis</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">*</span><span class="n">elbasis</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">elbasis2</span><span class="p">])</span>
            <span class="n">start_basis</span> <span class="o">=</span> <span class="n">new_start_basis</span>
        <span class="k">return</span> <span class="n">start_basis</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">basis</span><span class="p">]</span> <span class="k">for</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">start_basis</span><span class="p">]</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.io.lobster.inputs</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>