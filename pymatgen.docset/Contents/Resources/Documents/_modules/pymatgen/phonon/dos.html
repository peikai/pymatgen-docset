<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymatgen.phonon.dos &#8212; pymatgen 2025.1.24 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=5c69cfe2" />
    <script src="../../../_static/documentation_options.js?v=d2bc030c"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.phonon.dos</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for pymatgen.phonon.dos</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;This module defines classes to represent the phonon density of states.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">NamedTuple</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.constants</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">const</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lazy_property</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">monty.json</span><span class="w"> </span><span class="kn">import</span> <span class="n">MSONable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">gaussian_filter1d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">wasserstein_distance</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.core.structure</span><span class="w"> </span><span class="kn">import</span> <span class="n">Structure</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pymatgen.util.coord</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_linear_interpolated_value</span>

<span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;2.0.0&quot;</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span>  <span class="c1"># noqa: NPY201</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NDArray</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Self</span>

<span class="n">BOLTZ_THZ_PER_K</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Boltzmann constant in Hz/K&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">tera</span>  <span class="c1"># Boltzmann constant in THz/K</span>
<span class="n">THZ_TO_J</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;hertz-joule relationship&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">tera</span>


<div class="viewcode-block" id="PhononDos">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PhononDos</span><span class="p">(</span><span class="n">MSONable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic DOS object. All other DOS objects are extended versions of this object.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">densities</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            frequencies: A sequence of frequencies in THz</span>
<span class="sd">            densities: A sequence representing the density of states.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span>

<div class="viewcode-block" id="PhononDos.get_smeared_densities">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.get_smeared_densities">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_smeared_densities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the densities, but with a Gaussian smearing of</span>
<span class="sd">        std dev sigma applied.</span>

<span class="sd">        Args:</span>
<span class="sd">            sigma: Std dev of Gaussian smearing function. In units of</span>
<span class="sd">                THz. Common values are 0.01 - 0.1 THz.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array: Gaussian-smeared DOS densities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sigma</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">avg_diff</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">avg_diff</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">PhononDos</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PhononDos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add two DOS together. Pads densities with zeros to make frequencies matching.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Another DOS object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sum of the two DOSs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">PhononDos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="o">+</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Frequencies of both DOS are not compatible!&quot;</span><span class="p">)</span>
        <span class="n">densities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">densities</span>
        <span class="k">return</span> <span class="n">PhononDos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">PhononDos</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PhononDos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subtracts two DOS together. Pads densities with zeros to make frequencies matching.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Another DOS object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Difference of the two DOSs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PhononDos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Multiplies the DOS by a scalar.</span>

<span class="sd">        Args:</span>
<span class="sd">            scalar: A scalar to multiply by.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new DOS multiplied by a scalar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PhononDos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="o">*</span> <span class="n">scalar</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PhononDos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inverts the DOS.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new DOS with densities inverted. Useful for subtracting from a total DOS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PhononDos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>

    <span class="fm">__radd__</span> <span class="o">=</span> <span class="fm">__add__</span>
    <span class="fm">__rmul__</span> <span class="o">=</span> <span class="fm">__mul__</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Two DOS are equal if their densities are equal.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Another DOS object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if densities are equal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">PhononDos</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">frequencies</span><span class="p">,</span> <span class="n">densities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">n_positive_freqs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_positive_frequencies</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">frequencies</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">densities</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">n_positive_freqs</span><span class="si">=}</span><span class="s2">)&quot;</span>

<div class="viewcode-block" id="PhononDos.get_interpolated_value">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.get_interpolated_value">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_interpolated_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get interpolated density for a particular frequency.</span>

<span class="sd">        Args:</span>
<span class="sd">            frequency: frequency to return the density for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_linear_interpolated_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a string which can be easily plotted (using gnuplot).&quot;&quot;&quot;</span>
        <span class="n">str_arr</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="s1">&#39;Frequency&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Density&#39;</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">):</span>
            <span class="n">str_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_arr</span><span class="p">)</span>

<div class="viewcode-block" id="PhononDos.from_dict">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get PhononDos object from dict representation of PhononDos.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;frequencies&quot;</span><span class="p">],</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;densities&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="PhononDos.as_dict">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.as_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;JSON-serializable dict representation of PhononDos.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
            <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
            <span class="s2">&quot;densities&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">),</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="PhononDos.ind_zero_freq">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.ind_zero_freq">[docs]</a>
    <span class="nd">@lazy_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ind_zero_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Index of the first point for which the frequencies are &gt;= 0.&quot;&quot;&quot;</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No positive frequencies found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ind</span></div>


    <span class="nd">@lazy_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_positive_frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Numpy array containing the list of positive frequencies.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ind_zero_freq</span> <span class="p">:]</span>

    <span class="nd">@lazy_property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_positive_densities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Numpy array containing the list of densities corresponding to positive frequencies.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ind_zero_freq</span> <span class="p">:]</span>

<div class="viewcode-block" id="PhononDos.cv">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.cv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constant volume specific heat C_v at temperature T obtained from the integration of the DOS.</span>
<span class="sd">        Only positive frequencies will be used.</span>
<span class="sd">        Result in J/(K*mol-c). A mol-c is the abbreviation of a mole-cell, that is, the number</span>
<span class="sd">        of Avogadro times the atoms in a unit cell. To compare with experimental data the result</span>
<span class="sd">        should be divided by the number of unit formulas in the cell. If the structure is provided</span>
<span class="sd">        the division is performed internally and the result is in J/(K*mol).</span>

<span class="sd">        Args:</span>
<span class="sd">            temp: a temperature in K</span>
<span class="sd">            structure: the structure of the system. If not None it will be used to determine the number of</span>
<span class="sd">                formula units</span>
<span class="sd">            **kwargs: allows passing in deprecated t parameter for temp</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Constant volume specific heat C_v</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positive_frequencies</span>
        <span class="n">dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positive_densities</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">csch2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">wd2kt</span> <span class="o">=</span> <span class="n">freqs</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">BOLTZ_THZ_PER_K</span> <span class="o">*</span> <span class="n">temp</span><span class="p">)</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">wd2kt</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">csch2</span><span class="p">(</span><span class="n">wd2kt</span><span class="p">)</span> <span class="o">*</span> <span class="n">dens</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">freqs</span><span class="p">)</span>
        <span class="n">cv</span> <span class="o">*=</span> <span class="n">const</span><span class="o">.</span><span class="n">Boltzmann</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Avogadro</span>

        <span class="k">if</span> <span class="n">structure</span><span class="p">:</span>
            <span class="n">formula_units</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">/</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">reduced_composition</span><span class="o">.</span><span class="n">num_atoms</span>
            <span class="n">cv</span> <span class="o">/=</span> <span class="n">formula_units</span>

        <span class="k">return</span> <span class="n">cv</span></div>


<div class="viewcode-block" id="PhononDos.entropy">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.entropy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vibrational entropy at temperature T obtained from the integration of the DOS.</span>
<span class="sd">        Only positive frequencies will be used.</span>
<span class="sd">        Result in J/(K*mol-c). A mol-c is the abbreviation of a mole-cell, that is, the number</span>
<span class="sd">        of Avogadro times the atoms in a unit cell. To compare with experimental data the result</span>
<span class="sd">        should be divided by the number of unit formulas in the cell. If the structure is provided</span>
<span class="sd">        the division is performed internally and the result is in J/(K*mol).</span>

<span class="sd">        Args:</span>
<span class="sd">            temp: a temperature in K</span>
<span class="sd">            structure: the structure of the system. If not None it will be used to determine the number of</span>
<span class="sd">                formula units</span>
<span class="sd">            **kwargs: allows passing in deprecated t parameter for temp</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Vibrational entropy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positive_frequencies</span>
        <span class="n">dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positive_densities</span>

        <span class="n">wd2kt</span> <span class="o">=</span> <span class="n">freqs</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">BOLTZ_THZ_PER_K</span> <span class="o">*</span> <span class="n">temp</span><span class="p">)</span>
        <span class="n">entropy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">((</span><span class="n">wd2kt</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">wd2kt</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">wd2kt</span><span class="p">)))</span> <span class="o">*</span> <span class="n">dens</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">freqs</span><span class="p">)</span>

        <span class="n">entropy</span> <span class="o">*=</span> <span class="n">const</span><span class="o">.</span><span class="n">Boltzmann</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Avogadro</span>

        <span class="k">if</span> <span class="n">structure</span><span class="p">:</span>
            <span class="n">formula_units</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">/</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">reduced_composition</span><span class="o">.</span><span class="n">num_atoms</span>
            <span class="n">entropy</span> <span class="o">/=</span> <span class="n">formula_units</span>

        <span class="k">return</span> <span class="n">entropy</span></div>


<div class="viewcode-block" id="PhononDos.internal_energy">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.internal_energy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">internal_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Phonon contribution to the internal energy at temperature T obtained from the integration of the DOS.</span>
<span class="sd">        Only positive frequencies will be used.</span>
<span class="sd">        Result in J/mol-c. A mol-c is the abbreviation of a mole-cell, that is, the number</span>
<span class="sd">        of Avogadro times the atoms in a unit cell. To compare with experimental data the result</span>
<span class="sd">        should be divided by the number of unit formulas in the cell. If the structure is provided</span>
<span class="sd">        the division is performed internally and the result is in J/mol.</span>

<span class="sd">        Args:</span>
<span class="sd">            temp: a temperature in K</span>
<span class="sd">            structure: the structure of the system. If not None it will be used to determine the number of</span>
<span class="sd">                formula units</span>
<span class="sd">            **kwargs: allows passing in deprecated t parameter for temp</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Phonon contribution to the internal energy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_point_energy</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>

        <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positive_frequencies</span>
        <span class="n">dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positive_densities</span>

        <span class="n">wd2kt</span> <span class="o">=</span> <span class="n">freqs</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">BOLTZ_THZ_PER_K</span> <span class="o">*</span> <span class="n">temp</span><span class="p">)</span>
        <span class="n">e_phonon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">freqs</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">wd2kt</span><span class="p">)</span> <span class="o">*</span> <span class="n">dens</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">freqs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">e_phonon</span> <span class="o">*=</span> <span class="n">THZ_TO_J</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Avogadro</span>

        <span class="k">if</span> <span class="n">structure</span><span class="p">:</span>
            <span class="n">formula_units</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">/</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">reduced_composition</span><span class="o">.</span><span class="n">num_atoms</span>
            <span class="n">e_phonon</span> <span class="o">/=</span> <span class="n">formula_units</span>

        <span class="k">return</span> <span class="n">e_phonon</span></div>


<div class="viewcode-block" id="PhononDos.helmholtz_free_energy">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.helmholtz_free_energy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">helmholtz_free_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Phonon contribution to the Helmholtz free energy at temperature T obtained from the integration of the DOS.</span>
<span class="sd">        Only positive frequencies will be used.</span>
<span class="sd">        Result in J/mol-c. A mol-c is the abbreviation of a mole-cell, that is, the number</span>
<span class="sd">        of Avogadro times the atoms in a unit cell. To compare with experimental data the result</span>
<span class="sd">        should be divided by the number of unit formulas in the cell. If the structure is provided</span>
<span class="sd">        the division is performed internally and the result is in J/mol.</span>

<span class="sd">        Args:</span>
<span class="sd">            temp: a temperature in K</span>
<span class="sd">            structure: the structure of the system. If not None it will be used to determine the number of</span>
<span class="sd">                formula units</span>
<span class="sd">            **kwargs: allows passing in deprecated t parameter for temp</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Phonon contribution to the Helmholtz free energy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_point_energy</span><span class="p">(</span><span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>

        <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positive_frequencies</span>
        <span class="n">dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positive_densities</span>

        <span class="n">wd2kt</span> <span class="o">=</span> <span class="n">freqs</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">BOLTZ_THZ_PER_K</span> <span class="o">*</span> <span class="n">temp</span><span class="p">)</span>
        <span class="n">e_free</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">wd2kt</span><span class="p">))</span> <span class="o">*</span> <span class="n">dens</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">freqs</span><span class="p">)</span>

        <span class="n">e_free</span> <span class="o">*=</span> <span class="n">const</span><span class="o">.</span><span class="n">Boltzmann</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Avogadro</span> <span class="o">*</span> <span class="n">temp</span>

        <span class="k">if</span> <span class="n">structure</span><span class="p">:</span>
            <span class="n">formula_units</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">/</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">reduced_composition</span><span class="o">.</span><span class="n">num_atoms</span>
            <span class="n">e_free</span> <span class="o">/=</span> <span class="n">formula_units</span>

        <span class="k">return</span> <span class="n">e_free</span></div>


<div class="viewcode-block" id="PhononDos.zero_point_energy">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.zero_point_energy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">zero_point_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Zero point energy of the system. Only positive frequencies will be used.</span>
<span class="sd">        Result in J/mol-c. A mol-c is the abbreviation of a mole-cell, that is, the number</span>
<span class="sd">        of Avogadro times the atoms in a unit cell. To compare with experimental data the result</span>
<span class="sd">        should be divided by the number of unit formulas in the cell. If the structure is provided</span>
<span class="sd">        the division is performed internally and the result is in J/mol.</span>

<span class="sd">        Args:</span>
<span class="sd">            structure: the structure of the system. If not None it will be used to determine the number of</span>
<span class="sd">                formula units</span>

<span class="sd">        Returns:</span>
<span class="sd">            Phonon contribution to the internal energy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positive_frequencies</span>
        <span class="n">dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positive_densities</span>

        <span class="n">zpe</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">trapezoid</span><span class="p">(</span><span class="n">freqs</span> <span class="o">*</span> <span class="n">dens</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">freqs</span><span class="p">)</span>
        <span class="n">zpe</span> <span class="o">*=</span> <span class="n">THZ_TO_J</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">Avogadro</span>

        <span class="k">if</span> <span class="n">structure</span><span class="p">:</span>
            <span class="n">formula_units</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">/</span> <span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">reduced_composition</span><span class="o">.</span><span class="n">num_atoms</span>
            <span class="n">zpe</span> <span class="o">/=</span> <span class="n">formula_units</span>

        <span class="k">return</span> <span class="n">zpe</span></div>


<div class="viewcode-block" id="PhononDos.mae">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.mae">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">mae</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">PhononDos</span><span class="p">,</span> <span class="n">two_sided</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mean absolute error between two DOSs.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (PhononDos): Another phonon DOS</span>
<span class="sd">            two_sided (bool): Whether to calculate the two-sided MAE meaning interpolate each DOS to the</span>
<span class="sd">                other&#39;s frequencies and averaging the two MAEs. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Mean absolute error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Interpolate other.densities to align with self.frequencies</span>
        <span class="n">self_interpolated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>
        <span class="n">self_mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="o">-</span> <span class="n">self_interpolated</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">two_sided</span><span class="p">:</span>
            <span class="n">other_interpolated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>
            <span class="n">other_mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">densities</span> <span class="o">-</span> <span class="n">other_interpolated</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">self_mae</span> <span class="o">+</span> <span class="n">other_mae</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">self_mae</span></div>


<div class="viewcode-block" id="PhononDos.r2_score">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.r2_score">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">r2_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">PhononDos</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;R^2 score between two DOSs.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (PhononDos): Another phonon DOS</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: R^2 score</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">var</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">mse</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mse</span> <span class="o">/</span> <span class="n">var</span></div>


<div class="viewcode-block" id="PhononDos.get_last_peak">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.get_last_peak">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_last_peak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the last peak in the phonon DOS defined as the highest frequency with a DOS</span>
<span class="sd">        value at least threshold * height of the overall highest DOS peak.</span>
<span class="sd">        A peak is any local maximum of the DOS as a function of frequency.</span>
<span class="sd">        Use dos.get_interpolated_value(peak_freq) to get density at peak_freq.</span>

<span class="sd">        TODO method added by @janosh on 2023-12-18. seems to work in most cases but</span>
<span class="sd">        was not extensively tested. PRs with improvements welcome!</span>

<span class="sd">        Args:</span>
<span class="sd">            threshold (float, optional): Minimum ratio of the height of the last peak</span>
<span class="sd">                to the height of the highest peak. Defaults to 0.05 = 5%. In case no peaks</span>
<span class="sd">                are high enough to match, the threshold is reset to half the height of the</span>
<span class="sd">                second-highest peak.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: last DOS peak frequency (in THz)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">first_deriv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span>
        <span class="n">second_deriv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">first_deriv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span>

        <span class="n">maxima</span> <span class="o">=</span> <span class="p">(</span>  <span class="c1"># maxima indices of the first DOS derivative w.r.t. frequency</span>
            <span class="p">(</span><span class="n">first_deriv</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">first_deriv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">second_deriv</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># get mean of the two nearest frequencies around the maximum as better estimate</span>
        <span class="n">maxima_freqs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">maxima</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">maxima</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># filter maxima based on the threshold</span>
        <span class="n">max_dos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>
        <span class="n">threshold</span> <span class="o">*=</span> <span class="n">max_dos</span>
        <span class="n">filtered_maxima_freqs</span> <span class="o">=</span> <span class="n">maxima_freqs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">maxima</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_maxima_freqs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># if no maxima reach the threshold (i.e. 1 super high peak and all other peaks</span>
            <span class="c1"># tiny), use half the height of second highest peak as threshold</span>
            <span class="n">second_highest_peak</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="n">second_highest_peak</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">filtered_maxima_freqs</span> <span class="o">=</span> <span class="n">maxima_freqs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">maxima</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">filtered_maxima_freqs</span><span class="p">)</span></div>


<div class="viewcode-block" id="PhononDos.get_dos_fp">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.get_dos_fp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_dos_fp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">binning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_f</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_f</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
        <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PhononDosFingerprint</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the DOS fingerprint.</span>

<span class="sd">        Args:</span>
<span class="sd">            binning (bool): If true, the DOS fingerprint is binned using np.linspace and n_bins.</span>
<span class="sd">                Default is True.</span>
<span class="sd">            min_f (float): The minimum mode frequency to include in the fingerprint (default is None)</span>
<span class="sd">            max_f (float): The maximum mode frequency to include in the fingerprint (default is None)</span>
<span class="sd">            n_bins (int): Number of bins to be used in the fingerprint (default is 256)</span>
<span class="sd">            normalize (bool): If true, normalizes the area under fp to equal to 1. Default is True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PhononDosFingerprint: The phonon density of states fingerprint</span>
<span class="sd">                of format (frequencies, densities, n_bins, bin_width)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span>

        <span class="k">if</span> <span class="n">max_f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">min_f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">min_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>

        <span class="n">densities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">densities</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_bins</span><span class="p">:</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">frequencies</span> <span class="o">&gt;=</span> <span class="n">min_f</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">frequencies</span> <span class="o">&lt;=</span> <span class="n">max_f</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">PhononDosFingerprint</span><span class="p">(</span>
                <span class="n">frequencies</span><span class="p">[</span><span class="n">inds</span><span class="p">],</span>
                <span class="n">densities</span><span class="p">[</span><span class="n">inds</span><span class="p">],</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">binning</span><span class="p">:</span>
            <span class="n">freq_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_f</span><span class="p">,</span> <span class="n">max_f</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">freq_bounds</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">freq_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">bin_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">freq</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="p">[</span><span class="n">frequencies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">frequencies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">10</span><span class="p">])</span>
            <span class="n">n_bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
            <span class="n">bin_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">dos_rebin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">freq</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)),</span> <span class="n">freq_bounds</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">freq_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">frequencies</span> <span class="o">&gt;=</span> <span class="n">e1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">frequencies</span> <span class="o">&lt;</span> <span class="n">e2</span><span class="p">))</span>
            <span class="n">dos_rebin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">densities</span><span class="p">[</span><span class="n">inds</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>  <span class="c1"># scale DOS bins to make area under histogram equal 1</span>
            <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dos_rebin</span> <span class="o">*</span> <span class="n">bin_width</span><span class="p">)</span>
            <span class="n">dos_rebin_sc</span> <span class="o">=</span> <span class="n">dos_rebin</span> <span class="o">/</span> <span class="n">area</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dos_rebin_sc</span> <span class="o">=</span> <span class="n">dos_rebin</span>

        <span class="k">return</span> <span class="n">PhononDosFingerprint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">freq</span><span class="p">]),</span> <span class="n">dos_rebin_sc</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">,</span> <span class="n">bin_width</span><span class="p">)</span></div>


<div class="viewcode-block" id="PhononDos.fp_to_dict">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.fp_to_dict">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fp_to_dict</span><span class="p">(</span><span class="n">fp</span><span class="p">:</span> <span class="n">PhononDosFingerprint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a fingerprint into a dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            fp: The DOS fingerprint to be converted into a dictionary</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dict of the fingerprint Keys=type, Values=np.ndarray(frequencies, densities)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fp_dict</span><span class="p">[</span><span class="n">fp</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fp</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="k">return</span> <span class="n">fp_dict</span></div>


<div class="viewcode-block" id="PhononDos.get_dos_fp_similarity">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDos.get_dos_fp_similarity">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_dos_fp_similarity</span><span class="p">(</span>
        <span class="n">fp1</span><span class="p">:</span> <span class="n">PhononDosFingerprint</span><span class="p">,</span>
        <span class="n">fp2</span><span class="p">:</span> <span class="n">PhononDosFingerprint</span><span class="p">,</span>
        <span class="n">col</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">pt</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;All&quot;</span><span class="p">,</span>
        <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;tanimoto&quot;</span><span class="p">,</span> <span class="s2">&quot;wasserstein&quot;</span><span class="p">,</span> <span class="s2">&quot;cosine-sim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tanimoto&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the similarity index between two fingerprints.</span>

<span class="sd">        Args:</span>
<span class="sd">            fp1 (PhononDosFingerprint): The 1st dos fingerprint object</span>
<span class="sd">            fp2 (PhononDosFingerprint): The 2nd dos fingerprint object</span>
<span class="sd">            col (int): The item in the fingerprints (0:frequencies,1: densities) to compute</span>
<span class="sd">                the similarity index of  (default is 1)</span>
<span class="sd">            pt (int or str) : The index of the point that the dot product is to be taken (default is All)</span>
<span class="sd">            normalize (bool): If True normalize the scalar product to 1 (default is False)</span>
<span class="sd">            metric (Literal): Metric used to compute similarity default is &quot;tanimoto&quot;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If metric other than &quot;tanimoto&quot;, &quot;wasserstein&quot; and &quot;cosine-sim&quot; is requested.</span>
<span class="sd">            ValueError: If normalize is set to True along with the metric.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Similarity index given by the dot product</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_metrics</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;tanimoto&quot;</span><span class="p">,</span> <span class="s2">&quot;wasserstein&quot;</span><span class="p">,</span> <span class="s2">&quot;cosine-sim&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_metrics</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid </span><span class="si">{</span><span class="n">metric</span><span class="si">=}</span><span class="s2">, choose from </span><span class="si">{</span><span class="n">valid_metrics</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">fp1_dict</span> <span class="o">=</span> <span class="n">CompletePhononDos</span><span class="o">.</span><span class="n">fp_to_dict</span><span class="p">(</span><span class="n">fp1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fp1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">fp1</span>

        <span class="n">fp2_dict</span> <span class="o">=</span> <span class="n">CompletePhononDos</span><span class="o">.</span><span class="n">fp_to_dict</span><span class="p">(</span><span class="n">fp2</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fp2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">fp2</span>

        <span class="k">if</span> <span class="n">pt</span> <span class="o">==</span> <span class="s2">&quot;All&quot;</span><span class="p">:</span>
            <span class="n">vec1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">fp1_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">vec2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pt</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">fp2_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vec1</span> <span class="o">=</span> <span class="n">fp1_dict</span><span class="p">[</span><span class="n">fp1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">pt</span><span class="p">]][</span><span class="n">col</span><span class="p">]</span>  <span class="c1"># type: ignore[index]</span>
            <span class="n">vec2</span> <span class="o">=</span> <span class="n">fp2_dict</span><span class="p">[</span><span class="n">fp2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">pt</span><span class="p">]][</span><span class="n">col</span><span class="p">]</span>  <span class="c1"># type: ignore[index]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">normalize</span> <span class="ow">and</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;tanimoto&quot;</span><span class="p">:</span>
            <span class="n">rescale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span> <span class="o">/</span> <span class="n">rescale</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">normalize</span> <span class="ow">and</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;wasserstein&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wasserstein_distance</span><span class="p">(</span>
                <span class="n">u_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">vec1</span> <span class="o">*</span> <span class="n">fp1</span><span class="o">.</span><span class="n">bin_width</span><span class="p">),</span>
                <span class="n">v_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">vec2</span> <span class="o">*</span> <span class="n">fp2</span><span class="o">.</span><span class="n">bin_width</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">normalize</span> <span class="ow">and</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;cosine-sim&quot;</span><span class="p">:</span>
            <span class="n">rescale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span> <span class="o">/</span> <span class="n">rescale</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">normalize</span> <span class="ow">and</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;cosine-sim&quot;</span><span class="p">:</span>
            <span class="n">rescale</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span> <span class="o">/</span> <span class="n">rescale</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute similarity index. When normalize=True, then please set metric=cosine-sim&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="PhononDosFingerprint">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.PhononDosFingerprint">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PhononDosFingerprint</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a Phonon Density of States (DOS) fingerprint.</span>

<span class="sd">    This named tuple is used to store information related to the Density of States (DOS)</span>
<span class="sd">    in a material. It includes the frequencies, densities, number of bins, and bin width.</span>

<span class="sd">    Args:</span>
<span class="sd">        frequencies: The frequency values associated with the DOS.</span>
<span class="sd">        densities: The corresponding density values for each energy.</span>
<span class="sd">        n_bins: The number of bins used in the fingerprint.</span>
<span class="sd">        bin_width: The width of each bin in the DOS fingerprint.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">frequencies</span><span class="p">:</span> <span class="n">NDArray</span>
    <span class="n">densities</span><span class="p">:</span> <span class="n">NDArray</span>
    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">bin_width</span><span class="p">:</span> <span class="nb">float</span></div>



<div class="viewcode-block" id="CompletePhononDos">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.CompletePhononDos">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CompletePhononDos</span><span class="p">(</span><span class="n">PhononDos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This wrapper class defines a total dos, and also provides a list of PDos.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        pdos (dict): Dict of partial densities of the form {Site:Densities}.</span>
<span class="sd">            Densities are a dict of {Orbital:Values} where Values are a list of floats.</span>
<span class="sd">            Site is a pymatgen.core.sites.Site object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">total_dos</span><span class="p">,</span> <span class="n">ph_doses</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            structure: Structure associated with this particular DOS.</span>
<span class="sd">            total_dos: total Dos for structure</span>
<span class="sd">            ph_doses: The phonon DOSes are supplied as a dict of {Site: Densities}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">frequencies</span><span class="o">=</span><span class="n">total_dos</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">densities</span><span class="o">=</span><span class="n">total_dos</span><span class="o">.</span><span class="n">densities</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span> <span class="o">=</span> <span class="p">{</span><span class="n">site</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dens</span><span class="p">)</span> <span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">dens</span> <span class="ow">in</span> <span class="n">ph_doses</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>

<div class="viewcode-block" id="CompletePhononDos.get_site_dos">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.CompletePhononDos.get_site_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_site_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PhononDos</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Dos for a site.</span>

<span class="sd">        Args:</span>
<span class="sd">            site: Site in Structure associated with CompletePhononDos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PhononDos: containing summed orbital densities for site.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PhononDos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">[</span><span class="n">site</span><span class="p">])</span></div>


<div class="viewcode-block" id="CompletePhononDos.get_element_dos">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.CompletePhononDos.get_element_dos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_element_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get element projected Dos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict of {Element: Dos}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">el_dos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">site</span><span class="p">,</span> <span class="n">atom_dos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">el</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">specie</span>
            <span class="k">if</span> <span class="n">el</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">el_dos</span><span class="p">:</span>
                <span class="n">el_dos</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">atom_dos</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">el_dos</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">atom_dos</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">el</span><span class="p">:</span> <span class="n">PhononDos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">densities</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">densities</span> <span class="ow">in</span> <span class="n">el_dos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>


<div class="viewcode-block" id="CompletePhononDos.from_dict">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.CompletePhononDos.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get CompleteDos object from dict representation.&quot;&quot;&quot;</span>
        <span class="n">total_dos</span> <span class="o">=</span> <span class="n">PhononDos</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">])</span>
        <span class="n">ph_doses</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;pdos&quot;</span><span class="p">],</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">total_dos</span><span class="p">,</span> <span class="n">ph_doses</span><span class="p">)</span></div>


<div class="viewcode-block" id="CompletePhononDos.as_dict">
<a class="viewcode-back" href="../../../pymatgen.phonon.html#pymatgen.phonon.dos.CompletePhononDos.as_dict">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;JSON-serializable dict representation of CompletePhononDos.&quot;&quot;&quot;</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
            <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">as_dict</span><span class="p">(),</span>
            <span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
            <span class="s2">&quot;densities&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">densities</span><span class="p">),</span>
            <span class="s2">&quot;pdos&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">:</span>
                <span class="n">dct</span><span class="p">[</span><span class="s2">&quot;pdos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdos</span><span class="p">[</span><span class="n">site</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">dct</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Complete phonon DOS for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="si">}</span><span class="s2">&quot;</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pymatgen 2025.1.24 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pymatgen.phonon.dos</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2011, Pymatgen Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>